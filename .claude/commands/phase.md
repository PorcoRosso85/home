# phase
/phase

# 説明
要件をBaby Steps（15-30分単位）に分解。分解前に必ず/testedを実行し、テストの哲学的価値を確認してから進める。

# 実行フロー

0. 禁止事項確認: `bin/docs/conventions/prohibited_items.md`

## 1. 【必須】分解前の確認事項
```
タスク分解を開始する前に必ず実行：
1. /tested コマンドを実行
2. テストの哲学的意義を確認
   - テストは「実行可能な仕様書」として機能するか？
   - 「リファクタリングの壁」原則を満たせるか？
   - ビジネス価値を明確に表現できるか？
3. アプリケーションの本質を理解
   - READMEを読み、アプリの存在意義を理解
   - ユーザーの要件変更履歴を確認
   - 作業の要約ではなく、価値の本質を把握
4. 確認完了後、以下の分解に進む
```

## 2. Baby Stepの構造
/tested確認後、各ステップを以下の構造で生成：

```
Step X: [要件名]の実現
├─ X.1: 価値の明文化（WHY）
│  └─ アプリケーションの本質的価値への貢献
├─ X.2: 仕様の定義（WHAT）
│  └─ 振る舞いをテストで表現【RED】
│  └─ /tdd実行：Redフェーズチェックリスト確認
├─ X.3: 実現（HOW）
│  └─ テストを満たす最小実装【GREEN】
│  └─ YAGNI原則：必要最小限のみ
├─ X.4: 検証（CHECK）
│  └─ nix run .#test
└─ X.5: 改善（REFACTOR）※必要に応じて
   └─ テストGREEN維持で設計改善
```

## 3. 自動確認項目（各ステップで検証）

### X.2（仕様定義）完了時チェック
- □ 要件・仕様を正確に反映しているか
- □ 振る舞いを検証（実装詳細ではない）
- □ 失敗メッセージが明確か
- □ Baby Stepsとして適切な粒度か
- □ テストファイル配置が規約準拠か

### X.3（実現）開始前チェック
- □ テストがREDで失敗しているか
- □ 失敗理由が期待通りか

## 4. 分解の原則

### 要件の正規化
- **重複排除**: 同じ要件を複数に分けない
- **責務分離**: 1つのStepは1つの責務
- **最小化**: 15-30分で完了可能な単位

### 価値駆動の順序
1. ビジネス価値が高いものから
2. 依存関係を考慮した順序
3. リスクが高いものを早期に

## 5. 開発パターン

### 新規開発（Beck流TDD）
- 価値の高い要件から段階的に
- 各StepでRED-GREEN-REFACTORサイクル
- /tdd参照：クラシックなTDD適用

### 既存コード改修（Feathers流）
- 現状を特性テストで保護（CHARACTERIZE）
- 新要件のREDテストを追加
- /tdd参照：段階的改善テクニック

# 単一責務の維持

**このコマンドの責務**：
- タスクをBaby Stepsに分解
- 実行順序を定義
- /tested実行を促す

**他コマンドに委譲**：
- テストの価値確認詳細 → /tested
- TDD技術詳細 → /tdd
- 正規化の実施 → /normalize

# 実行例

```
1. /phase "ユーザー認証機能の追加"
2. → 自動的に「/tested実行が必要」と表示
3. /tested実行後、Baby Steps生成：
   
   Step 1: ログイン機能の実現
   ├─ 1.1: 価値の明文化（WHY）
   ├─ 1.2: 仕様の定義（WHAT）【RED】
   │  └─ チェックリスト自動表示
   ├─ 1.3: 実現（HOW）【GREEN】
   ├─ 1.4: 検証（CHECK）
   └─ 1.5: 改善（REFACTOR）
   
   Step 2: ログアウト機能の実現
   ...（同様の構造）
```