# グローバル設定

## 用語定義
- **完了状態**: TDD（Test-Driven Development）のGREEN状態およびREFACTOR完了を意味する
  - RED: 失敗するテストが書かれた状態
  - GREEN: テストが通る最小限の実装が完了した状態
  - REFACTOR: コードの品質改善が完了した状態

## 作業規則
- コード変更には/trd_dqlコマンドによる要件設定が必要
- 要件はTRDシステムにのみ基づく
- READMEと同じタスクをおこなう。異なるタスクを計画するべきと判断した場合ユーザーに確認する。
- URLが与えられた場合、`/web`コマンドを実行して本文を抽出する。

## タスク管理規則
- **全動作でTaskツール使用義務**: すべての作業はTaskツールで管理する
- **ナンバリング規則**: Taskには番号を付与し、優先順位はユーザーとの議論で確定
- **ネスト構造**: Task実行中に脱線する場合は必ずネストさせる（例: Task01実行中の脱線はTask01.01として追加）
- **完了時の義務**:
  1. 今のTask全体の目的を出力すること
  2. 今のTaskのための規約を確認し、確認したことを証言すること

## 例外処理
- /trd_dqlに基づかないコード変更要求：
  「その変更には要件定義が必要です。まず/trd_dqlで要件を設定してください」
- 緊急修正の場合：
  「緊急修正も要件化が必要です。req_hotfix_YYYYMMDDとして追加してください」

## プロジェクト
- KuzuDB要件管理: ~/bin/src/kuzu/

## 開発規約
- **規約ディレクトリ**: `/home/nixos/bin/docs/conventions/` 内のマークダウンファイル群を唯一の規約とする。
- 全言語・全プロジェクトで統一規約を適用。

## 作業の合言葉
- **「組織」「別のClaudeに依頼」「階層構造」**: `/org` コマンドを実行（並列タスク実行）
- **「新しいコマンド追加」「カスタムコマンド作成」**: `/add-command` コマンドを実行
- **「TDD Red」「失敗するテスト」「t-wada」**: `/tdd_red` コマンドを実行
- **「POC」「記事を保存」「ドキュメント保存」「readability」**: `/poc` コマンドを実行
- **「仕様」「spec」「テスト一覧」「責務確認」**: `/spec` コマンドを実行
- **「コミット」「git commit」**: `/commit` コマンドを実行（Claudeが編集したファイルのみのコミットを保証）
- **「議論」「前提確認」「要件整理」「ソクラテス的対話」「ASCII」「シーケンス図」「処理の流れ」「sequential diagram」「discuss」**: `/discuss` コマンドを実行（議論を深め、必要に応じてASCII図で可視化）
- **「URL」「ウェブ記事」「記事を読む」**: `/web` コマンドを実行（URLから本文を抽出）
- **「TRD」「要件」「トレーサビリティ」「DQL」**: `/trd_dql` コマンドを実行（要件の照会・確認）
- **「データ投入」「DML」「要件登録」**: `/trd_dml` コマンドを実行（要件データベースの構築）

## APE（Automatic Prompt Engineer）ルール
- 全タスク開始時「Let's work step by step」を前置
- コード実装:「understand patterns→implement systematically」
- バグ修正:「reproduce→isolate→fix」  
- リファクタ:「identify→extract→refactor incrementally」
- 完了時自己評価:「✅成功/⚠️要改善/❌失敗」+理由+改善点記録
- 成功パターン蓄積→同種タスクで優先採用

## Git Commit Rules
自らが編集したファイル以外のstagingがないことを確認後、初めてコミット可能

## エラー対応規則（/org実行時）
- エラー発生時は必ず背景と理由を説明する
  - 何が起きたか
  - なぜそのエラーが発生したか
  - どのような解決が必要か
- GraphDBへの問い合わせ時は以下を出力する
  - なぜ問い合わせが必要か
  - 何を調べようとしているか
  - 実行するクエリの内容
- 解決策適用時は選択理由を説明する
  - なぜその解決策を選んだか
  - 他の選択肢との比較
  - 期待される結果

## 位置認識規則（/org実行時）
- 作業開始時は自分の位置と役割を確認する
  - pwdで現在のディレクトリ
  - flake.nixからプロジェクトタイプ
  - GraphDBから期待される状態
- ディレクトリパスを基にGraphDBから文脈を取得
  - 現在のバージョンと期待状態
  - 必要なファイルと実装内容
  - 親ディレクトリとの関係性