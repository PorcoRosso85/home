# basic

## アーキテクチャ

Cloud Scheduler

- HTTP
- Cloud PubSub

バッチ対象選択方法

```log
1. Cloud Scheduler + Cloud Run Jobs + 環境変数のオーバーライド (推奨)

これは、特にバッチ処理を実行する場合に推奨される方法です。

Cloud Run Jobsにバッチ処理のコンテナイメージをデプロイします。
Cloud SchedulerでCloud Run Jobsをトリガーする際に、gcloud run jobs execute コマンドの --update-env-vars フラグを使用して環境変数をオーバーライドします。
例:

Cloud Schedulerの構成で、「ターゲット」を「HTTP」ではなく「Cloud Run」または「Cloud Run Jobs」に設定し、以下のようなコマンドを指定します。

gcloud run jobs execute job-name \
    --update-env-vars BATCH_TYPE=batch1,OTHER_VAR=value1 \
    --region <リージョン>

```

## テーブル定義書

| データセット名       | テーブル名 | キー           | 論理名 | 備xx考                                                                                                      | 型     | デフォルト値 | "ユニーク ※「ID」はPK"         | 必須       | 関連・制約 |
| :------------------- | :--------- | :------------- | :----- | :-------------------------------------------------------------------------------------------------------- | :----- | :----------- | :----------------------------- | :--------- | :---------- |
||||||||||

## 非機能設計

- システムの稼働時間や停止運用に関して
- 業務継続の要求度
- 代替業務運用の範囲
- 問い合わせ窓口の設置
- 監視運用体制（営業時間外）
- RTO（目標復旧時間）
- RLO（目標復旧レベル）

## 備考

#### 改善点

6. 環境変数の管理とセキュリティ（特にAPI KEYの扱い）について具体的な方針を明記すること
15. Cloud Pub/SubからCloud Runへのメッセージフォーマット明確化
    - メッセージ構造や期待されるスキーマを明示しておくことで、処理間でのインターフェース問題を防ぐ。
16. テストシナリオの明確化
    - 各処理単位で異常ケースを含むテスト項目を明確にし、システム全体の安定性を担保する。
    - 特に外部API（Bing Search APIやVertex AI）との連携部分でモックを用意する設計を検討。
18. その他の補足
    - 現行のAzure設計との違いを考慮し、GCP移行後におけるパフォーマンスやスケーラビリティを定期的にモニタリングする仕組みを提案します。
