# Flake選択コンテナビルドシステム要件定義

## 目的（What/Why）

### What（何を作るか）
複数のNix flake.nixから任意のものを選択し、そのflakeを使用してコンテナイメージをビルドできるシステム

### Why（なぜ必要か）
- **統一的なビルド**: 異なるプロジェクトのflake.nixを一つのインターフェースから選択・ビルド可能にする
- **開発効率化**: 複数のコンテナイメージを管理する際の手順を標準化
- **再利用性**: 既存のflake.nixアセットを活用してコンテナ化を促進

## ビジネス要求

### 機能要求
1. **Flake選択機能**
   - システム内のflake.nixファイルを検索・一覧表示
   - ユーザーが対話的に選択可能
   - 選択したflakeの詳細情報表示

2. **コンテナビルド機能**
   - 選択したflakeを使用してコンテナイメージをビルド
   - ビルド進行状況の表示
   - エラー時の適切なメッセージ表示

3. **ビルド結果管理**
   - ビルドしたイメージの一覧表示
   - Dockerへのロード機能
   - イメージのタグ管理

### 非機能要求
1. **使いやすさ**
   - シンプルなCLIインターフェース
   - 明確なエラーメッセージ
   - ヘルプ機能

2. **拡張性**
   - 新しいflakeタイプへの対応が容易
   - ビルドオプションの追加が可能
   - カスタムフックの追加が可能

3. **信頼性**
   - ビルド失敗時の適切なロールバック
   - 部分的な成功の管理
   - 再実行可能性

## ユースケース

### UC1: flakeの選択とビルド
1. ユーザーがflake選択コマンドを実行
2. システムが利用可能なflake一覧を表示
3. ユーザーが番号で選択
4. システムが選択されたflakeでビルドを実行
5. ビルド完了後、結果を表示

### UC2: ビルド済みイメージの管理
1. ユーザーがイメージ一覧コマンドを実行
2. システムがビルド済みイメージを表示
3. ユーザーがDockerへのロードを選択
4. システムがdocker loadを実行

### UC3: カスタム設定でのビルド
1. ユーザーが設定ファイルを準備
2. 設定ファイルを指定してビルドコマンドを実行
3. システムが設定に従ってビルド

## 制約条件

1. **技術制約**
   - Nix 2.0以上が必要
   - Dockerが利用可能な環境
   - flake.nixがコンテナビルド定義を含む

2. **運用制約**
   - ローカル環境での実行を前提
   - ビルド時間はflakeの複雑さに依存

## 成功基準

1. 任意のflakeを選択してコンテナをビルドできる
2. ビルドしたコンテナがDockerで実行可能
3. エラー時に原因が特定できるメッセージが表示される
4. 既存のpoc/container内のflakeで動作確認済み

## 期待される成果物

1. **flake-selector.sh** - メインの選択・ビルドスクリプト
2. **build-config.json** - ビルド設定ファイル（オプション）
3. **test_flake_selector.bats** - BATSテストスイート
4. **SPECIFICATION.md** - 技術設計書（Designer作成）
5. **使用ドキュメント** - エンドユーザー向けガイド