# Mandatory Reference Rules Configuration
# This file defines category-based rules for enforcing reference requirements

# Category-specific rules
categories:
  # Authentication requirements must reference security standards
  authentication:
    mandatory_standards:
      - "ASVS"      # OWASP Application Security Verification Standard
      - "NIST"      # NIST 800-63B Authentication Guidelines
    minimum_references: 2
    specific_sections:
      ASVS: 
        - "V2"      # Authentication Verification Requirements
        - "V3"      # Session Management Verification Requirements
      NIST:
        - "5.1"     # Authenticator and Verifier Requirements
        - "5.2"     # Memorized Secret Verifiers
    priority_weight: high  # High priority violations are critical

  # Authorization and access control
  authorization:
    mandatory_standards:
      - "ASVS"
      - "ISO27001"
    minimum_references: 2
    specific_sections:
      ASVS:
        - "V4"      # Access Control Verification Requirements
      ISO27001:
        - "A.9"     # Access Control
        - "A.6"     # Organization of Information Security
    priority_weight: high

  # Cryptographic requirements
  cryptography:
    mandatory_standards:
      - "ASVS"
      - "NIST"
      - "FIPS"      # Federal Information Processing Standards
    minimum_references: 3
    specific_sections:
      ASVS:
        - "V6"      # Stored Cryptography Verification Requirements
        - "V9"      # Communications Verification Requirements
      NIST:
        - "800-57"  # Key Management
        - "800-175B" # Guideline for Using Crypto Standards
      FIPS:
        - "140-2"   # Security Requirements for Cryptographic Modules
        - "140-3"   # Updated Cryptographic Module Standards
    priority_weight: critical

  # Data protection and privacy
  data_protection:
    mandatory_standards:
      - "GDPR"      # General Data Protection Regulation
      - "ISO27001"
      - "ASVS"
    minimum_references: 2
    specific_sections:
      GDPR:
        - "Article 32"  # Security of processing
        - "Article 25"  # Data protection by design
        - "Article 35"  # Data protection impact assessment
      ISO27001:
        - "A.8"     # Asset Management
        - "A.12"    # Operations Security
        - "A.18"    # Compliance
      ASVS:
        - "V6"      # Stored Cryptography
        - "V8"      # Data Protection Verification Requirements
    priority_weight: high

  # Logging and monitoring
  logging:
    mandatory_standards:
      - "ASVS"
      - "ISO27001"
    minimum_references: 1
    specific_sections:
      ASVS:
        - "V7"      # Error Handling and Logging Verification Requirements
      ISO27001:
        - "A.12.4"  # Logging and Monitoring
        - "A.16"    # Information Security Incident Management
    priority_weight: medium

  # API and web service security
  api_security:
    mandatory_standards:
      - "ASVS"
      - "OWASP_API"  # OWASP API Security Top 10
    minimum_references: 2
    specific_sections:
      ASVS:
        - "V13"     # API and Web Service Verification Requirements
      OWASP_API:
        - "API1"    # Broken Object Level Authorization
        - "API2"    # Broken User Authentication
        - "API3"    # Excessive Data Exposure
        - "API4"    # Lack of Resources & Rate Limiting
    priority_weight: high

  # Input validation and output encoding
  validation:
    mandatory_standards:
      - "ASVS"
      - "CWE"       # Common Weakness Enumeration
    minimum_references: 2
    specific_sections:
      ASVS:
        - "V5"      # Validation, Sanitization and Encoding
      CWE:
        - "CWE-20"  # Improper Input Validation
        - "CWE-79"  # Cross-site Scripting
        - "CWE-89"  # SQL Injection
    priority_weight: high

  # Business logic security
  business_logic:
    mandatory_standards:
      - "ASVS"
    minimum_references: 1
    specific_sections:
      ASVS:
        - "V11"     # Business Logic Verification Requirements
    priority_weight: medium

  # File and resource handling
  file_upload:
    mandatory_standards:
      - "ASVS"
      - "CWE"
    minimum_references: 2
    specific_sections:
      ASVS:
        - "V12"     # File and Resources Verification Requirements
      CWE:
        - "CWE-434" # Unrestricted Upload of File with Dangerous Type
        - "CWE-400" # Uncontrolled Resource Consumption
    priority_weight: high

  # Configuration and deployment
  configuration:
    mandatory_standards:
      - "ASVS"
      - "ISO27001"
      - "CIS"       # Center for Internet Security Controls
    minimum_references: 2
    specific_sections:
      ASVS:
        - "V14"     # Configuration Verification Requirements
      ISO27001:
        - "A.12.1"  # Operational procedures and responsibilities
        - "A.12.6"  # Technical vulnerability management
      CIS:
        - "CIS-1"   # Inventory and Control of Hardware Assets
        - "CIS-2"   # Inventory and Control of Software Assets
    priority_weight: medium

# Override rules for special cases
overrides:
  # Pattern-based overrides
  patterns:
    # POC and prototype requirements have relaxed rules
    - uri_pattern: "req:project:poc:*"
      rule: "relaxed"
      minimum_references: 0
      reason: "Proof of concept - references optional"
    
    # Legacy system requirements may have gradual compliance
    - uri_pattern: "req:project:legacy:*"
      rule: "gradual"
      minimum_references: 1
      mandatory_standards: ["ASVS"]  # Only ASVS required initially
      reason: "Legacy system - gradual compliance approach"
    
    # Critical infrastructure has stricter requirements
    - uri_pattern: "req:project:critical:*"
      rule: "strict"
      additional_standards: ["CC", "SOC2", "FISMA"]
      minimum_references: 4
      reason: "Critical infrastructure - enhanced compliance required"
    
    # Internal tools have reduced requirements
    - uri_pattern: "req:internal:tool:*"
      rule: "reduced"
      minimum_references: 1
      exclude_standards: ["GDPR"]  # No GDPR for internal tools
      reason: "Internal tooling - reduced compliance scope"

  # Specific exceptions (temporary or permanent)
  exceptions:
    # Temporary exception during migration
    - uri: "req:project:migration:auth:001"
      reason: "Active migration to new auth system"
      temporary: true
      expires: "2024-12-31"
      minimum_references: 0
    
    # Permanent exception for specific requirement
    - uri: "req:project:custom:crypto:001"
      reason: "Uses proprietary encryption - standard refs not applicable"
      temporary: false
      alternative_validation: "security_review"
      
    # Conditional exception based on environment
    - uri: "req:project:dev:logging:*"
      reason: "Development environment - relaxed logging requirements"
      condition: "environment == 'development'"
      minimum_references: 0

# Validation configuration
validation:
  # Strict mode fails tests on violations, otherwise warnings
  strict_mode: false
  
  # Warning mode shows violations without failing
  warning_mode: true
  
  # Overall coverage threshold (percentage of requirements with references)
  coverage_threshold: 0.8  # 80%
  
  # Category-specific thresholds
  category_thresholds:
    authentication: 0.95    # 95% for auth requirements
    cryptography: 1.0       # 100% for crypto requirements
    data_protection: 0.9    # 90% for data protection
    api_security: 0.85      # 85% for API security
  
  # Report format options: json, yaml, markdown, html
  report_format: "markdown"
  
  # Include details in reports
  report_details:
    include_compliant: false     # Don't show compliant items
    include_overrides: true      # Show applied overrides
    include_suggestions: true    # Suggest relevant standards
    max_violations_shown: 20     # Limit violations in summary
  
  # Enforcement levels by environment
  enforcement:
    development:
      strict_mode: false
      coverage_threshold: 0.6
    staging:
      strict_mode: false
      coverage_threshold: 0.8
    production:
      strict_mode: true
      coverage_threshold: 0.95

# Standard reference suggestions
# Maps requirement keywords to suggested standards
suggestions:
  keywords:
    - pattern: "password|authentication|login|credential"
      standards: ["ASVS V2", "NIST 800-63B"]
    
    - pattern: "encrypt|cryptograph|cipher|hash"
      standards: ["ASVS V6", "NIST 800-57", "FIPS 140-3"]
    
    - pattern: "personal data|PII|GDPR|privacy"
      standards: ["GDPR Article 32", "ISO27001 A.18", "ASVS V8"]
    
    - pattern: "api|rest|graphql|endpoint"
      standards: ["ASVS V13", "OWASP API Security"]
    
    - pattern: "log|audit|monitor|alert"
      standards: ["ASVS V7", "ISO27001 A.12.4"]
    
    - pattern: "role|permission|access control|authorization"
      standards: ["ASVS V4", "ISO27001 A.9"]

# Reporting templates
reporting:
  # Email notification settings
  notifications:
    enabled: false
    recipients: ["security@example.com"]
    threshold: 0.7  # Send notification if coverage drops below
    
  # Integration with other tools
  integrations:
    jira:
      enabled: false
      create_issues_for_violations: true
      project_key: "SEC"
    
    slack:
      enabled: false
      webhook_url: "${SLACK_WEBHOOK_URL}"
      channel: "#security-compliance"