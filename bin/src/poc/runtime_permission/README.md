# Deno Runtime Permission POC

## プロジェクトの責務

このプロジェクトは、**Denoのランタイムレベルでの権限制御機能を用いて、どこまでインフラ領域を最小化できるか**を検証することを目的としています。

### 主な検証項目

1. **セキュリティ制御の簡潔性**
   - 従来のインフラ層（Docker、VM、ファイアウォール等）で実現していたセキュリティ制御を、Denoの権限フラグだけでどこまで代替できるか

2. **開発者体験の向上**
   - セキュリティ設定を「インフラエンジニアの仕事」から「アプリケーション開発者の日常」へ移行できるか
   - 権限制御の宣言的な記述がどれだけ直感的か

3. **最小限のインフラ構成**
   - Deno + 最小限のOSレイヤーだけで、プロダクションレディなセキュリティを実現できるか
   - 従来必要だったツール群（コンテナ、ネットワークポリシー、RBAC等）をどこまで削減できるか

### 検証方法

1. **基本的な権限制御のデモ**
   - ファイルシステムアクセスの制限
   - ネットワークアクセスの制限
   - 環境変数アクセスの制限
   - サブプロセス実行の制限

2. **実用的なユースケース**
   - APIクライアント：特定のドメインのみへのアクセス
   - ファイル処理：特定ディレクトリのみの読み書き
   - 設定管理：必要な環境変数のみの参照

3. **セキュリティテスト**
   - 権限がない操作を試みた際の挙動確認
   - 権限エスカレーションの可能性検証
   - デフォルトセキュア（原則禁止）の実効性確認

### なぜDenoか？

Denoが提供する価値は「他では実現不可能な機能」ではなく、**「誰が、どのレイヤーで、どれだけ簡単にセキュリティ制御を行えるか」**という点にあります。

- **ビルトイン vs アドオン**: セキュリティがランタイムの核心的機能として組み込まれている
- **宣言的 vs 専門的**: 開発者が一行のフラグで意図を表現できる
- **原則禁止 vs 原則許可**: デフォルトで全てが禁止され、必要なものだけを許可する

### プロジェクト構成

```
.
├── flake.nix              # Nix開発環境定義（Denoのみ）
├── README.md              # このファイル
├── src/                   # デモアプリケーション
│   ├── file_access.ts     # ファイルアクセス制限のデモ
│   ├── network_access.ts  # ネットワークアクセス制限のデモ
│   ├── env_access.ts      # 環境変数アクセス制限のデモ
│   └── subprocess.ts      # サブプロセス実行制限のデモ
├── tests/                 # 権限テスト
│   └── permissions_test.ts # 各種権限制御のテスト
└── scripts/               # 実行スクリプト
    └── run_demos.sh       # 各デモの実行例
```

### 使い方

```bash
# 開発環境に入る
nix develop

# 権限なしで実行（すべて拒否される）
deno run src/file_access.ts

# 特定のディレクトリへの読み取り権限のみ付与
deno run --allow-read=./data src/file_access.ts

# 特定のドメインへのネットワークアクセスのみ許可
deno run --allow-net=api.example.com src/network_access.ts

# テストの実行
deno test --allow-read --allow-write=./temp
```

### 結論

このPOCを通じて、Denoのランタイムレベルでの権限制御が、従来のインフラ層での複雑なセキュリティ設定を大幅に簡素化できることを実証します。これにより、セキュリティの実装と管理が、特殊な専門知識を必要とする「インフラタスク」から、すべての開発者が日常的に扱える「アプリケーションの一部」へと変化する可能性を示します。