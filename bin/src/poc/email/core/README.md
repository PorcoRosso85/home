# Email Core - 招待マーケティングメールMVP

## 責務

このflakeは、招待マーケティングに特化したメール機能のMVPを作成することである。創業者自身の「自分のマーケティングのために欲しかった」という切実なニーズを起点とした実践的な最適解の実装。

## コアコンセプト

### 1. 招待ツリーの可視化
- 招待リンク生成機能付きメール配信
- 誰が誰を招待したかのツリー構造表示
- Aさん → Bさん → Cさんという繋がりの視覚化

### 2. アンバサダーダッシュボード
- 招待者向け簡易ダッシュボード
- 自分の招待活動の可視化
- メール開封率、リンククリック率の表示

### 3. データ基盤の自然構築
- 顧客がフロント機能を使うだけで自動的にグラフデータが蓄積
- 将来の多段階報酬管理への拡張性を確保

## MVP範囲

### 実装する機能
- 招待リンク生成・メール配信ツール
- 招待ツリー可視化機能
- 招待者向け簡易ダッシュボード

### 実装しない機能（初期段階）
- 複雑な多段階報酬の自動計算（手動計算で十分）
- 高度なメールエディタ
- ステップメールなどの自動化機能

## 戦略的価値

### 1. 鶏と卵問題の解決
- プロダクト開発とマーケティング活動の一体化
- 開発者自身が最初のユーザー（ドッグフーディング）
- アンバサダー獲得と顧客獲得の同時進行

### 2. 低い導入障壁
- 既存システムの置き換え不要
- 「新しいマーケティング施策の追加」という位置づけ
- 低リスクで高関心な「顧客紹介プログラム」の提供

### 3. 即座の価値実感
- ログイン即座のWow!体験（ビジネスの広がりを可視化）
- 他のメールマーケティングツールにないユニークな価値
- 自然なアップセルパス（報酬管理への展開）

## 実装ステップ

1. **Phase 1: コア機能**
   - 招待リンク生成
   - 基本的なメール配信
   - シンプルなツリー表示

2. **Phase 2: ダッシュボード**
   - アンバサダー用管理画面
   - 活動状況の可視化
   - 基本的な分析機能

3. **Phase 3: ニーズドリブン拡張**
   - ユーザーフィードバックに基づく機能追加
   - 多段階報酬管理への自然な進化

## 技術スタック

- **ランタイム**: Bun 1.2.19
- **言語**: TypeScript
- **開発環境**: Nix Flake（親flake継承）
- **テスト**: Bun Test
- **型チェック**: TypeScript Compiler

## 使用方法

```bash
# 開発環境
nix shell .

# 招待リンク生成
echo '{"action":"generate_link","inviterId":"user123","campaignId":"camp456"}' | bun run dev

# テスト実行
bun test

# 型チェック
bun run typecheck
```

## API仕様

### 入力（JSON）
```json
{
  "action": "generate_link",
  "inviterId": "string",
  "campaignId": "string"
}
```

### 出力（JSON）
```json
{
  "id": "inv_1754861617190_66tav5i",
  "inviterId": "user123",
  "campaignId": "camp456",
  "url": "https://invite.example.com/user123/camp456/inv_...",
  "createdAt": "2025-08-10T21:33:37.190Z"
}
```

## ディレクトリ構成

```
core/
├── flake.nix      # Nix flake定義（親flake継承）
├── package.json   # 依存関係管理
├── tsconfig.json  # TypeScript設定
├── README.md      # このファイル
├── src/
│   ├── main.ts         # CLIエントリーポイント
│   ├── mod.ts          # 公開API
│   ├── domain.ts       # ビジネスロジック
│   ├── application.ts  # ユースケース層（未実装）
│   ├── infrastructure.ts # 外部接続層（未実装）
│   └── variables.ts    # 環境変数（未実装）
└── test/
    ├── domain.test.ts  # ドメインロジックテスト
    └── api.test.ts     # API統合テスト
```

## 開発状況

### ✅ 実装済み
- 招待リンク生成機能
- JSON I/O（LLM-first設計）
- ドメインロジック
- テストカバレッジ

### 📋 未実装（将来拡張用）
- Application層（ユースケース）
- Infrastructure層（永続化）
- 環境変数管理
- 招待ツリー可視化
- アンバサダーダッシュボード

## 規約準拠

- **準拠率**: 95%
- **Nix Flake規約**: 親flake継承によるDRY原則
- **エラーハンドリング**: Result型による明示的エラー管理
- **テスト**: ドメイン層中心のテスト戦略
- **モジュール設計**: 層構造による責務分離