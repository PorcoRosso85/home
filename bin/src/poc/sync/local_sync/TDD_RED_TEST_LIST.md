# Local Sync Engine - TDD Red Phase Test List

## テスト実行結果
```
FAILED | 0 passed | 14 failed (38ms)
```

## テスト一覧

### 1. 基本的な同期機能
- [ ] **単一クライアントのイベント送信**
  - LocalSyncServerインスタンスの作成
  - クライアント接続
  - イベント送信とID生成
  - ベクタークロックの初期化

- [ ] **複数クライアント間でのイベント同期**
  - 2つのクライアント接続
  - client1からのイベント送信
  - client2での受信確認
  - データ内容の一致確認

- [ ] **ベクタークロックによる因果関係追跡**
  - 初期ベクタークロック状態
  - イベント送信によるクロック更新
  - 同期後のクロック状態マージ

### 2. 競合検出と解決
- [ ] **同時編集の競合検出**
  - 同一ドキュメントへの同時更新
  - 競合の検出と型判定
  - 競合イベントのリスト化

- [ ] **Last Write Wins競合解決**
  - タイムスタンプベースの解決
  - 新しいイベントの優先
  - 解決戦略の明示

- [ ] **カスタム競合解決戦略**
  - カスタムリゾルバーの設定
  - 任意のロジックでの解決
  - 文字列長による優先度例

### 3. リアルタイム通知
- [ ] **イベント発生時のリアルタイム通知**
  - イベントリスナーの登録
  - 非同期通知の受信
  - メッセージ内容の確認

- [ ] **選択的なイベント購読**
  - フィルター条件の設定
  - 特定タイプのイベントのみ受信
  - 不要なイベントの除外

### 4. 状態管理と永続化
- [ ] **サーバー側の状態スナップショット**
  - 現在状態のキャプチャ
  - イベント数の記録
  - タイムスタンプの付与

- [ ] **クライアント再接続時の差分同期**
  - 最終同期時刻の記録
  - 新規イベントのみ取得
  - 効率的な差分転送

### 5. パフォーマンスとスケーラビリティ
- [ ] **大量イベントのバッチ処理**
  - 1000イベントの一括送信
  - 100ms以内の処理完了
  - バッチサイズの設定

- [ ] **メモリ効率的なイベントストリーム**
  - メモリ上限の設定（100イベント）
  - 古いイベントの永続化
  - 全イベントへのアクセス保証

### 6. エラーハンドリング
- [ ] **不正なイベントデータの検証**
  - 無効な操作タイプの拒否
  - 必須データの存在確認
  - 適切なエラーメッセージ

- [ ] **同期タイムアウトの処理**
  - タイムアウト時間の設定
  - 遅延シミュレーション
  - タイムアウトエラーの発生

## 実装に必要なコンポーネント

### クラス/インターフェース
- `LocalSyncServer` - メインサーバークラス
- `SyncClient` - クライアント接続管理
- `SyncEvent` - イベントデータ構造
- `ConflictResolution` - 競合解決結果

### 主要メソッド
- `connect(clientId)` - クライアント接続
- `send(data)` - イベント送信
- `sync(lastSync?)` - 同期実行
- `detectConflicts(events)` - 競合検出
- `resolveConflict(a, b)` - 競合解決
- `createSnapshot()` - スナップショット作成
- `on(event, handler)` - イベントリスナー
- `subscribe(options)` - 選択的購読

### 設定オプション
- `conflictStrategy` - 競合解決戦略
- `conflictResolver` - カスタムリゾルバー
- `batchSize` - バッチサイズ
- `maxMemoryEvents` - メモリイベント上限
- `syncTimeout` - 同期タイムアウト

## 次のステップ（Green Phase）
1. 基本的なサーバークラスの実装
2. クライアント管理機能の追加
3. イベント処理とベクタークロック
4. 競合検出と解決ロジック
5. リアルタイム通知システム
6. パフォーマンス最適化