# 残っている課題一覧

## 🔴 重要度：高（セキュリティ・基本機能）

### 1. **認証・認可の完全欠如**
- WebSocket接続に認証なし
- 誰でも接続してイベントを送信可能
- クライアントIDの詐称が可能
- イベント送信の権限チェックなし

### 2. **履歴同期機能の未実装（クライアント側）**
- サーバー側には実装済み（`requestHistory`）
- demo.htmlが初回接続時に履歴を要求しない
- 新規ブラウザは過去のイベントを取得できない

### 3. **DoS攻撃への脆弱性**
- 接続数制限なし
- レート制限なし
- リソース枯渇攻撃が可能

## 🟠 重要度：中（開発効率・品質）

### 4. **テスト自動化の不完全性**
- WebSocketサーバーの自動起動なし
- CI/CDでの実行不可
- `waitForTimeout(100)`による不確実な同期待機

### 5. **型安全性の不足**
```typescript
// 現状
function validateEvent(event: any): void
// 理想
function validateEvent(event: StoredEvent): void
```
- WebSocketメッセージの型定義が不完全
- `any`型の多用

### 6. **エラーハンドリングの不足**
- KuzuDB初期化エラーのフィードバックなし
- ネットワークエラー時の処理が最小限
- データ不整合時の修復機能なし

### 7. **インジェクション対策の簡易性**
- パラメータ検証が`DROP`, `DELETE`, `--`のチェックのみ
- より堅牢な検証が必要

## 🟡 重要度：低（改善・最適化）

### 8. **イベント永続化**
- 現在はメモリ内配列のみ
- サーバー再起動で履歴消失
- データベースへの永続化が必要

### 9. **パフォーマンステスト**
- 実ブラウザでの50+クライアント負荷テストなし
- メモリ使用量の監視なし
- スケーラビリティの実証不足

### 10. **コードの重複**
- 複数ファイルで同様のKuzuDB初期化コード
- browser_kuzu_variants.tsの整理が必要

### 11. **ドキュメントの不整合**
- README.mdが実装状況を正確に反映していない
- セキュリティ制限事項の記載なし
- 本番環境での使用に関する警告なし

### 12. **開発環境の複雑性**
- ESM/CommonJSの混在（KuzuDB Node.js版の制約）
- CTSブリッジファイルの必要性
- Nix環境が必須だが自動化されていない

### 13. **データ検証の脆弱性**
- checksumが暗号学的に安全でない
- タイムスタンプの改ざんチェックなし
- イベントの順序保証が不完全

### 14. **運用面の課題**
- ログローテーションなし
- メトリクス収集なし
- 監視・アラート機能なし

## 実装推奨優先順位

### Phase 1: セキュリティ対応（必須）
1. JWT認証の実装
2. WebSocket接続の認証
3. レート制限・接続数制限
4. より堅牢なインジェクション対策

### Phase 2: 基本機能完成
1. 履歴同期のクライアント実装
2. イベント永続化（SQLite等）
3. エラーハンドリング強化
4. データ不整合時の修復機能

### Phase 3: 品質向上
1. 完全な型定義
2. テスト自動化
3. CI/CD対応
4. ドキュメント更新

### Phase 4: 本番対応
1. パフォーマンステスト
2. 監視・ログ機能
3. スケーラビリティ検証
4. 運用手順書作成

## 注意事項

現在の実装は**POC（概念実証）**としては機能していますが、本番環境での使用には上記の課題解決が必須です。特にセキュリティ関連の課題は、実運用前に必ず対処する必要があります。