# KuzuDB Network Sync POC

実際のネットワーク環境での競合解決と同期をテストするPOC。

## 背景

kuzu_query_loggerで実装したACIDトランザクションログは理論的には正しいが、実際のネットワーク環境では以下の課題がある：

- **ネットワーク分断**: 一時的な接続断や部分的な分断
- **パケットロス**: メッセージの欠落と再送
- **遅延の変動**: メッセージ到着順序の逆転
- **同時書き込み**: 分断中の競合する更新

## テストする責務

### 1. ネットワーク分断と再接続
- **分断時のローカル書き込み**: オフライン動作の保証
- **自動再接続**: 接続回復時の自動同期
- **部分的分断**: 3ノード以上での複雑な分断パターン

### 2. メッセージ順序と信頼性
- **順序保証**: シーケンス番号による順序管理
- **パケットロス対策**: 再送メカニズム
- **重複除去**: 冪等性の保証

### 3. 競合解決
- **同時書き込み**: Last-Write-Wins戦略
- **因果関係**: ベクタークロックによる依存関係追跡
- **競合のないマージ**: 独立した更新の統合

### 4. 効率的な同期
- **差分同期**: 最小限のデータ転送
- **チェックポイント**: 大規模データの効率的な初期同期

## 実装方針

```python
# 主要コンポーネント
- NetworkSyncNode: 同期機能を持つノード
- NetworkSimulator: ネットワーク状態をシミュレート
- SyncProtocol: 同期プロトコルの実装
- ConflictResolver: 競合解決戦略
```

## 使用方法

```bash
# REDフェーズ（全テスト失敗を確認）
nix run .#test-red

# GREENフェーズ（実装後）
nix run .#test-green
```

## 期待される成果

1. **ネットワーク障害への耐性**: 分断や遅延があっても最終的に一貫性を保つ
2. **効率的な同期**: 必要最小限のデータ転送
3. **明確な競合解決**: 予測可能な動作
4. **実運用への適用可能性**: 本番環境での使用に耐える品質