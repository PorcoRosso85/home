# SaaS Partner Calculator

## なぜこのプロダクトが必要か

### 深夜2時、オフィスで一人、数字と睨めっこする経営者の真実

**Before（現実）:**
```
「くそっ…またパートナー候補から『具体的な報酬プランを提示してください』か。なんて返せばいいんだ…」
「A社は売上の20%を払ってるらしいが、うちはまだ単価が安いから同じじゃ無理だ…」
「固定で払うべきか？成功報酬にすべきか？組み合わせるべきか？どれが正解なんだ…？」
「コンサルに頼むか？いや、あいつら一般論しか言わないし、結局最後は『社長が決めることです』だ。100万払ってそれかよ…」
「誰か、ウチの会社にピッタリの『答え』をくれよ…もう考えるのに疲れた…」
```

**After（3分後）:**
```
「な…なんだこれは…」
「俺が3日間悩んでも出なかった答えが…たった3分で、しかも3つも…」
「しかも、それぞれのメリット・デメリット、利益率まで書いてある…」
「そうだ、俺が欲しかったのはこれだ。ただの数字じゃない。『選択肢』と『その選択肢がもたらす未来』だ…！」
```

## プロダクト本質
**定義**: SaaSパートナープログラムの報酬計算・シミュレーション特化型計算機

**価値**: 経営者の意思決定を自動化する唯一無二のエンジン
- 「分からない、決められない」という無限の苦痛を「具体的な選択肢」に変換
- 選択肢を選んだ場合の「未来への不安」を「予測可能な数字」に変換
- 属人的コンサルティングからの完全脱却

## ビジネスモデル
- **形態**: Vertical SaaS
- **価格**: 月額8万円（年額96万円）
- **目標**: 3年目40社、ARR 3,840万円
- **利益率**: 82.3%（税引前）

## コア機能（必須実装）

### 1. 報酬モデル・ジェネレーター：3分で3つの答えを提示
**動作フロー:**
```
入力（30秒）:
├─ ビジネスモデル: 月額サブスクリプション
├─ 顧客単価: 20,000円/月
├─ 平均契約期間: 24ヶ月 → LTV自動計算: 480,000円
├─ 許容CPA: 160,000円（LTVの1/3）
└─ パートナーへの期待: 新規顧客の紹介

出力（即座）:
├─ プランA「手堅く始める」: 売上の20%を12ヶ月間（利益率70%）
├─ プランB「有力パートナー向け」: 初期3万円+売上の10%永続（利益率51%）
└─ プランC「市場支配を狙う」: 階層型15-35%（利益率28%、シェア急拡大）
```

### 2. リアルタイムシミュレーター：スライダー1つで未来が変わる
**インタラクティブ要素:**
```
「初期ボーナスを3万円→1万円に変更」
→ 利益率: 51% → 64%（瞬時に再計算）

「月5社×6ヶ月の獲得を想定」
→ 半年後のキャッシュフロー予測グラフが即座に更新
```

### 3. API連携：データ入力の完全自動化
- Stripe: 売上データの自動取り込み
- Salesforce/HubSpot: パートナー・顧客データの同期
- 目的: CSV/手入力の完全排除

## 標準機能（基本実装）
- シンプル入力UI（Bootstrap標準）
- レポート出力（PDF/CSV）
- シナリオ保存・比較

## 成功指標
- セルフサービス完結
- サポート工数ゼロ
- スケーラブル運用

## 絶対禁止事項
- ❌ UI/UXの装飾・アニメーション
- ❌ CRM機能（パートナー管理）
- ❌ コミュニケーション機能
- ❌ 手厚いオンボーディング
- ❌ 顧客個別カスタマイズ

## アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│            ブラウザ完結型アーキテクチャ                        │
└─────────────────────────────────────────────────────────────┘

Browser (Client-Side Only):
============================
┌──────────────────────────────────────────┐
│             React UI                      │
│         (Bootstrap標準)                   │
└────────────────┬─────────────────────────┘
                 │
                 ▼
┌──────────────────────────────────────────┐
│         KuzuDB WASM Engine               │
│          (In-Memory)                      │
│  • Cypherクエリ実行                       │
│  • リアルタイム計算                        │
│  • シナリオ比較                          │
└────────────────┬─────────────────────────┘
                 │
                 ▼
┌──────────────────────────────────────────┐
│           IndexedDB                       │
│  • シミュレーション結果永続化              │
│  • シナリオ保存                          │
└──────────────────────────────────────────┘
```

**特徴**:
- サーバーレス（インフラコストゼロ）
- 完全オフライン動作可能
- データプライバシー完全保護
- 即座に利用開始可能

## 経営者の生の声×Cypherクエリが生み出す「えげつないインサイト」

### グラフDBだからこそ提供できる、7つの破壊的価値

| 経営者の生の声（悩み・疑問） | Cypherユースケース | 提供価値 |
|---|---|---|
| **「結局、どのパートナーが一番『儲かる』顧客を連れてきてるんだ？」** | **[UC1] 貢献度ランキング ✅**<br>`MATCH (p:Partner)-[:INTRODUCED]->(c:Customer)`<br>`-[:HAS_SUBSCRIPTION]->(s:Subscription)`<br>`RETURN p.name, sum(s.monthlyFee * s.duration) AS LTV合計`<br>`ORDER BY LTV合計 DESC` | 単なる顧客数ではなく、パートナーがもたらした**総LTV**でランキング。金の匂いがするパートナーが一目瞭然 |
| **「この報酬プラン、本当にウチは損してないか？払いすぎてないか？」** | **[UC2] パートナーROIの可視化**<br>顧客、パートナー、報酬プラン、契約のパスを横断し、顧客LTVからパートナーへの支払総額を差し引く | パートナー経由の顧客一人当たりの**純利益**を算出。赤字を垂れ流しているだけのパートナー契約をあぶり出す |
| **「A社に提案するプラン、XとY、どっちが最終的に儲かるんだ？」** | **[UC3] 報酬プランの未来予測シミュレーション**<br>`WITH {rate: 0.3} AS virtualPlan`<br>`MATCH (c:Customer) WHERE c.source = 'Partner'`<br>`RETURN sum(c.ltv * virtualPlan.rate) AS 予測支払額` | 現実のデータ構造を使い、仮想パラメータを適用して計算。データを汚さずに、あらゆる未来を試算 |
| **「ウチの『神』パートナーAさんが連れてくる客、なんか他と違う気がする…」** | **[UC4] 優良顧客プロファイルの抽出**<br>`MATCH (:Partner {name: 'Aさん'})-[:INTRODUCED]->(c)`<br>`RETURN c.industry, avg(c.ltv), avg(c.retentionRate)`<br>`ORDER BY avg(c.ltv) DESC` | 特定の優良パートナーが紹介する顧客群の**共通特性**（業種、規模、LTV、継続率）を分析。次にアプローチすべきパートナーの「型」が明確に |
| **「パートナー経由の客って、本当に長く使ってくれるのか？」** | **[UC5] 顧客定着率の比較分析 ✅**<br>パートナー経由 vs 直接獲得の顧客群の平均継続期間・チャーンレート比較 | パートナー経由の顧客の「質」を数値で証明。パートナープログラムへの投資判断を正当化 |
| **「最近活躍のBさん、実は神パートナーAさんと繋がりがあったりして？」** | **[UC6] パートナー間の隠れた関係性の発見**<br>`MATCH path = shortestPath(`<br>`(:Partner {name: 'A'})-[*..3]-(:Partner {name: 'B'}))` | 過去の所属企業、共通の顧客、SNSなど、あらゆる関係性を辿り、有力パートナーの派閥やコミュニティを特定 |
| **「この顧客、パートナーA経由だけど、Web広告も踏んでる。どっちの貢献？」** | **[UC7] 貢献パス（アトリビューション）の可視化**<br>`MATCH path = allShortestPaths(`<br>`(:AdCampaign)-[*]->(:Customer)<-[*]-(:Partner))` | 顧客獲得に至るまでの全タッチポイントを時系列パスとして可視化。貢献度に応じた公平な報酬配分モデルを設計 |

### なぜグラフDBなのか？
- **関係性の探索**: パートナー、顧客、契約、報酬の複雑な関係を自然に表現
- **what-if分析**: 仮想ノードを追加してもデータを汚さない柔軟なシミュレーション
- **隠れたパターン発見**: SQLでは不可能な、多段階の関係性を辿る分析

## 開発原則
**やる**: 計算ロジック集中、精度向上、API自動化
**やらない**: 機能追加衝動、個別要望、見た目

## テスト

### End-to-End テスト
Kuzu WASMの初期化と基本動作を確認:

```bash
# Puppeteerを使用したE2Eテスト実行
npm run test:e2e

# または直接実行
node test-e2e.mjs
```

**テスト内容**:
- Vite開発サーバーの自動起動
- Kuzu WASM初期化の確認  
- ping.cypherクエリの実行テスト
- 期待値 `[{"response":"pong","status":1}]` の検証
- 自動クリーンアップ

### ブラウザでの手動確認
```bash
npm run dev
# http://localhost:5173 でブラウザ確認
# F12コンソールでKuzuログ確認
```

## ドキュメント構成
- **技術仕様詳細**: [docs/TECHNICAL_SPEC.md](docs/TECHNICAL_SPEC.md)
- **制約事項詳細**: [docs/CONSTRAINTS.md](docs/CONSTRAINTS.md)

---

> **「経営者が欲しいのは『計算機』じゃない。『答え』だ。」**
> 
> 深夜2時の孤独な意思決定を、3分で終わらせる。
> それが、SaaS Partner Calculatorの存在意義。