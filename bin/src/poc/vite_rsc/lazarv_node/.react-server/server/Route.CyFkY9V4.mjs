import{K as e,O as t,P as n,d as r,h as i}from"./request.B5lbIw2_.mjs";import a from"picocolors";import{Fragment as o,jsx as s}from"react/jsx-runtime";function c(e,t=1/0){return n=>(l(t),e(n))}function l(e=1/0){e===!0&&(e=1/0),t(i,e)}const u=new Map,d=new Map;function f(e){if(u.has(e))return u.get(e);let t=[],n=``,r=!1,i=!1,a=0,o,s=0;for(let c of e)c===`{`&&!r?(n&&t.push({type:`static`,value:n}),n=`{`,r=!0):c===`}`&&r?(t.push({type:`escaped`,value:n+`}`}),n=``,r=!1):c===`[`&&!r&&!i?(n&&t.push({type:`static`,value:n}),n=`[`,i=!0,o=s,a++):c===`[`&&i?(n+=c,a++):c===`]`&&i?(a--,a===0?(t.push({type:`param`,value:n+`]`,start:o,end:s+1}),n=``,i=!1,o=null):n+=c):c===`/`&&!r&&!i?(n&&t.push({type:`static`,value:n}),t.push({type:`separator`}),n=``):n+=c,s++;return n&&t.push({type:`static`,value:n}),u.set(e,t),t}function p(e){if(d.has(e))return d.get(e);let t=f(e),n=[],r=[];for(let e of t)if(e.type===`separator`)r.length&&(n.push(r),r=[]);else if(e.type===`escaped`)r.push({type:`static`,value:e.value.slice(1,-1)});else if(e.type===`param`){let t=e.value.slice(1,-1);if(t.startsWith(`...`))r.push({type:`catchAll`,param:t.slice(3),start:e.start,end:e.end});else if(t.startsWith(`[...`)&&t.endsWith(`]`))r.push({type:`optionalCatchAll`,param:t.slice(4,-1),start:e.start,end:e.end});else if(t.startsWith(`[`)&&t.endsWith(`]`)){let[n,i]=t.slice(1,-1).split(`=`);r.push({type:`optionalParam`,param:n,matcher:i,start:e.start,end:e.end})}else{let[n,i]=t.split(`=`);r.push({type:`param`,param:n,matcher:i,start:e.start,end:e.end})}}else e.type===`static`&&r.push({type:`static`,value:e.value});return r.length&&n.push(r),d.set(e,n),n}function m(e,t,n={}){if(e===`*`)return{};let r=p(e),i=t.split(`/`).filter(Boolean),a={},o=0,s=0,c=[];for(;o<r.length;){let e=r[o],t=i[s],l=!0,u={};if(e.length>1){let r=0;for(let i=0;i<e.length;i++){let a=e[i],o=i+1,s=e[o];for(;s?.type===`param`;)s=e[++o];if(a.type===`static`){let e=t.slice(r,r+a.value.length);if(e!==a.value)return null;r+=a.value.length}else if(a.type===`param`||a.type===`optionalParam`){let e=s?t?.indexOf(s.value,r)??0:t.length,i=t?.slice(r,e)??``;if(!i&&a.type===`param`)return null;if(a.matcher&&typeof n.matchers[a.matcher]==`function`){let e=n.matchers[a.matcher];if(!e(i)){if(a.type===`param`)return null;if(a.type===`optionalParam`){l=!1;continue}}}u[a.param]=i,r=e}}s++}else for(let a of e)if(a.type===`static`){if(t!==a.value){l=!1;break}s++}else if(a.type===`param`){if(s>=i.length){l=!1;break}if(a.matcher&&typeof n.matchers[a.matcher]==`function`){let e=n.matchers[a.matcher];if(!e(i[s])){l=!1;break}}u[a.param]=i[s],s++}else if(a.type===`optionalParam`)s<i.length&&(!a.matcher||typeof n.matchers[a.matcher]==`function`&&n.matchers[a.matcher](i[s]))&&(c.push(a),u[a.param]=i[s],s++);else if(a.type===`catchAll`||a.type===`optionalCatchAll`){let e=i.slice(s);if(o<r.length-1){let t=r.slice(o+1).find(e=>e.some(e=>e.type===`static`));if(t){let n=t.find(e=>e.type===`static`).value,r=e.indexOf(n);if(r!==-1)u[a.param]=e.slice(0,r),s+=r;else if(a.type===`catchAll`){l=!1;break}}else u[a.param]=e,s=i.length}else u[a.param]=e,s=i.length;if(a.type===`catchAll`&&u[a.param].length===0){l=!1;break}}if(l)Object.assign(a,u),o++;else{if(e.some(e=>e.type===`static`)&&c.length>0){s--;let e=c.pop();e.type===`optionalParam`&&(a[e.param]=void 0);continue}let t=e.every(e=>e.type===`optionalParam`||e.type===`optionalCatchAll`);if(t)r.forEach(e=>{a[e.param]=e.type===`optionalCatchAll`?[]:void 0}),o++;else return null}}return n.exact&&s<i.length?null:a}function h(t,i={}){if(t===`*`||i.fallback)return n(e)?null:{};let{pathname:a}=r(),o=decodeURIComponent(a);return m(t,o,i)}export{h as b,l as c,c as d};