"use client";import{g as e}from"../../../rolldown-runtime.Cb5j2Qq5.mjs";import{b as t,f as n}from"../../../react.D0LEv2W_.mjs";import{c as r,d as i,e as a,f as o}from"../../../react-server/client/context.DLHwD-Lx.mjs";var s=e(n()),c=e(t());const l=(0,s.createContext)(null);function u(){let e=(0,s.useContext)(l),[t,n]=(0,s.useState)({error:null,hasError:!1}),r=(0,s.useMemo)(()=>({resetBoundary:()=>{e.resetErrorBoundary(),n({error:null,hasError:!1})},showBoundary:e=>n({error:e,hasError:!0})}),[e.resetErrorBoundary]);if(t.hasError)throw t.error;return r}const d={didCatch:!1,error:null};var f=class extends s.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=d}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}async resetErrorBoundary(...e){let{error:t}=this.state;t!==null&&(await this.props.onReset?.({args:e,reason:`imperative-api`,error:t,resetErrorBoundary:this.resetErrorBoundary}),typeof t?.digest!=`string`&&this.setState(d))}componentDidCatch(e,t){this.props.onError?.(e,t)}componentDidUpdate(e,t){let{didCatch:n}=this.state,{resetKeys:r}=this.props;if(n&&t.error!==null&&p(e.resetKeys,r))if(typeof this.props.onReset==`function`){let t=this.props.onReset({next:r,prev:e.resetKeys,reason:`keys`});typeof t?.then==`function`?t.then(()=>{this.setState(d)}):this.setState(d)}else this.setState(d)}render(){let{children:e,fallbackRender:t,FallbackComponent:n,fallback:r}=this.props,{didCatch:i,error:a}=this.state;a?.message===`Redirect`&&a?.digest.startsWith(`Location=`)&&(a.redirectTo=a.digest.slice(9));let o=e;if(i){let e={error:a,resetErrorBoundary:this.resetErrorBoundary};if(delete a.stack,typeof t==`function`)o=t(e);else if(n)o=(0,s.createElement)(n,e);else if(r===null||(0,s.isValidElement)(r))o=r;else throw a}return(0,c.jsx)(l.Provider,{value:{didCatch:i,error:a,resetErrorBoundary:this.resetErrorBoundary},children:o})}};function p(e=[],t=[]){return e.length!==t.length||e.some((e,n)=>!Object.is(e,t[n]))}function m({FallbackComponent:e,fallbackRender:t,...n}){let{outlet:r}=(0,s.useContext)(i),l=o(),{navigate:u}=l,{error:d}=n,{redirectTo:f}=d;return(0,s.useEffect)(()=>{f&&u(f,{outlet:r,external:r!==a})},[f,u,r]),f?null:(0,c.jsxs)(c.Fragment,{children:[e&&typeof e==`function`?(0,c.jsx)(e,{...n}):e,t?.(n)]})}function h({error:e}){if(e)throw e;return null}function g({component:e,render:t,onReset:n,global:a,children:l,...u}){let{outlet:d}=(0,s.useContext)(i),{resourceKey:p,error:g}=(0,s.useContext)(r),{invalidate:_}=o();return(0,c.jsxs)(f,{...u,onReset:async e=>{typeof e.error?.digest==`string`&&await _(d),n?.(e)},fallbackRender:n=>(0,c.jsx)(m,{FallbackComponent:e,fallbackRender:t,...n}),children:[(0,c.jsx)(h,{error:g}),l]},`${d}_${p}`)}export{f as ErrorBoundary,g as default,u as useErrorBoundary};