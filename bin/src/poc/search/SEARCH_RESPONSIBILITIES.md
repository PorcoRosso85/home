# 検索アダプターの責務明確化

## VSS (Vector Similarity Search) - ベクトル類似検索

### 責務
- テキストの意味的な類似性に基づく検索
- 埋め込みモデル（Ruri v3）を使用してテキストをベクトル化
- KuzuDBのVECTOR拡張機能を活用したベクトル検索

### 実装詳細
- **主要ファイル**: `vss/main.py:15-174`
- **埋め込みモデル**: cl-nagoya/ruri-v3-30m (30Mパラメータ)
- **ベクトル次元**: 256次元
- **インデックス**: KuzuDBのVECTOR拡張によるベクトルインデックス

### 使用場面
- 意味的に類似した要件の検索
- 自然言語クエリによる柔軟な検索
- 表記ゆれや同義語を含む検索

## FTS (Full Text Search) - 全文検索

### 責務
- キーワードの完全一致・部分一致による検索
- タイトルや説明文からの高速なキーワード検索
- 明確なキーワードが存在する場合の検索

### 実装詳細
- **主要ファイル**: `fts/keyword_search.py:10-42`
- **検索対象**: RequirementEntityのtitleフィールド
- **検索方式**: CONTAINS句による部分文字列検索

### 使用場面
- 特定のキーワードを含む要件の検索
- ID、タグ、固有名詞での正確な検索
- 高速な文字列マッチング

## Hybrid Search - ハイブリッド検索

### 責務
- VSSとFTSの結果を統合した包括的な検索
- 順位ベースの結果統合（スコアリングなし）
- 両方の検索手法の長所を活用

### 実装詳細
- **主要ファイル**: `hybrid/requirement_search_engine.py:10-78`
- **統合方式**: 複数ソースでマッチした要件を優先
- **結果形式**: 各要件にソース情報（vss/fts）を付与

### 使用場面
- 最も包括的な検索結果が必要な場合
- キーワードと意味の両方で関連する要件を探す場合
- 検索精度を最大化したい場合

## 依存関係

### flake.nixによる環境設定
- **Python環境**: Python 3.11
- **パッケージ管理**: uv
- **依存ライブラリ**: 
  - KuzuDB（グラフデータベース）
  - pytest（テスト）
  - ruff（リンター/フォーマッター）
- **仮想環境**: `/home/nixos/bin/src/requirement/graph/.venv`を共有

### 重要な設定
- `PYTHONPATH`: プロジェクトルートを含む
- `RGL_SKIP_SCHEMA_CHECK`: スキーマチェックのスキップ
- KuzuDBのネイティブライブラリパスの動的リンク設定

## テスト体系

1. **仕様テスト**: 各アダプターの基本仕様確認
2. **統合テスト**: VSS/FTS/Hybrid間の連携確認
3. **E2Eテスト**: エンドツーエンドのシナリオテスト
4. **TDD Redテスト**: 新機能開発用の失敗テスト