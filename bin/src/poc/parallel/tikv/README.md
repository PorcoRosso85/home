# TiKV 並列処理POC

## 概要

このプロジェクトは、TiKVの分散トランザクション機能を活用した並列処理のPOC（Proof of Concept）です。

## TiKVとMatt Weidner氏の思想の関係

TiKVはMatt Weidner氏の**「考え（思想）」そのものを実装しているわけではありません**。しかし、彼の思想の根幹である**「グローバルで唯一の順序付けされた操作ログを作る」という部分の、最も困難で厄介な問題を、TiKVの「分散トランザクション」機能が完全に解決してくれる**のです。

これを、法律の制定に例えてみましょう。

- **Matt Weidner氏の考え**: 優れた法律の歴史とは、矛盾のない「判例」が、時系列に沿ってただ一つだけ記録されたものであるべきだ、という**「法哲学」**です。

- **あなたの同期サーバー**: 実際に個々の法律（「ユーザー名は重複してはならない」「在庫がない商品は注文できない」など）を起草する**「立法府」**です。

- **TiKVの分散トランザクション**: 複数の立法府から同時に提出された法案を、**世界でただ一つの「最高裁判所の書記官」のように処理します。書記官は、法案に重複しない「判例番号」**を振り、公式な判例集に記録し、その記録が絶対に失われないことを保証します。書記官は法律の中身は作りませんが、法律が成立するプロセスに秩序と一貫性を与えます。

## 具体的に何が違うのか？

Matt Weidner氏の考えを実装するには、本来なら以下の2つのことを自前で実装しなければなりません。

### 【あなたのロジック】操作の定義とビジネスルールの検証:
- 「createNodeという操作は、nameというプロパティを持つ」といった操作の構造を定義する。
- 「createNodeを実行する前に、同じnameのノードが既に存在しないかチェックする」というビジネスルールを実装する。

### 【分散システムの難問】グローバルな順序付けと排他制御:
- 世界中のサーバーから同時にリクエストが来た時に、どの操作が先かを決定する。
- 誰かが「次の連番」を取得している最中に、他の誰も割り込めないようにする（排他制御/分散ロック）。
- この仕組み自体が、サーバーがクラッシュしても壊れないようにする（耐障害性）。

TiKVは後者の「分散システムの難問」を完全に解決してくれるため、開発者は前者の「ビジネスロジック」に集中できるのです。