# POC 21: Sidecar Pattern Exploration

## 🎯 目的

POC 12のEnvoyプロキシ実装をサイドカーパターンに進化させる

## 📋 検討項目

### 1. **サイドカープロキシの要件**
- 単一アプリケーション専用
- 環境変数による動的設定
- Pod内localhost通信

### 2. **実装すべき機能**
- 環境変数設定：
  - `BACKEND_URL`: プロキシ先のアプリURL
  - `SIDECAR_PORT`: サイドカーのリスニングポート
  - `ADMIN_PORT`: 管理用ポート
- ヘルスチェック
- メトリクス収集
- トレーシング準備

### 3. **サービスメッシュ機能**
- Circuit Breaker
- リトライロジック
- タイムアウト管理
- mTLS（将来的に）

### 4. **デプロイパターン**
```
┌─────────────────────────┐
│  Pod/Container Group    │
│ ┌─────────┐ ┌─────────┐│
│ │   App   │ │Sidecar  ││
│ │ :3000   │←│ :8080   ││
│ └─────────┘ └─────────┘│
│      ↑           ↑      │
└──────┼───────────┼──────┘
       │           │
   localhost   外部トラフィック
```

## 🚀 期待される成果

1. **透過的プロキシ**: アプリケーションコードの変更不要
2. **観測性向上**: 全トラフィックの可視化
3. **信頼性向上**: 自動リトライ、Circuit Breaker
4. **セキュリティ**: 将来的なmTLS対応

## 📝 実装タスク

- [ ] 環境変数ベースの設定システム
- [ ] 単一バックエンド向けプロキシ
- [ ] ヘルスチェック統合
- [ ] メトリクス収集
- [ ] Circuit Breaker実装
- [ ] リトライロジック
- [ ] Nix flakeでのサイドカーコンテナ定義
- [ ] デモアプリケーションとの統合テスト

## 🔗 関連POC

- POC 12: Envoyプロキシの基本実装
- POC 17: サービスメッシュ（選択済み）