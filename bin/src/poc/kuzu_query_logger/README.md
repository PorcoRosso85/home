# KuzuDB Query Logger POC

ACIDトランザクションが確定したクエリのみをログ化し、複数ノード間の同期を実現するPOC。

## 概要

このPOCは、KuzuDBのクエリログを管理し、以下の機能を提供します：

1. **ACIDトランザクション管理**
   - コミットされたトランザクションのみログ化
   - ロールバックされたトランザクションは除外
   - トランザクションの原子性を保証

2. **ログの整合性保証**
   - ログエントリの不変性（Immutability）
   - チェックサムによる改竄検知
   - 厳密な連番管理

3. **複数ノード同期**
   - プライマリからレプリカへのログ再生
   - 冪等性を保証した再生
   - 差分同期のサポート

4. **エラー処理と回復**
   - 競合の検知と処理
   - クラッシュリカバリ機能

## 使用方法

```bash
# 開発環境の起動
nix develop

# REDフェーズテストの実行（すべて失敗することを確認）
nix run .#test-red

# GREENフェーズテストの実行（すべて成功することを確認）
nix run .#test-green

# pytestでの実行
nix run .#test
```

## 実装の特徴

- TDD（Test-Driven Development）アプローチで開発
- REDフェーズ：11個のテストを作成（すべて失敗）
- GREENフェーズ：最小限の実装でテストを通過
- 型安全性：TypedDictによる型定義
- スレッドセーフ：threadingモジュールによる排他制御

## 主要クラス

- `KuzuQueryLogger`: メインのロガークラス
- `Transaction`: トランザクション管理
- `ImmutableLogEntry`: 不変性を保証するログエントリ
- `LogEntry`: ログエントリの型定義（TypedDict）

## 今後の展開

- REFACTORフェーズ：コードの改善とリファクタリング
- 実際のKuzuDBとの統合
- ディスクへの永続化実装
- ネットワーク経由での同期機能