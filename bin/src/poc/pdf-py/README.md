# PDF Text Layer Detection POC

## 責務
PDFファイルにおけるテキストレイヤーの存在/不存在を検知し、OCR必要箇所を特定するPOC実装。

## 背景
官報PDFでは縦書きテキストと画像が混在し、一部のテキストが画像として埋め込まれているため、テキスト抽出で見つからない文字列が存在する。このPOCは「千葉県佐倉市海隣寺町」のような文字列が見つからない原因を特定し、OCR必要箇所を可視化する。

## 機能
1. **テキストレイヤー領域検出**: PDFページ内のテキスト抽出可能領域を座標付きで特定
2. **画像領域検出**: 画像として埋め込まれた領域を特定
3. **OCR必要箇所判定**: テキストレイヤーが欠落している箇所を自動判定
4. **可視化マッピング**: テキスト・画像・OCR必要箇所を色分けして可視化
5. **文字列検索分析**: 特定文字列が見つからない理由を分析・推奨対応を提示

## 技術仕様
- **PyMuPDF**: PDF解析・座標取得・画像抽出
- **matplotlib**: レイヤーマッピングの可視化
- **pytest**: テスト駆動開発（TDD）

## 使用方法
```bash
# 開発環境起動
nix develop

# テスト実行（全機能の動作確認）
python -m pytest test_text_layer_detection.py -v

# デモ実行（test1.pdfでの分析・可視化）
python text_layer_detector.py
```

## 成果物
- **`test_text_layer_detection.py`**: TDD仕様テスト
- **`text_layer_detector.py`**: 検知機能実装・デモ
- **`demo_layer_mapping.png`**: テキストレイヤー可視化結果
- **動作確認済み**: test1.pdf（2128テキスト領域、2画像領域検出）

## 検証結果
「千葉県佐倉市海隣寺町」が見つからない理由：
- ✅ テキストレイヤー内に存在しない
- ✅ 画像領域が検出される
- ✅ OCR実行が必要
- ✅ 縦書きテキスト対応のOCR設定推奨