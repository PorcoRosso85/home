#!/usr/bin/env bash
# README Graph CLI Example Template
# このファイルは実行例のテンプレートです（実行しないでください）
# Usage examples for readme_graph.py, validator.py, and KuzuDB queries

# ========================================
# 1. 基本的な使用方法
# ========================================

# module.jsonファイルの探索
python crawler.py /path/to/project

# module.jsonの検証
python validator.py examples/sample_module.json

# ========================================
# 2. KuzuDB操作
# ========================================

# データベース初期化とインデックス作成
nix-shell -p python312Packages.kuzu --run "python readme_graph.py index ./example"

# 依存関係グラフ構築
nix-shell -p python312Packages.kuzu --run "python readme_graph.py deps ./example"

# 階層関係構築
nix-shell -p python312Packages.kuzu --run "python readme_graph.py hierarchy ./example"

# ========================================
# 3. クエリ実行例
# ========================================

# 特定モジュールの依存関係取得
nix-shell -p python312Packages.kuzu --run "python readme_graph.py get-deps auth-system"

# 特定モジュールに依存するモジュール取得
nix-shell -p python312Packages.kuzu --run "python readme_graph.py get-dependents database-layer"

# 循環依存の検出
nix-shell -p python312Packages.kuzu --run "python readme_graph.py circular"

# Cypherクエリ実行
nix-shell -p python312Packages.kuzu --run "python readme_graph.py query 'MATCH (m:Module) RETURN m.id, m.type, m.purpose'"

# ========================================
# 4. 高度なクエリ例
# ========================================

# 全モジュールの階層表示
nix-shell -p python312Packages.kuzu --run "python readme_graph.py query 'MATCH (m:Module) RETURN m.id, m.path ORDER BY m.path'"

# 依存関係のパス探索
nix-shell -p python312Packages.kuzu --run "python readme_graph.py query 'MATCH path = (m:Module {id: \"mfa-component\"})-[:DEPENDS_ON*]->(d:Module) RETURN path'"

# 特定タイプのモジュール検索
nix-shell -p python312Packages.kuzu --run "python readme_graph.py query 'MATCH (m:Module {type: \"service\"}) RETURN m.id, m.purpose'"

# ========================================
# 5. バリデーション例
# ========================================

# 単一ファイルの検証
python validator.py example/auth/module.json

# ディレクトリ内全module.jsonの検証
for file in $(find example -name "module.json"); do
    echo "Validating: $file"
    python validator.py "$file"
done

# ========================================
# 6. 統合ワークフロー例
# ========================================

# 完全なプロジェクト分析
workflow_example() {
    # 1. module.json探索
    python crawler.py ./example
    
    # 2. 検証
    for file in $(find example -name "module.json"); do
        python validator.py "$file" || exit 1
    done
    
    # 3. KuzuDBインデックス作成
    nix-shell -p python312Packages.kuzu --run "python readme_graph.py index ./example"
    
    # 4. グラフ構築
    nix-shell -p python312Packages.kuzu --run "python readme_graph.py deps ./example"
    nix-shell -p python312Packages.kuzu --run "python readme_graph.py hierarchy ./example"
    
    # 5. 分析
    nix-shell -p python312Packages.kuzu --run "python readme_graph.py circular"
}