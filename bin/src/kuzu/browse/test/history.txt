WITH 'v0.1.1' as target_version
MATCH (target:VersionState {version_id: target_version})
MATCH (v:VersionState)-[r:TRACKS_STATE_OF_LOCATED_ENTITY]->(l:LocationURI)
WHERE v.timestamp <= target.timestamp
AND NOT EXISTS {
  MATCH (v2:VersionState)-[r2:TRACKS_STATE_OF_LOCATED_ENTITY]->(l)
  WHERE v2.timestamp > v.timestamp
  AND v2.timestamp <= target.timestamp
}
AND r.change_type \!= 'DELETE'
RETURN count(DISTINCT l);
WITH 'v0.1.1' as target_version
MATCH (target:VersionState {version_id: target_version})
MATCH (v:VersionState)-[r:TRACKS_STATE_OF_LOCATED_ENTITY]->(l:LocationURI)
WHERE v.timestamp <= target.timestamp
AND NOT EXISTS {
  MATCH (v2:VersionState)-[r2:TRACKS_STATE_OF_LOCATED_ENTITY]->(l)
  WHERE v2.timestamp > v.timestamp
  AND v2.timestamp <= target.timestamp
}
AND r.change_type <> 'DELETE'
RETURN count(DISTINCT l);
