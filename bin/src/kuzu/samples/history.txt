CREATE (j:R {id: "j", title: "JWT", type: "library"});
CREATE (s:R {id: "s", title: "Stripe", type: "library"});
CREATE (v:V {id: "v"});
CREATE (l:L {id: "l"});
MATCH (v:V), (l:L) CREATE (v)-[:T]->(l);
MATCH (l:L), (a:R {id: "a"}) CREATE (l)-[:W]->(a);
MATCH (a:R {id: "a"}), (j:R {id: "j"}) CREATE (a)-[:D]->(j);
MATCH (a:R {id: "a"}), (s:R {id: "s"}) CREATE (a)-[:D]->(s);
MATCH (r:R)-[:D]->(d:R)
WHERE NOT EXISTS { MATCH ()-[:T]->()-[:W]->(d) }
RETURN r.title, d.title, d.type;
CREATE NODE TABLE VersionState (id STRING PRIMARY KEY, timestamp STRING, description STRING, progress_percentage FLOAT);
CREATE NODE TABLE LocationURI (id STRING PRIMARY KEY);
CREATE NODE TABLE RequirementEntity (id STRING PRIMARY KEY, title STRING);
CREATE REL TABLE TRACKS_STATE_OF_LOCATED_ENTITY (FROM VersionState TO LocationURI);
CREATE REL TABLE LOCATED_WITH_REQUIREMENT (FROM LocationURI TO RequirementEntity);
CREATE (v20:VersionState {id: "v2.0", timestamp: "2024-01-15", description: "Basic authentication service", progress_percentage: 0.0});
CREATE (v21:VersionState {id: "v2.1", timestamp: "2024-02-01", description: "Add payment processing with Stripe", progress_percentage: 0.0});
CREATE (v22:VersionState {id: "v2.2", timestamp: "2024-02-15", description: "Email and SMS notifications", progress_percentage: 0.0});
CREATE (v23:VersionState {id: "v2.3", timestamp: "2024-03-01", description: "Analytics and reporting dashboard", progress_percentage: 0.0});
CREATE (v24:VersionState {id: "v2.4", timestamp: "2024-03-15", description: "Redis cache and Prometheus metrics", progress_percentage: 0.0});
CREATE (auth_loc:LocationURI {id: "services/auth/api.py"});
CREATE (pay_loc:LocationURI {id: "services/payment/api.py"});
CREATE (notif_loc:LocationURI {id: "services/notification/api.py"});
CREATE (analytics_loc:LocationURI {id: "services/analytics/api.py"});
CREATE (cache_loc:LocationURI {id: "infrastructure/cache.py"});
CREATE (metrics_loc:LocationURI {id: "infrastructure/metrics.py"});
CREATE (auth_req:RequirementEntity {id: "req_auth", title: "Authentication Service"});
CREATE (pay_req:RequirementEntity {id: "req_payment", title: "Payment Service"});
CREATE (notif_req:RequirementEntity {id: "req_notif", title: "Notification Service"});
CREATE (analytics_req:RequirementEntity {id: "req_analytics", title: "Analytics Service"});
CREATE (perf_req:RequirementEntity {id: "req_perf", title: "Performance Optimization"});
MATCH (v:VersionState {id: "v2.0"}), (loc:LocationURI {id: "services/auth/api.py"})
CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc);
MATCH (v:VersionState {id: "v2.1"}), (loc:LocationURI {id: "services/payment/api.py"})
CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc);
MATCH (v:VersionState {id: "v2.2"}), (loc:LocationURI {id: "services/notification/api.py"})
CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc);
MATCH (v:VersionState {id: "v2.3"}), (loc:LocationURI {id: "services/analytics/api.py"})
CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc);
MATCH (v:VersionState {id: "v2.4"}), (loc:LocationURI {id: "infrastructure/cache.py"})
CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc);
MATCH (v:VersionState {id: "v2.4"}), (loc:LocationURI {id: "infrastructure/metrics.py"})
CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc);
MATCH (loc:LocationURI {id: "services/auth/api.py"}), (req:RequirementEntity {id: "req_auth"})
CREATE (loc)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (loc:LocationURI {id: "services/payment/api.py"}), (req:RequirementEntity {id: "req_payment"})
CREATE (loc)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (loc:LocationURI {id: "services/notification/api.py"}), (req:RequirementEntity {id: "req_notif"})
CREATE (loc)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (loc:LocationURI {id: "services/analytics/api.py"}), (req:RequirementEntity {id: "req_analytics"})
CREATE (loc)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (loc:LocationURI {id: "infrastructure/cache.py"}), (req:RequirementEntity {id: "req_perf"})
CREATE (loc)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (loc:LocationURI {id: "infrastructure/metrics.py"}), (req:RequirementEntity {id: "req_perf"})
CREATE (loc)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (v:VersionState)
OPTIONAL MATCH (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc:LocationURI)
OPTIONAL MATCH (loc)-[:LOCATED_WITH_REQUIREMENT]->(req:RequirementEntity)
WITH v, collect(DISTINCT loc.id) as files, collect(DISTINCT req.title) as features
RETURN
  v.id as version,
  v.timestamp as date,
  v.description as description,
  files,
  features
ORDER BY v.timestamp DESC;
CREATE NODE TABLE LocationURI (id STRING PRIMARY KEY);
CREATE NODE TABLE RequirementEntity (id STRING PRIMARY KEY, title STRING, priority STRING, requirement_type STRING, resource STRING);
CREATE NODE TABLE VersionState (id STRING PRIMARY KEY, timestamp STRING, description STRING, progress_percentage FLOAT);
CREATE REL TABLE TRACKS_STATE_OF_LOCATED_ENTITY (FROM VersionState TO LocationURI);
CREATE REL TABLE LOCATED_WITH_REQUIREMENT (FROM LocationURI TO RequirementEntity);
CREATE REL TABLE DEPENDS_ON (FROM RequirementEntity TO RequirementEntity, dependency_type STRING);
CREATE REL TABLE FOLLOWS (FROM VersionState TO VersionState);
-- v2.0: 基本的な認証サービス
CREATE (v20:VersionState {id: "v2.0", timestamp: "2024-01-15", description: "Basic auth service", progress_percentage: 0.0});
CREATE (auth_api:LocationURI {id: "services/auth/api.py"});
CREATE (auth_db:LocationURI {id: "services/auth/models.py"});
CREATE (auth_req:RequirementEntity {id: "req_auth", title: "Authentication service", priority: "high", requirement_type: "feature", resource: "user_db"});
CREATE (db_req:RequirementEntity {id: "req_postgres", title: "PostgreSQL database", priority: "high", requirement_type: "infrastructure", resource: "user_db"});
CREATE (jwt_req:RequirementEntity {id: "req_jwt", title: "JWT library", priority: "high", requirement_type: "library", resource: null});
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/models.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/auth/api.py"}), (req:RequirementEntity {id: "req_auth"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (auth:RequirementEntity {id: "req_auth"}), (db:RequirementEntity {id: "req_postgres"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(db);
MATCH (auth:RequirementEntity {id: "req_auth"}), (jwt:RequirementEntity {id: "req_jwt"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "library"}]->(jwt);
-- v2.1: 決済サービス追加
CREATE (v21:VersionState {id: "v2.1", timestamp: "2024-02-01", description: "Add payment service", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "v2.0"}), (v21:VersionState {id: "v2.1"}) CREATE (v20)-[:FOLLOWS]->(v21);
CREATE (pay_api:LocationURI {id: "services/payment/api.py"});
CREATE (pay_webhook:LocationURI {id: "services/payment/webhook.py"});
CREATE (pay_req:RequirementEntity {id: "req_payment", title: "Payment service", priority: "high", requirement_type: "feature", resource: "payment_db"});
CREATE (stripe_req:RequirementEntity {id: "req_stripe", title: "Stripe SDK", priority: "high", requirement_type: "library", resource: null});
CREATE (webhook_req:RequirementEntity {id: "req_webhook", title: "Webhook handler", priority: "medium", requirement_type: "feature", resource: null});
MATCH (v:VersionState {id: "v2.1"}), (uri:LocationURI {id: "services/payment/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.1"}), (uri:LocationURI {id: "services/payment/webhook.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/payment/api.py"}), (req:RequirementEntity {id: "req_payment"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (uri:LocationURI {id: "services/payment/webhook.py"}), (req:RequirementEntity {id: "req_webhook"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (auth:RequirementEntity {id: "req_auth"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(auth);
MATCH (pay:RequirementEntity {id: "req_payment"}), (stripe:RequirementEntity {id: "req_stripe"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "library"}]->(stripe);
MATCH (webhook:RequirementEntity {id: "req_webhook"}), (stripe:RequirementEntity {id: "req_stripe"}) CREATE (webhook)-[:DEPENDS_ON {dependency_type: "library"}]->(stripe);
CREATE (notif_api:LocationURI {id: "services/notification/api.py"});
CREATE (notif_req:RequirementEntity {id: "req_notification", title: "Notification service", priority: "medium", requirement_type: "feature", resource: "queue"});
MATCH (v:VersionState {id: "v2.2"}), (uri:LocationURI {id: "services/notification/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/notification/api.py"}), (req:RequirementEntity {id: "req_notification"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT]->(req);
-- 循環依存の作成
MATCH (pay:RequirementEntity {id: "req_payment"}), (notif:RequirementEntity {id: "req_notification"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(notif);
MATCH (notif:RequirementEntity {id: "req_notification"}), (pay:RequirementEntity {id: "req_payment"}) CREATE (notif)-[:DEPENDS_ON {dependency_type: "service"}]->(pay);
-- v2.3: 分析サービス
CREATE (v23:VersionState {id: "v2.3", timestamp: "2024-03-01", description: "Add analytics service", progress_percentage: 0.0});
MATCH (v22:VersionState {id: "v2.2"}), (v23:VersionState {id: "v2.3"}) CREATE (v22)-[:FOLLOWS]->(v23);
CREATE (analytics_api:LocationURI {id: "services/analytics/api.py"});
CREATE (analytics_req:RequirementEntity {id: "req_analytics", title: "Analytics service", priority: "low", requirement_type: "feature", resource: "analytics_db"});
MATCH (v:VersionState {id: "v2.3"}), (uri:LocationURI {id: "services/analytics/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/analytics/api.py"}), (req:RequirementEntity {id: "req_analytics"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT]->(req);
-- v2.4: 性能改善
CREATE (v24:VersionState {id: "v2.4", timestamp: "2024-03-15", description: "Performance improvements", progress_percentage: 0.0});
MATCH (v23:VersionState {id: "v2.3"}), (v24:VersionState {id: "v2.4"}) CREATE (v23)-[:FOLLOWS]->(v24);
CREATE (cache_layer:LocationURI {id: "infrastructure/cache.py"});
CREATE (metrics_api:LocationURI {id: "infrastructure/metrics.py"});
MATCH (v:VersionState {id: "v2.4"}), (uri:LocationURI {id: "infrastructure/cache.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.4"}), (uri:LocationURI {id: "infrastructure/metrics.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
CREATE NODE TABLE R (id STRING PRIMARY KEY, title STRING);
CREATE REL TABLE D (FROM R TO R);
CREATE (p:R {id: "p", title: "Payment"});
CREATE (n:R {id: "n", title: "Notification"});
MATCH (p:R {id: "p"}), (n:R {id: "n"}) CREATE (p)-[:D]->(n);
MATCH (n:R {id: "n"}), (p:R {id: "p"}) CREATE (n)-[:D]->(p);
MATCH path = (r:R)-[:D*2..]->(r) RETURN [node in nodes(path) | node.title] as cycle;
CREATE NODE TABLE R (id STRING PRIMARY KEY, title STRING, type STRING);
CREATE NODE TABLE L (id STRING PRIMARY KEY);
CREATE NODE TABLE V (id STRING PRIMARY KEY);
CREATE REL TABLE D (FROM R TO R);
CREATE REL TABLE T (FROM V TO L);
CREATE REL TABLE W (FROM L TO R);
CREATE (a:R {id: "a", title: "Auth", type: "feature"});
CREATE (j:R {id: "j", title: "JWT", type: "library"});
CREATE (s:R {id: "s", title: "Stripe", type: "library"});
CREATE (v:V {id: "v"});
CREATE (l:L {id: "l"});
MATCH (v:V), (l:L) CREATE (v)-[:T]->(l);
MATCH (l:L), (a:R {id: "a"}) CREATE (l)-[:W]->(a);
MATCH (a:R {id: "a"}), (j:R {id: "j"}) CREATE (a)-[:D]->(j);
MATCH (a:R {id: "a"}), (s:R {id: "s"}) CREATE (a)-[:D]->(s);
MATCH (r:R)-[:D]->(d:R)
WHERE NOT EXISTS { MATCH ()-[:T]->()-[:W]->(d) }
RETURN r.title, d.title, d.type;
CREATE NODE TABLE VersionState (id STRING PRIMARY KEY, timestamp STRING, description STRING, progress_percentage FLOAT);
CREATE NODE TABLE LocationURI (id STRING PRIMARY KEY);
CREATE NODE TABLE RequirementEntity (id STRING PRIMARY KEY, title STRING);
CREATE REL TABLE TRACKS_STATE_OF_LOCATED_ENTITY (FROM VersionState TO LocationURI);
CREATE REL TABLE LOCATED_WITH_REQUIREMENT (FROM LocationURI TO RequirementEntity);
CREATE (v20:VersionState {id: "v2.0", timestamp: "2024-01-15", description: "Basic authentication service", progress_percentage: 0.0});
CREATE (v21:VersionState {id: "v2.1", timestamp: "2024-02-01", description: "Add payment processing with Stripe", progress_percentage: 0.0});
CREATE (v22:VersionState {id: "v2.2", timestamp: "2024-02-15", description: "Email and SMS notifications", progress_percentage: 0.0});
CREATE (v23:VersionState {id: "v2.3", timestamp: "2024-03-01", description: "Analytics and reporting dashboard", progress_percentage: 0.0});
CREATE (v24:VersionState {id: "v2.4", timestamp: "2024-03-15", description: "Redis cache and Prometheus metrics", progress_percentage: 0.0});
CREATE (auth_loc:LocationURI {id: "services/auth/api.py"});
CREATE (pay_loc:LocationURI {id: "services/payment/api.py"});
CREATE (notif_loc:LocationURI {id: "services/notification/api.py"});
CREATE (analytics_loc:LocationURI {id: "services/analytics/api.py"});
CREATE (cache_loc:LocationURI {id: "infrastructure/cache.py"});
CREATE (metrics_loc:LocationURI {id: "infrastructure/metrics.py"});
CREATE (auth_req:RequirementEntity {id: "req_auth", title: "Authentication Service"});
CREATE (pay_req:RequirementEntity {id: "req_payment", title: "Payment Service"});
CREATE (notif_req:RequirementEntity {id: "req_notif", title: "Notification Service"});
CREATE (analytics_req:RequirementEntity {id: "req_analytics", title: "Analytics Service"});
CREATE (perf_req:RequirementEntity {id: "req_perf", title: "Performance Optimization"});
MATCH (v:VersionState {id: "v2.0"}), (loc:LocationURI {id: "services/auth/api.py"})
CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc);
MATCH (v:VersionState {id: "v2.1"}), (loc:LocationURI {id: "services/payment/api.py"})
CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc);
MATCH (v:VersionState {id: "v2.2"}), (loc:LocationURI {id: "services/notification/api.py"})
CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc);
MATCH (v:VersionState {id: "v2.3"}), (loc:LocationURI {id: "services/analytics/api.py"})
CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc);
MATCH (v:VersionState {id: "v2.4"}), (loc:LocationURI {id: "infrastructure/cache.py"})
CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc);
MATCH (v:VersionState {id: "v2.4"}), (loc:LocationURI {id: "infrastructure/metrics.py"})
CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc);
MATCH (loc:LocationURI {id: "services/auth/api.py"}), (req:RequirementEntity {id: "req_auth"})
CREATE (loc)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (loc:LocationURI {id: "services/payment/api.py"}), (req:RequirementEntity {id: "req_payment"})
CREATE (loc)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (loc:LocationURI {id: "services/notification/api.py"}), (req:RequirementEntity {id: "req_notif"})
CREATE (loc)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (loc:LocationURI {id: "services/analytics/api.py"}), (req:RequirementEntity {id: "req_analytics"})
CREATE (loc)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (loc:LocationURI {id: "infrastructure/cache.py"}), (req:RequirementEntity {id: "req_perf"})
CREATE (loc)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (loc:LocationURI {id: "infrastructure/metrics.py"}), (req:RequirementEntity {id: "req_perf"})
CREATE (loc)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (v:VersionState)
OPTIONAL MATCH (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc:LocationURI)
OPTIONAL MATCH (loc)-[:LOCATED_WITH_REQUIREMENT]->(req:RequirementEntity)
WITH v, collect(DISTINCT loc.id) as files, collect(DISTINCT req.title) as features
RETURN
  v.id as version,
  v.timestamp as date,
  v.description as description,
  files,
  features
ORDER BY v.timestamp DESC;
CREATE NODE TABLE R (id STRING PRIMARY KEY, title STRING);
CREATE REL TABLE D (FROM R TO R);
CREATE (p:R {id: "p", title: "Payment"});
CREATE (n:R {id: "n", title: "Notification"});
MATCH (p:R {id: "p"}), (n:R {id: "n"}) CREATE (p)-[:D]->(n);
MATCH (n:R {id: "n"}), (p:R {id: "p"}) CREATE (n)-[:D]->(p);
MATCH path = (r:R)-[:D*2..]->(r) RETURN [node in nodes(path) | node.title] as circular_dependency;
CREATE NODE TABLE R (id STRING PRIMARY KEY, title STRING, type STRING);
CREATE NODE TABLE L (id STRING PRIMARY KEY);
CREATE NODE TABLE V (id STRING PRIMARY KEY);
CREATE REL TABLE D (FROM R TO R);
CREATE REL TABLE T (FROM V TO L);
CREATE REL TABLE W (FROM L TO R);
CREATE (a:R {id: "a", title: "Auth", type: "feature"});
CREATE (j:R {id: "j", title: "JWT", type: "library"});
CREATE (s:R {id: "s", title: "Stripe", type: "library"});
CREATE (v:V {id: "v"});
CREATE (l:L {id: "l"});
MATCH (v:V), (l:L) CREATE (v)-[:T]->(l);
MATCH (l:L), (a:R {id: "a"}) CREATE (l)-[:W]->(a);
MATCH (a:R {id: "a"}), (j:R {id: "j"}) CREATE (a)-[:D]->(j);
MATCH (a:R {id: "a"}), (s:R {id: "s"}) CREATE (a)-[:D]->(s);
MATCH (r:R)-[:D]->(d:R)
WHERE NOT EXISTS { MATCH ()-[:T]->()-[:W]->(d) }
RETURN r.title as requirement, d.title as missing_dep, d.type;
CREATE NODE TABLE R (id STRING PRIMARY KEY, title STRING);
CREATE REL TABLE D (FROM R TO R);
CREATE (p:R {id: "p", title: "Payment"});
CREATE (n:R {id: "n", title: "Notification"});
MATCH (p:R {id: "p"}), (n:R {id: "n"}) CREATE (p)-[:D]->(n);
MATCH (n:R {id: "n"}), (p:R {id: "p"}) CREATE (n)-[:D]->(p);
MATCH path = (r:R)-[:D*2..]->(r) RETURN [node in nodes(path) | node.title] as cycle;
CREATE NODE TABLE R (id STRING PRIMARY KEY, title STRING, type STRING);
CREATE NODE TABLE L (id STRING PRIMARY KEY);
CREATE NODE TABLE V (id STRING PRIMARY KEY);
CREATE REL TABLE D (FROM R TO R);
CREATE REL TABLE T (FROM V TO L);
CREATE REL TABLE W (FROM L TO R);
CREATE (a:R {id: "a", title: "Auth", type: "feature"});
CREATE (j:R {id: "j", title: "JWT", type: "library"});
CREATE (v:V {id: "v"});
CREATE (l:L {id: "l"});
MATCH (v:V), (l:L) CREATE (v)-[:T]->(l);
MATCH (l:L), (a:R {id: "a"}) CREATE (l)-[:W]->(a);
MATCH (a:R {id: "a"}), (j:R {id: "j"}) CREATE (a)-[:D]->(j);
MATCH (r:R)-[:D]->(d:R)
WHERE NOT EXISTS { MATCH ()-[:T]->()-[:W]->(d) }
RETURN r.title, d.title, d.type;
CREATE NODE TABLE R (id STRING PRIMARY KEY, title STRING);
CREATE REL TABLE D (FROM R TO R);
CREATE (p:R {id: "p", title: "Payment"});
CREATE (n:R {id: "n", title: "Notification"});
MATCH (p:R {id: "p"}), (n:R {id: "n"}) CREATE (p)-[:D]->(n);
MATCH (n:R {id: "n"}), (p:R {id: "p"}) CREATE (n)-[:D]->(p);
MATCH path = (r:R)-[:D*2..]->(r) RETURN [node in nodes(path) | node.title] as cycle;
CREATE NODE TABLE R (id STRING PRIMARY KEY, title STRING);
CREATE REL TABLE D (FROM R TO R);
CREATE (p:R {id: "p", title: "Payment"});
CREATE (n:R {id: "n", title: "Notification"});
MATCH (p:R {id: "p"}), (n:R {id: "n"}) CREATE (p)-[:D]->(n);
MATCH (n:R {id: "n"}), (p:R {id: "p"}) CREATE (n)-[:D]->(p);
MATCH path = (r:R)-[:D*2..]->(r) RETURN path;
CREATE NODE TABLE V (id STRING PRIMARY KEY, date STRING, desc STRING);
CREATE (v1:V {id: "v2.0", date: "2024-01-15", desc: "Auth"});
CREATE (v2:V {id: "v2.1", date: "2024-02-01", desc: "Payment"});
CREATE (v3:V {id: "v2.2", date: "2024-02-15", desc: "Notification"});
CREATE (v4:V {id: "v2.3", date: "2024-03-01", desc: "Analytics"});
CREATE (v5:V {id: "v2.4", date: "2024-03-15", desc: "Performance"});
MATCH (v:V) RETURN v.id, v.date, v.desc ORDER BY v.date DESC;
CREATE NODE TABLE V (id STRING PRIMARY KEY, date STRING, info STRING);
CREATE (v1:V {id: "v2.0", date: "2024-01-15", info: "Auth"});
CREATE (v2:V {id: "v2.1", date: "2024-02-01", info: "Payment"});
CREATE (v3:V {id: "v2.2", date: "2024-02-15", info: "Notification"});
CREATE (v4:V {id: "v2.3", date: "2024-03-01", info: "Analytics"});
CREATE (v5:V {id: "v2.4", date: "2024-03-15", info: "Performance"});
MATCH (v:V) RETURN v.id, v.date, v.info ORDER BY v.date DESC;
CREATE NODE TABLE LocationURI (id STRING PRIMARY KEY);
CREATE NODE TABLE RequirementEntity (id STRING PRIMARY KEY, title STRING, priority STRING, requirement_type STRING, resource STRING);
CREATE NODE TABLE VersionState (id STRING PRIMARY KEY, timestamp STRING, description STRING, progress_percentage FLOAT);
CREATE REL TABLE TRACKS_STATE_OF_LOCATED_ENTITY (FROM VersionState TO LocationURI);
CREATE REL TABLE LOCATED_WITH_REQUIREMENT (FROM LocationURI TO RequirementEntity);
CREATE REL TABLE DEPENDS_ON (FROM RequirementEntity TO RequirementEntity, dependency_type STRING);
CREATE REL TABLE FOLLOWS (FROM VersionState TO VersionState);
CREATE (v20:VersionState {id: "v2.0", timestamp: "2024-01-15", description: "Basic auth service", progress_percentage: 0.0});
CREATE (auth_api:LocationURI {id: "services/auth/api.py"});
CREATE (auth_db:LocationURI {id: "services/auth/models.py"});
CREATE (auth_req:RequirementEntity {id: "req_auth", title: "Authentication service", priority: "high", requirement_type: "feature", resource: "user_db"});
CREATE (db_req:RequirementEntity {id: "req_postgres", title: "PostgreSQL database", priority: "high", requirement_type: "infrastructure", resource: "user_db"});
CREATE (jwt_req:RequirementEntity {id: "req_jwt", title: "JWT library", priority: "high", requirement_type: "library", resource: null});
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/models.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/auth/api.py"}), (req:RequirementEntity {id: "req_auth"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (auth:RequirementEntity {id: "req_auth"}), (db:RequirementEntity {id: "req_postgres"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(db);
MATCH (auth:RequirementEntity {id: "req_auth"}), (jwt:RequirementEntity {id: "req_jwt"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "library"}]->(jwt);
CREATE (v21:VersionState {id: "v2.1", timestamp: "2024-02-01", description: "Add payment service", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "v2.0"}), (v21:VersionState {id: "v2.1"}) CREATE (v20)-[:FOLLOWS]->(v21);
CREATE (pay_api:LocationURI {id: "services/payment/api.py"});
CREATE (pay_webhook:LocationURI {id: "services/payment/webhook.py"});
CREATE (pay_req:RequirementEntity {id: "req_payment", title: "Payment service", priority: "high", requirement_type: "feature", resource: "payment_db"});
CREATE (stripe_req:RequirementEntity {id: "req_stripe", title: "Stripe SDK", priority: "high", requirement_type: "library", resource: null});
CREATE (webhook_req:RequirementEntity {id: "req_webhook", title: "Webhook handler", priority: "medium", requirement_type: "feature", resource: null});
MATCH (v:VersionState {id: "v2.1"}), (uri:LocationURI {id: "services/payment/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.1"}), (uri:LocationURI {id: "services/payment/webhook.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/payment/api.py"}), (req:RequirementEntity {id: "req_payment"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (uri:LocationURI {id: "services/payment/webhook.py"}), (req:RequirementEntity {id: "req_webhook"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (auth:RequirementEntity {id: "req_auth"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(auth);
MATCH (pay:RequirementEntity {id: "req_payment"}), (stripe:RequirementEntity {id: "req_stripe"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "library"}]->(stripe);
MATCH (webhook:RequirementEntity {id: "req_webhook"}), (stripe:RequirementEntity {id: "req_stripe"}) CREATE (webhook)-[:DEPENDS_ON {dependency_type: "library"}]->(stripe);
CREATE (v22:VersionState {id: "v2.2", timestamp: "2024-02-15", description: "Add notification service", progress_percentage: 0.0});
MATCH (v21:VersionState {id: "v2.1"}), (v22:VersionState {id: "v2.2"}) CREATE (v21)-[:FOLLOWS]->(v22);
CREATE (notif_api:LocationURI {id: "services/notification/api.py"});
CREATE (notif_req:RequirementEntity {id: "req_notification", title: "Notification service", priority: "medium", requirement_type: "feature", resource: "queue"});
MATCH (v:VersionState {id: "v2.2"}), (uri:LocationURI {id: "services/notification/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/notification/api.py"}), (req:RequirementEntity {id: "req_notification"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (notif:RequirementEntity {id: "req_notification"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(notif);
MATCH (notif:RequirementEntity {id: "req_notification"}), (pay:RequirementEntity {id: "req_payment"}) CREATE (notif)-[:DEPENDS_ON {dependency_type: "service"}]->(pay);
MATCH path = (req:RequirementEntity)-[:DEPENDS_ON*2..]->(req)
RETURN [node in nodes(path) | node.title] as circular_dependency_path;
// 階層型トレーサビリティモデル - スキーマ定義
// ===== ノードテーブル =====
// 1. LocationURIノード - コードや要件の場所情報を保持するノード
// REFACTORED: 最小化（uri_id→id, 7プロパティ→1プロパティ）
// scheme, authority, path, fragment, query, completed は id から派生可能
CREATE NODE TABLE LocationURI (
  id STRING PRIMARY KEY
);
// 2. CodeEntityノード - コードの構成要素（関数、クラス、メソッド等）
CREATE NODE TABLE CodeEntity (
  persistent_id STRING PRIMARY KEY,
  name STRING,
  type STRING,
  signature STRING,
  complexity INT64,
  start_position INT64,
  end_position INT64
);
// 3. RequirementEntityノード - システム要件
CREATE NODE TABLE RequirementEntity (
  id STRING PRIMARY KEY,
  title STRING,
  description STRING,
  priority STRING,
  requirement_type STRING,
  verification_required BOOLEAN DEFAULT true
);
// 4. VersionStateノード - バージョン管理情報
CREATE NODE TABLE VersionState (
  id STRING PRIMARY KEY,
  timestamp STRING,
  description STRING,
  change_reason STRING,
  progress_percentage FLOAT
);
// 5. ReferenceEntityノード - 外部参照情報
CREATE NODE TABLE ReferenceEntity (
  id STRING PRIMARY KEY,
  description STRING,
  // DEPRECATED: uriプロパティとurlプロパティは使用禁止となりました
  // uri STRING, -- 削除
  type STRING,
  source_type STRING
);
// 6. RequirementVerificationノード - 削除（IS_VERIFIED_BY関係で代替）
// 7. EntityAggregationViewノード - URI階層から上位構造を生成・集計
CREATE NODE TABLE EntityAggregationView (
  id STRING PRIMARY KEY,
  view_type STRING
);
// ===== エッジテーブル =====
// 1. LOCATED_WITH: 位置情報とエンティティの関連付け（統一版）
// LocationURIから各種エンティティへの関係を表す
CREATE REL TABLE LOCATED_WITH (
  FROM LocationURI TO CodeEntity,
  entity_type STRING
);
// 2. LOCATED_WITH_REQUIREMENT: 位置情報と要件エンティティの関連付け
CREATE REL TABLE LOCATED_WITH_REQUIREMENT (
  FROM LocationURI TO RequirementEntity,
  entity_type STRING
);
// 3. LOCATED_WITH_REFERENCE: 位置情報と参照エンティティの関連付け
CREATE REL TABLE LOCATED_WITH_REFERENCE (
  FROM LocationURI TO ReferenceEntity,
  entity_type STRING
);
// 4. IS_IMPLEMENTED_BY: 要件の実装関係
CREATE REL TABLE IS_IMPLEMENTED_BY (
  FROM RequirementEntity TO CodeEntity,
  implementation_type STRING
);
// 5. IS_VERIFIED_BY: 要件の検証関係
CREATE REL TABLE IS_VERIFIED_BY (
  FROM RequirementEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
// 6. DEPENDS_ON: 要件間の依存関係
CREATE REL TABLE DEPENDS_ON (
  FROM RequirementEntity TO RequirementEntity,
  dependency_type STRING
);
// 7. REFERENCES_CODE: コード間参照関係
CREATE REL TABLE REFERENCES_CODE (
  FROM CodeEntity TO CodeEntity,
  ref_type STRING
);
// 8. REFERS_TO: 外部参照への関係
// FIXME: 旧名称 "REFERENCES_EXTERNAL" から変更。コードエンティティが参照エンティティを参照する関係を表現
CREATE REL TABLE REFERS_TO (
  FROM CodeEntity TO ReferenceEntity,
  ref_type STRING
);
// 9. VERIFIED_BY: 削除（IS_VERIFIED_BY関係で代替）
// 10. TESTS: テストコードが実装コードをテストする関係
CREATE REL TABLE TESTS (
  FROM CodeEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
// 11. CONTAINS_LOCATION: 位置情報間の階層関係
CREATE REL TABLE CONTAINS_LOCATION (
  FROM LocationURI TO LocationURI,
  relation_type STRING
);
// 11. CONTAINS_CODE: コードエンティティ間の階層関係
CREATE REL TABLE CONTAINS_CODE (
  FROM CodeEntity TO CodeEntity
);
// 12. FOLLOWS: バージョン間の順序関係
CREATE REL TABLE FOLLOWS (
  FROM VersionState TO VersionState
);
// 13. TRACKS_STATE_OF_LOCATED_ENTITY: バージョンと位置情報の状態追跡
// LocationURIを介してエンティティの状態を追跡する
CREATE REL TEGATES_REQ (
  FROM EntityAggregationView TO RequirementEntity,
  aggregation_method STRING
);
// 16. AGGREGATES_CODE: コードの集計関係
CREATE REL TABLE AGGREGATES_CODE (
  FROM EntityAggregationView TO CodeEntity,
  aggregation_method STRING
);
CREATE (v20:VersionState {id: "v2.0", timestamp: "2024-01-15", description: "Basic auth service", progress_percentage: 0.0});
CREATE (auth_api:LocationURI {id: "services/auth/api.py"});
CREATE (auth_db:LocationURI {id: "services/auth/models.py"});
CREATE (auth_req:RequirementEntity {id: "req_auth", title: "Authentication service", priority: "high", requirement_type: "feature", resource: "user_db"});
CREATE (db_req:RequirementEntity {id: "req_postgres", title: "PostgreSQL database", priority: "high", requirement_type: "infrastructure", resource: "user_db"});
CREATE (jwt_req:RequirementEntity {id: "req_jwt", title: "JWT library", priority: "high", requirement_type: "library", resource: null});
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/models.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/auth/api.py"}), (req:RequirementEntity {id: "req_auth"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (auth:RequirementEntity {id: "req_auth"}), (db:RequirementEntity {id: "req_postgres"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(db);
MATCH (auth:RequirementEntity {id: "req_auth"}), (jwt:RequirementEntity {id: "req_jwt"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "library"}]->(jwt);
CREATE (v21:VersionState {id: "v2.1", timestamp: "2024-02-01", description: "Add payment service", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "v2.0"}), (v21:VersionState {id: "v2.1"}) CREATE (v20)-[:FOLLOWS]->(v21);
CREATE (pay_api:LocationURI {id: "services/payment/api.py"});
CREATE (pay_webhook:LocationURI {id: "services/payment/webhook.py"});
CREATE (pay_req:RequirementEntity {id: "req_payment", title: "Payment service", priority: "high", requirement_type: "feature", resource: "payment_db"});
CREATE (stripe_req:RequirementEntity {id: "req_stripe", title: "Stripe SDK", priority: "high", requirement_type: "library", resource: null});
CREATE (webhook_req:RequirementEntity {id: "req_webhook", title: "Webhook handler", priority: "medium", requirement_type: "feature", resource: null});
MATCH (v:VersionState {id: "v2.1"}), (uri:LocationURI {id: "services/payment/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.1"}), (uri:LocationURI {id: "services/payment/webhook.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/payment/api.py"}), (req:RequirementEntity {id: "req_payment"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (uri:LocationURI {id: "services/payment/webhook.py"}), (req:RequirementEntity {id: "req_webhook"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (auth:RequirementEntity {id: "req_auth"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(auth);
MATCH (pay:RequirementEntity {id: "req_payment"}), (stripe:RequirementEntity {id: "req_stripe"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "library"}]->(stripe);
MATCH (webhook:RequirementEntity {id: "req_webhook"}), (stripe:RequirementEntity {id: "req_stripe"}) CREATE (webhook)-[:DEPENDS_ON {dependency_type: "library"}]->(stripe);
CREATE (v22:VersionState {id: "v2.2", timestamp: "2024-02-15", description: "Add notification service", progress_percentage: 0.0});
MATCH (v21:VersionState {id: "v2.1"}), (v22:VersionState {id: "v2.2"}) CREATE (v21)-[:FOLLOWS]->(v22);
CREATE (notif_api:LocationURI {id: "services/notification/api.py"});
CREATE (notif_req:RequirementEntity {id: "req_notification", title: "Notification service", priority: "medium", requirement_type: "feature", resource: "queue"});
MATCH (v:VersionState {id: "v2.2"}), (uri:LocationURI {id: "services/notification/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/notification/api.py"}), (req:RequirementEntity {id: "req_notification"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (notif:RequirementEntity {id: "req_notification"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(notif);
MATCH (notif:RequirementEntity {id: "req_notification"}), (pay:RequirementEntity {id: "req_payment"}) CREATE (notif)-[:DEPENDS_ON {dependency_type: "service"}]->(pay);
CREATE NODE TABLE LocationURI (
  id STRING PRIMARY KEY
);
CREATE NODE TABLE CodeEntity (
  persistent_id STRING PRIMARY KEY,
  name STRING,
  type STRING,
  signature STRING,
  complexity INT64,
  start_position INT64,
  end_position INT64
);
CREATE NODE TABLE RequirementEntity (
  id STRING PRIMARY KEY,
  title STRING,
  description STRING,
  priority STRING,
  requirement_type STRING,
  verification_required BOOLEAN DEFAULT true
);
CREATE NODE TABLE VersionState (
  id STRING PRIMARY KEY,
  timestamp STRING,
  description STRING,
  change_reason STRING,
  progress_percentage FLOAT
);
CREATE NODE TABLE ReferenceEntity (
  id STRING PRIMARY KEY,
  description STRING,
  // DEPRECATED: uriプロパティとurlプロパティは使用禁止となりました
  // uri STRING, -- 削除
  type STRING,
  source_type STRING
);
CREATE NODE TABLE EntityAggregationView (
  id STRING PRIMARY KEY,
  view_type STRING
);
CREATE REL TABLE LOCATED_WITH (
  FROM LocationURI TO CodeEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REQUIREMENT (
  FROM LocationURI TO RequirementEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REFERENCE (
  FROM LocationURI TO ReferenceEntity,
  entity_type STRING
);
CREATE REL TABLE IS_IMPLEMENTED_BY (
  FROM RequirementEntity TO CodeEntity,
  implementation_type STRING
);
CREATE REL TABLE IS_VERIFIED_BY (
  FROM RequirementEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE DEPENDS_ON (
  FROM RequirementEntity TO RequirementEntity,
  dependency_type STRING
);
CREATE REL TABLE REFERENCES_CODE (
  FROM CodeEntity TO CodeEntity,
  ref_type STRING
);
CREATE REL TABLE REFERS_TO (
  FROM CodeEntity TO ReferenceEntity,
  ref_type STRING
);
CREATE REL TABLE TESTS (
  FROM CodeEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE CONTAINS_LOCATION (
  FROM LocationURI TO LocationURI,
  relation_type STRING
);
CREATE REL TABLE CONTAINS_CODE (
  FROM CodeEntity TO CodeEntity
);
CREATE REL TABLE FOLLOWS (
  FROM VersionState TO VersionState
);
CREATE REL TABLE TRACKS_STATE_OF_LOCATED_ENTITY (
  FROM VersionState TO LocationURI
);
CREATE REL TABLE USES (
  FROM EntityAggregationView TO LocationURI
);
CREATE REL TABLE AGGREGATES_REQ (
  FROM EntityAggregationView TO RequirementEntity,
  aggregation_method STRING
);
CREATE REL TABLE AGGREGATES_CODE (
  FROM EntityAggregationView TO CodeEntity,
  aggregation_method STRING
);
CREATE (v20:VersionState {id: "v2.0", timestamp: "2024-01-15", description: "Basic auth service", change_reason: "Initial release", progress_percentage: 0.0});
CREATE (auth_api:LocationURI {id: "services/auth/api.py"});
CREATE (auth_db:LocationURI {id: "services/auth/models.py"});
CREATE (auth_req:RequirementEntity {id: "req_auth", title: "Authentication service", description: "User authentication with JWT", priority: "high", requirement_type: "feature"});
CREATE (db_req:RequirementEntity {id: "req_postgres", title: "PostgreSQL database", description: "Primary database", priority: "high", requirement_type: "infrastructure"});
CREATE (jwt_req:RequirementEntity {id: "req_jwt", title: "JWT library", description: "Token generation", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/models.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/auth/api.py"}), (req:RequirementEntity {id: "req_auth"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (auth:RequirementEntity {id: "req_auth"}), (db:RequirementEntity {id: "req_postgres"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(db);
MATCH (auth:RequirementEntity {id: "req_auth"}), (jwt:RequirementEntity {id: "req_jwt"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "library"}]->(jwt);
CREATE (v21:VersionState {id: "v2.1", timestamp: "2024-02-01", description: "Add payment service", change_reason: "Payment integration", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "v2.0"}), (v21:VersionState {id: "v2.1"}) CREATE (v20)-[:FOLLOWS]->(v21);
CREATE (pay_api:LocationURI {id: "services/payment/api.py"});
CREATE (pay_webhook:LocationURI {id: "services/payment/webhook.py"});
CREATE (pay_req:RequirementEntity {id: "req_payment", title: "Payment service", description: "Stripe payment processing", priority: "high", requirement_type: "feature"});
CREATE (stripe_req:RequirementEntity {id: "req_stripe", title: "Stripe SDK", description: "Stripe API integration", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "v2.1"}), (uri:LocationURI {id: "services/payment/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.1"}), (uri:LocationURI {id: "services/payment/webhook.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/payment/api.py"}), (req:RequirementEntity {id: "req_payment"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (auth:RequirementEntity {id: "req_auth"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(auth);
MATCH (pay:RequirementEntity {id: "req_payment"}), (stripe:RequirementEntity {id: "req_stripe"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "library"}]->(stripe);
CREATE (v22:VersionState {id: "v2.2", timestamp: "2024-02-15", description: "Add notification service", change_reason: "Email/SMS notifications", progress_percentage: 0.0});
MATCH (v21:VersionState {id: "v2.1"}), (v22:VersionState {id: "v2.2"}) CREATE (v21)-[:FOLLOWS]->(v22);
CREATE (notif_api:LocationURI {id: "services/notification/api.py"});
CREATE (notif_req:RequirementEntity {id: "req_notification", title: "Notification service", description: "Email and SMS notifications", priority: "medium", requirement_type: "feature"});
MATCH (v:VersionState {id: "v2.2"}), (uri:LocationURI {id: "services/notification/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/notification/api.py"}), (req:RequirementEntity {id: "req_notification"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (notif:RequirementEntity {id: "req_notification"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(notif);
MATCH (notif:RequirementEntity {id: "req_notification"}), (pay:RequirementEntity {id: "req_payment"}) CREATE (notif)-[:DEPENDS_ON {dependency_type: "service"}]->(pay);
MATCH path = (req:RequirementEntity)-[:DEPENDS_ON*2..]->(req)
RETURN [node in nodes(path) | node.title] as circular_dependency_path;
MATCH path = (req:RequirementEntity)-[:DEPENDS_ON*2..]->(req)
RETURN req.title as circular_dependency;
CREATE NODE TABLE LocationURI (
  id STRING PRIMARY KEY
);
CREATE NODE TABLE CodeEntity (
  persistent_id STRING PRIMARY KEY,
  name STRING,
  type STRING,
  signature STRING,
  complexity INT64,
  start_position INT64,
  end_position INT64
);
CREATE NODE TABLE RequirementEntity (
  id STRING PRIMARY KEY,
  title STRING,
  description STRING,
  priority STRING,
  requirement_type STRING,
  verification_required BOOLEAN DEFAULT true
);
CREATE NODE TABLE VersionState (
  id STRING PRIMARY KEY,
  timestamp STRING,
  description STRING,
  change_reason STRING,
  progress_percentage FLOAT
);
CREATE NODE TABLE ReferenceEntity (
  id STRING PRIMARY KEY,
  description STRING,
  // DEPRECATED: uriプロパティとurlプロパティは使用禁止となりました
  // uri STRING, -- 削除
  type STRING,
  source_type STRING
);
CREATE NODE TABLE EntityAggregationView (
  id STRING PRIMARY KEY,
  view_type STRING
);
CREATE REL TABLE LOCATED_WITH (
  FROM LocationURI TO CodeEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REQUIREMENT (
  FROM LocationURI TO RequirementEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REFERENCE (
  FROM LocationURI TO ReferenceEntity,
  entity_type STRING
);
CREATE REL TABLE IS_IMPLEMENTED_BY (
  FROM RequirementEntity TO CodeEntity,
  implementation_type STRING
);
CREATE REL TABLE IS_VERIFIED_BY (
  FROM RequirementEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE DEPENDS_ON (
  FROM RequirementEntity TO RequirementEntity,
  dependency_type STRING
);
CREATE REL TABLE REFERENCES_CODE (
  FROM CodeEntity TO CodeEntity,
  ref_type STRING
);
CREATE REL TABLE REFERS_TO (
  FROM CodeEntity TO ReferenceEntity,
  ref_type STRING
);
CREATE REL TABLE TESTS (
  FROM CodeEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE CONTAINS_LOCATION (
  FROM LocationURI TO LocationURI,
  relation_type STRING
);
CREATE REL TABLE CONTAINS_CODE (
  FROM CodeEntity TO CodeEntity
);
CREATE REL TABLE FOLLOWS (
  FROM VersionState TO VersionState
);
CREATE REL TABLE TRACKS_STATE_OF_LOCATED_ENTITY (
  FROM VersionState TO LocationURI
);
CREATE REL TABLE USES (
  FROM EntityAggregationView TO LocationURI
);
CREATE REL TABLE AGGREGATES_REQ (
  FROM EntityAggregationView TO RequirementEntity,
  aggregation_method STRING
);
CREATE REL TABLE AGGREGATES_CODE (
  FROM EntityAggregationView TO CodeEntity,
  aggregation_method STRING
);
CREATE (v20:VersionState {id: "v2.0", timestamp: "2024-01-15", description: "Basic auth service", change_reason: "Initial release", progress_percentage: 0.0});
CREATE (auth_api:LocationURI {id: "services/auth/api.py"});
CREATE (auth_db:LocationURI {id: "services/auth/models.py"});
CREATE (auth_req:RequirementEntity {id: "req_auth", title: "Authentication service", description: "User authentication with JWT", priority: "high", requirement_type: "feature"});
CREATE (db_req:RequirementEntity {id: "req_postgres", title: "PostgreSQL database", description: "Primary database", priority: "high", requirement_type: "infrastructure"});
CREATE (jwt_req:RequirementEntity {id: "req_jwt", title: "JWT library", description: "Token generation", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/models.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/auth/api.py"}), (req:RequirementEntity {id: "req_auth"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (auth:RequirementEntity {id: "req_auth"}), (db:RequirementEntity {id: "req_postgres"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(db);
MATCH (auth:RequirementEntity {id: "req_auth"}), (jwt:RequirementEntity {id: "req_jwt"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "library"}]->(jwt);
MATCH (req:RequirementEntity)-[:DEPENDS_ON]->(dep:RequirementEntity)
WHERE NOT EXISTS {
  MATCH ()-[:TRACKS_STATE_OF_LOCATED_ENTITY]->()-[:LOCATED_WITH_REQUIREMENT]->(dep)
}
RETURN req.title as requirement, dep.title as missing_dependency, dep.requirement_type as type;
MATCH (v:VersionState)
OPTIONAL MATCH (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc:LocationURI)
WITH v, count(loc) as file_count
RETURN v.id, v.timestamp, v.description, file_count
ORDER BY v.timestamp;
CREATE NODE TABLE LocationURI (
  id STRING PRIMARY KEY
);
CREATE NODE TABLE CodeEntity (
  persistent_id STRING PRIMARY KEY,
  name STRING,
  type STRING,
  signature STRING,
  complexity INT64,
  start_position INT64,
  end_position INT64
);
CREATE NODE TABLE RequirementEntity (
  id STRING PRIMARY KEY,
  title STRING,
  description STRING,
  priority STRING,
  requirement_type STRING,
  verification_required BOOLEAN DEFAULT true
);
CREATE NODE TABLE VersionState (
  id STRING PRIMARY KEY,
  timestamp STRING,
  description STRING,
  change_reason STRING,
  progress_percentage FLOAT
);
CREATE NODE TABLE ReferenceEntity (
  id STRING PRIMARY KEY,
  description STRING,
  // DEPRECATED: uriプロパティとurlプロパティは使用禁止となりました
  // uri STRING, -- 削除
  type STRING,
  source_type STRING
);
CREATE NODE TABLE EntityAggregationView (
  id STRING PRIMARY KEY,
  view_type STRING
);
CREATE REL TABLE LOCATED_WITH (
  FROM LocationURI TO CodeEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REQUIREMENT (
  FROM LocationURI TO RequirementEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REFERENCE (
  FROM LocationURI TO ReferenceEntity,
  entity_type STRING
);
CREATE REL TABLE IS_IMPLEMENTED_BY (
  FROM RequirementEntity TO CodeEntity,
  implementation_type STRING
);
CREATE REL TABLE IS_VERIFIED_BY (
  FROM RequirementEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE DEPENDS_ON (
  FROM RequirementEntity TO RequirementEntity,
  dependency_type STRING
);
CREATE REL TABLE REFERENCES_CODE (
  FROM CodeEntity TO CodeEntity,
  ref_type STRING
);
CREATE REL TABLE REFERS_TO (
  FROM CodeEntity TO ReferenceEntity,
  ref_type STRING
);
CREATE REL TABLE TESTS (
  FROM CodeEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE CONTAINS_LOCATION (
  FROM LocationURI TO LocationURI,
  relation_type STRING
);
CREATE REL TABLE CONTAINS_CODE (
  FROM CodeEntity TO CodeEntity
);
CREATE REL TABLE FOLLOWS (
  FROM VersionState TO VersionState
);
CREATE REL TABLE TRACKS_STATE_OF_LOCATED_ENTITY (
  FROM VersionState TO LocationURI
);
CREATE REL TABLE USES (
  FROM EntityAggregationView TO LocationURI
);
CREATE REL TABLE AGGREGATES_REQ (
  FROM EntityAggregationView TO RequirementEntity,
  aggregation_method STRING
);
CREATE REL TABLE AGGREGATES_CODE (
  FROM EntityAggregationView TO CodeEntity,
  aggregation_method STRING
);
CREATE (v20:VersionState {id: "v2.0", timestamp: "2024-01-15", description: "Basic auth service", change_reason: "Initial release", progress_percentage: 0.0});
CREATE (auth_api:LocationURI {id: "services/auth/api.py"});
CREATE (auth_db:LocationURI {id: "services/auth/models.py"});
CREATE (auth_req:RequirementEntity {id: "req_auth", title: "Authentication service", description: "User authentication with JWT", priority: "high", requirement_type: "feature"});
CREATE (db_req:RequirementEntity {id: "req_postgres", title: "PostgreSQL database", description: "Primary database", priority: "high", requirement_type: "infrastructure"});
CREATE (jwt_req:RequirementEntity {id: "req_jwt", title: "JWT library", description: "Token generation", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/models.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/auth/api.py"}), (req:RequirementEntity {id: "req_auth"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (auth:RequirementEntity {id: "req_auth"}), (db:RequirementEntity {id: "req_postgres"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(db);
MATCH (auth:RequirementEntity {id: "req_auth"}), (jwt:RequirementEntity {id: "req_jwt"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "library"}]->(jwt);
CREATE (v201:VersionState {id: "v2.0.1", timestamp: "2024-01-20", description: "Infrastructure setup", change_reason: "Resolve missing dependencies", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "v2.0"}), (v201:VersionState {id: "v2.0.1"}) CREATE (v20)-[:FOLLOWS]->(v201);
CREATE (db_config:LocationURI {id: "infrastructure/database/config.yaml"});
CREATE (jwt_config:LocationURI {id: "infrastructure/auth/jwt_config.py"});
MATCH (v:VersionState {id: "v2.0.1"}), (uri:LocationURI {id: "infrastructure/database/config.yaml"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.0.1"}), (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "infrastructure/database/config.yaml"}), (req:RequirementEntity {id: "req_postgres"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "infrastructure"}]->(req);
MATCH (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}), (req:RequirementEntity {id: "req_jwt"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "library"}]->(req);
MATCH (req:RequirementEntity)-[:DEPENDS_ON]->(dep:RequirementEntity)
WHERE NOT EXISTS {
  MATCH ()-[:TRACKS_STATE_OF_LOCATED_ENTITY]->()-[:LOCATED_WITH_REQUIREMENT]->(dep)
}
RETURN req.title as requirement, dep.title as missing_dependency, dep.requirement_type as type
ORDER BY dep.requirement_type, req.title;
MATCH (v:VersionState)
OPTIONAL MATCH (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc:LocationURI)
WITH v, count(loc) as file_count
RETURN v.id, v.timestamp, v.description, file_count
ORDER BY v.timestamp;
CREATE NODE TABLE LocationURI (
  id STRING PRIMARY KEY
);
CREATE NODE TABLE CodeEntity (
  persistent_id STRING PRIMARY KEY,
  name STRING,
  type STRING,
  signature STRING,
  complexity INT64,
  start_position INT64,
  end_position INT64
);
CREATE NODE TABLE RequirementEntity (
  id STRING PRIMARY KEY,
  title STRING,
  description STRING,
  priority STRING,
  requirement_type STRING,
  verification_required BOOLEAN DEFAULT true
);
CREATE NODE TABLE VersionState (
  id STRING PRIMARY KEY,
  timestamp STRING,
  description STRING,
  change_reason STRING,
  progress_percentage FLOAT
);
CREATE NODE TABLE ReferenceEntity (
  id STRING PRIMARY KEY,
  description STRING,
  // DEPRECATED: uriプロパティとurlプロパティは使用禁止となりました
  // uri STRING, -- 削除
  type STRING,
  source_type STRING
);
CREATE NODE TABLE EntityAggregationView (
  id STRING PRIMARY KEY,
  view_type STRING
);
CREATE REL TABLE LOCATED_WITH (
  FROM LocationURI TO CodeEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REQUIREMENT (
  FROM LocationURI TO RequirementEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REFERENCE (
  FROM LocationURI TO ReferenceEntity,
  entity_type STRING
);
CREATE REL TABLE IS_IMPLEMENTED_BY (
  FROM RequirementEntity TO CodeEntity,
  implementation_type STRING
);
CREATE REL TABLE IS_VERIFIED_BY (
  FROM RequirementEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE DEPENDS_ON (
  FROM RequirementEntity TO RequirementEntity,
  dependency_type STRING
);
CREATE REL TABLE REFERENCES_CODE (
  FROM CodeEntity TO CodeEntity,
  ref_type STRING
);
CREATE REL TABLE REFERS_TO (
  FROM CodeEntity TO ReferenceEntity,
  ref_type STRING
);
CREATE REL TABLE TESTS (
  FROM CodeEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE CONTAINS_LOCATION (
  FROM LocationURI TO LocationURI,
  relation_type STRING
);
CREATE REL TABLE CONTAINS_CODE (
  FROM CodeEntity TO CodeEntity
);
CREATE REL TABLE FOLLOWS (
  FROM VersionState TO VersionState
);
CREATE REL TABLE TRACKS_STATE_OF_LOCATED_ENTITY (
  FROM VersionState TO LocationURI
);
CREATE REL TABLE USES (
  FROM EntityAggregationView TO LocationURI
);
CREATE REL TABLE AGGREGATES_REQ (
  FROM EntityAggregationView TO RequirementEntity,
  aggregation_method STRING
);
CREATE REL TABLE AGGREGATES_CODE (
  FROM EntityAggregationView TO CodeEntity,
  aggregation_method STRING
);
CREATE (v20:VersionState {id: "v2.0", timestamp: "2024-01-15", description: "Basic auth service", change_reason: "Initial release", progress_percentage: 0.0});
CREATE (auth_api:LocationURI {id: "services/auth/api.py"});
CREATE (auth_db:LocationURI {id: "services/auth/models.py"});
CREATE (auth_req:RequirementEntity {id: "req_auth", title: "Authentication service", description: "User authentication with JWT", priority: "high", requirement_type: "feature"});
CREATE (db_req:RequirementEntity {id: "req_postgres", title: "PostgreSQL database", description: "Primary database", priority: "high", requirement_type: "infrastructure"});
CREATE (jwt_req:RequirementEntity {id: "req_jwt", title: "JWT library", description: "Token generation", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/models.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/auth/api.py"}), (req:RequirementEntity {id: "req_auth"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (auth:RequirementEntity {id: "req_auth"}), (db:RequirementEntity {id: "req_postgres"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(db);
MATCH (auth:RequirementEntity {id: "req_auth"}), (jwt:RequirementEntity {id: "req_jwt"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "library"}]->(jwt);
CREATE (v201:VersionState {id: "v2.0.1", timestamp: "2024-01-20", description: "Infrastructure setup", change_reason: "Resolve missing dependencies", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "v2.0"}), (v201:VersionState {id: "v2.0.1"}) CREATE (v20)-[:FOLLOWS]->(v201);
CREATE (db_config:LocationURI {id: "infrastructure/database/config.yaml"});
CREATE (jwt_config:LocationURI {id: "infrastructure/auth/jwt_config.py"});
MATCH (v:VersionState {id: "v2.0.1"}), (uri:LocationURI {id: "infrastructure/database/config.yaml"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.0.1"}), (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "infrastructure/database/config.yaml"}), (req:RequirementEntity {id: "req_postgres"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "infrastructure"}]->(req);
MATCH (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}), (req:RequirementEntity {id: "req_jwt"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "library"}]->(req);
CREATE (v21:VersionState {id: "v2.1", timestamp: "2024-02-01", description: "Add payment service", change_reason: "Payment integration", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "v2.0"}), (v21:VersionState {id: "v2.1"}) CREATE (v20)-[:FOLLOWS]->(v21);
CREATE (pay_api:LocationURI {id: "services/payment/api.py"});
CREATE (pay_webhook:LocationURI {id: "services/payment/webhook.py"});
CREATE (pay_req:RequirementEntity {id: "req_payment", title: "Payment service", description: "Stripe payment processing", priority: "high", requirement_type: "feature"});
CREATE (stripe_req:RequirementEntity {id: "req_stripe", title: "Stripe SDK", description: "Stripe API integration", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "v2.1"}), (uri:LocationURI {id: "services/payment/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.1"}), (uri:LocationURI {id: "services/payment/webhook.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/payment/api.py"}), (req:RequirementEntity {id: "req_payment"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (auth:RequirementEntity {id: "req_auth"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(auth);
MATCH (pay:RequirementEntity {id: "req_payment"}), (stripe:RequirementEntity {id: "req_stripe"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "library"}]->(stripe);
MATCH (req:RequirementEntity)-[:DEPENDS_ON]->(dep:RequirementEntity)
WHERE NOT EXISTS {
  MATCH ()-[:TRACKS_STATE_OF_LOCATED_ENTITY]->()-[:LOCATED_WITH_REQUIREMENT]->(dep)
}
RETURN req.title as requirement, dep.title as missing_dependency, dep.requirement_type as type
ORDER BY dep.requirement_type, req.title;
CREATE NODE TABLE LocationURI (
  id STRING PRIMARY KEY
);
CREATE NODE TABLE CodeEntity (
  persistent_id STRING PRIMARY KEY,
  name STRING,
  type STRING,
  signature STRING,
  complexity INT64,
  start_position INT64,
  end_position INT64
);
CREATE NODE TABLE RequirementEntity (
  id STRING PRIMARY KEY,
  title STRING,
  description STRING,
  priority STRING,
  requirement_type STRING,
  verification_required BOOLEAN DEFAULT true
);
CREATE NODE TABLE VersionState (
  id STRING PRIMARY KEY,
  timestamp STRING,
  description STRING,
  change_reason STRING,
  progress_percentage FLOAT
);
CREATE NODE TABLE ReferenceEntity (
  id STRING PRIMARY KEY,
  description STRING,
  // DEPRECATED: uriプロパティとurlプロパティは使用禁止となりました
  // uri STRING, -- 削除
  type STRING,
  source_type STRING
);
CREATE NODE TABLE EntityAggregationView (
  id STRING PRIMARY KEY,
  view_type STRING
);
CREATE REL TABLE LOCATED_WITH (
  FROM LocationURI TO CodeEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REQUIREMENT (
  FROM LocationURI TO RequirementEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REFERENCE (
  FROM LocationURI TO ReferenceEntity,
  entity_type STRING
);
CREATE REL TABLE IS_IMPLEMENTED_BY (
  FROM RequirementEntity TO CodeEntity,
  implementation_type STRING
);
CREATE REL TABLE IS_VERIFIED_BY (
  FROM RequirementEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE DEPENDS_ON (
  FROM RequirementEntity TO RequirementEntity,
  dependency_type STRING
);
CREATE REL TABLE REFERENCES_CODE (
  FROM CodeEntity TO CodeEntity,
  ref_type STRING
);
CREATE REL TABLE REFERS_TO (
  FROM CodeEntity TO ReferenceEntity,
  ref_type STRING
);
CREATE REL TABLE TESTS (
  FROM CodeEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE CONTAINS_LOCATION (
  FROM LocationURI TO LocationURI,
  relation_type STRING
);
CREATE REL TABLE CONTAINS_CODE (
  FROM CodeEntity TO CodeEntity
);
CREATE REL TABLE FOLLOWS (
  FROM VersionState TO VersionState
);
CREATE REL TABLE TRACKS_STATE_OF_LOCATED_ENTITY (
  FROM VersionState TO LocationURI
);
CREATE REL TABLE USES (
  FROM EntityAggregationView TO LocationURI
);
CREATE REL TABLE AGGREGATES_REQ (
  FROM EntityAggregationView TO RequirementEntity,
  aggregation_method STRING
);
CREATE REL TABLE AGGREGATES_CODE (
  FROM EntityAggregationView TO CodeEntity,
  aggregation_method STRING
);
CREATE (v20:VersionState {id: "v2.0", timestamp: "2024-01-15", description: "Basic auth service", change_reason: "Initial release", progress_percentage: 0.0});
CREATE (auth_api:LocationURI {id: "services/auth/api.py"});
CREATE (auth_db:LocationURI {id: "services/auth/models.py"});
CREATE (auth_req:RequirementEntity {id: "req_auth", title: "Authentication service", description: "User authentication with JWT", priority: "high", requirement_type: "feature"});
CREATE (db_req:RequirementEntity {id: "req_postgres", title: "PostgreSQL database", description: "Primary database", priority: "high", requirement_type: "infrastructure"});
CREATE (jwt_req:RequirementEntity {id: "req_jwt", title: "JWT library", description: "Token generation", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/models.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/auth/api.py"}), (req:RequirementEntity {id: "req_auth"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (auth:RequirementEntity {id: "req_auth"}), (db:RequirementEntity {id: "req_postgres"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(db);
MATCH (auth:RequirementEntity {id: "req_auth"}), (jwt:RequirementEntity {id: "req_jwt"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "library"}]->(jwt);
CREATE (v201:VersionState {id: "v2.0.1", timestamp: "2024-01-20", description: "Infrastructure setup", change_reason: "Resolve missing dependencies", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "v2.0"}), (v201:VersionState {id: "v2.0.1"}) CREATE (v20)-[:FOLLOWS]->(v201);
CREATE (db_config:LocationURI {id: "infrastructure/database/config.yaml"});
CREATE (jwt_config:LocationURI {id: "infrastructure/auth/jwt_config.py"});
MATCH (v:VersionState {id: "v2.0.1"}), (uri:LocationURI {id: "infrastructure/database/config.yaml"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.0.1"}), (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "infrastructure/database/config.yaml"}), (req:RequirementEntity {id: "req_postgres"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "infrastructure"}]->(req);
MATCH (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}), (req:RequirementEntity {id: "req_jwt"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "library"}]->(req);
CREATE (v21:VersionState {id: "v2.1", timestamp: "2024-02-01", description: "Add payment service", change_reason: "Payment integration", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "v2.0"}), (v21:VersionState {id: "v2.1"}) CREATE (v20)-[:FOLLOWS]->(v21);
CREATE (pay_api:LocationURI {id: "services/payment/api.py"});
CREATE (pay_webhook:LocationURI {id: "services/payment/webhook.py"});
CREATE (pay_req:RequirementEntity {id: "req_payment", title: "Payment service", description: "Stripe payment processing", priority: "high", requirement_type: "feature"});
CREATE (stripe_req:RequirementEntity {id: "req_stripe", title: "Stripe SDK", description: "Stripe API integration", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "v2.1"}), (uri:LocationURI {id: "services/payment/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.1"}), (uri:LocationURI {id: "services/payment/webhook.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/payment/api.py"}), (req:RequirementEntity {id: "req_payment"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (auth:RequirementEntity {id: "req_auth"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(auth);
MATCH (pay:RequirementEntity {id: "req_payment"}), (stripe:RequirementEntity {id: "req_stripe"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "library"}]->(stripe);
CREATE (v22:VersionState {id: "v2.2", timestamp: "2024-02-15", description: "Add notification service", change_reason: "Email/SMS notifications", progress_percentage: 0.0});
MATCH (v21:VersionState {id: "v2.1"}), (v22:VersionState {id: "v2.2"}) CREATE (v21)-[:FOLLOWS]->(v22);
CREATE (notif_api:LocationURI {id: "services/notification/api.py"});
CREATE (notif_req:RequirementEntity {id: "req_notification", title: "Notification service", description: "Email and SMS notifications", priority: "medium", requirement_type: "feature"});
MATCH (v:VersionState {id: "v2.2"}), (uri:LocationURI {id: "services/notification/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/notification/api.py"}), (req:RequirementEntity {id: "req_notification"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (notif:RequirementEntity {id: "req_notification"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(notif);
MATCH (notif:RequirementEntity {id: "req_notification"}), (pay:RequirementEntity {id: "req_payment"}) CREATE (notif)-[:DEPENDS_ON {dependency_type: "service"}]->(pay);
MATCH path = (req:RequirementEntity)-[:DEPENDS_ON*2..]->(req)
RETURN req.title as circular_dependency;
CREATE NODE TABLE LocationURI (
  id STRING PRIMARY KEY
);
CREATE NODE TABLE CodeEntity (
  persistent_id STRING PRIMARY KEY,
  name STRING,
  type STRING,
  signature STRING,
  complexity INT64,
  start_position INT64,
  end_position INT64
);
CREATE NODE TABLE RequirementEntity (
  id STRING PRIMARY KEY,
  title STRING,
  description STRING,
  priority STRING,
  requirement_type STRING,
  verification_required BOOLEAN DEFAULT true
);
CREATE NODE TABLE VersionState (
  id STRING PRIMARY KEY,
  timestamp STRING,
  description STRING,
  change_reason STRING,
  progress_percentage FLOAT
);
CREATE NODE TABLE ReferenceEntity (
  id STRING PRIMARY KEY,
  description STRING,
  // DEPRECATED: uriプロパティとurlプロパティは使用禁止となりました
  // uri STRING, -- 削除
  type STRING,
  source_type STRING
);
CREATE NODE TABLE EntityAggregationView (
  id STRING PRIMARY KEY,
  view_type STRING
);
CREATE REL TABLE LOCATED_WITH (
  FROM LocationURI TO CodeEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REQUIREMENT (
  FROM LocationURI TO RequirementEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REFERENCE (
  FROM LocationURI TO ReferenceEntity,
  entity_type STRING
);
CREATE REL TABLE IS_IMPLEMENTED_BY (
  FROM RequirementEntity TO CodeEntity,
  implementation_type STRING
);
CREATE REL TABLE IS_VERIFIED_BY (
  FROM RequirementEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE DEPENDS_ON (
  FROM RequirementEntity TO RequirementEntity,
  dependency_type STRING
);
CREATE REL TABLE REFERENCES_CODE (
  FROM CodeEntity TO CodeEntity,
  ref_type STRING
);
CREATE REL TABLE REFERS_TO (
  FROM CodeEntity TO ReferenceEntity,
  ref_type STRING
);
CREATE REL TABLE TESTS (
  FROM CodeEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE CONTAINS_LOCATION (
  FROM LocationURI TO LocationURI,
  relation_type STRING
);
CREATE REL TABLE CONTAINS_CODE (
  FROM CodeEntity TO CodeEntity
);
CREATE REL TABLE FOLLOWS (
  FROM VersionState TO VersionState
);
CREATE REL TABLE TRACKS_STATE_OF_LOCATED_ENTITY (
  FROM VersionState TO LocationURI
);
CREATE REL TABLE USES (
  FROM EntityAggregationView TO LocationURI
);
CREATE REL TABLE AGGREGATES_REQ (
  FROM EntityAggregationView TO RequirementEntity,
  aggregation_method STRING
);
CREATE REL TABLE AGGREGATES_CODE (
  FROM EntityAggregationView TO CodeEntity,
  aggregation_method STRING
);
CREATE (v20:VersionState {id: "v2.0", timestamp: "2024-01-15", description: "Basic auth service", change_reason: "Initial release", progress_percentage: 0.0});
CREATE (auth_api:LocationURI {id: "services/auth/api.py"});
CREATE (auth_db:LocationURI {id: "services/auth/models.py"});
CREATE (auth_req:RequirementEntity {id: "req_auth", title: "Authentication service", description: "User authentication with JWT", priority: "high", requirement_type: "feature"});
CREATE (db_req:RequirementEntity {id: "req_postgres", title: "PostgreSQL database", description: "Primary database", priority: "high", requirement_type: "infrastructure"});
CREATE (jwt_req:RequirementEntity {id: "req_jwt", title: "JWT library", description: "Token generation", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/models.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/auth/api.py"}), (req:RequirementEntity {id: "req_auth"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (auth:RequirementEntity {id: "req_auth"}), (db:RequirementEntity {id: "req_postgres"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(db);
MATCH (auth:RequirementEntity {id: "req_auth"}), (jwt:RequirementEntity {id: "req_jwt"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "library"}]->(jwt);
CREATE (v201:VersionState {id: "v2.0.1", timestamp: "2024-01-20", description: "Infrastructure setup", change_reason: "Resolve missing dependencies", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "v2.0"}), (v201:VersionState {id: "v2.0.1"}) CREATE (v20)-[:FOLLOWS]->(v201);
CREATE (db_config:LocationURI {id: "infrastructure/database/config.yaml"});
CREATE (jwt_config:LocationURI {id: "infrastructure/auth/jwt_config.py"});
MATCH (v:VersionState {id: "v2.0.1"}), (uri:LocationURI {id: "infrastructure/database/config.yaml"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.0.1"}), (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "infrastructure/database/config.yaml"}), (req:RequirementEntity {id: "req_postgres"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "infrastructure"}]->(req);
MATCH (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}), (req:RequirementEntity {id: "req_jwt"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "library"}]->(req);
CREATE (v21:VersionState {id: "v2.1", timestamp: "2024-02-01", description: "Add payment service", change_reason: "Payment integration", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "v2.0"}), (v21:VersionState {id: "v2.1"}) CREATE (v20)-[:FOLLOWS]->(v21);
CREATE (pay_api:LocationURI {id: "services/payment/api.py"});
CREATE (pay_webhook:LocationURI {id: "services/payment/webhook.py"});
CREATE (pay_req:RequirementEntity {id: "req_payment", title: "Payment service", description: "Stripe payment processing", priority: "high", requirement_type: "feature"});
CREATE (stripe_req:RequirementEntity {id: "req_stripe", title: "Stripe SDK", description: "Stripe API integration", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "v2.1"}), (uri:LocationURI {id: "services/payment/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.1"}), (uri:LocationURI {id: "services/payment/webhook.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/payment/api.py"}), (req:RequirementEntity {id: "req_payment"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (auth:RequirementEntity {id: "req_auth"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(auth);
MATCH (pay:RequirementEntity {id: "req_payment"}), (stripe:RequirementEntity {id: "req_stripe"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "library"}]->(stripe);
CREATE (v22:VersionState {id: "v2.2", timestamp: "2024-02-15", description: "Add notification service", change_reason: "Email/SMS notifications", progress_percentage: 0.0});
MATCH (v21:VersionState {id: "v2.1"}), (v22:VersionState {id: "v2.2"}) CREATE (v21)-[:FOLLOWS]->(v22);
CREATE (notif_api:LocationURI {id: "services/notification/api.py"});
CREATE (notif_req:RequirementEntity {id: "req_notification", title: "Notification service", description: "Email and SMS notifications", priority: "medium", requirement_type: "feature"});
MATCH (v:VersionState {id: "v2.2"}), (uri:LocationURI {id: "services/notification/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/notification/api.py"}), (req:RequirementEntity {id: "req_notification"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (notif:RequirementEntity {id: "req_notification"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(notif);
MATCH (notif:RequirementEntity {id: "req_notification"}), (pay:RequirementEntity {id: "req_payment"}) CREATE (notif)-[:DEPENDS_ON {dependency_type: "service"}]->(pay);
CREATE (v22r:VersionState {id: "v2.2-redesign", timestamp: "2024-02-15", description: "Event-driven notification", change_reason: "Avoid circular dependency", progress_percentage: 0.0});
MATCH (v21:VersionState {id: "v2.1"}), (v22r:VersionState {id: "v2.2-redesign"}) CREATE (v21)-[:FOLLOWS]->(v22r);
CREATE (event_bus:LocationURI {id: "infrastructure/event_bus.py"});
CREATE (notif_api:LocationURI {id: "services/notification/api.py"});
CREATE (event_req:RequirementEntity {id: "req_event_bus", title: "Event Bus", description: "Async message broker", priority: "high", requirement_type: "infrastructure"});
CREATE (notif_req:RequirementEntity {id: "req_notification", title: "Notification service", description: "Email and SMS notifications", priority: "medium", requirement_type: "feature"});
MATCH (v:VersionState {id: "v2.2-redesign"}), (uri:LocationURI {id: "infrastructure/event_bus.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.2-redesign"}), (uri:LocationURI {id: "services/notification/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "infrastructure/event_bus.py"}), (req:RequirementEntity {id: "req_event_bus"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "infrastructure"}]->(req);
MATCH (uri:LocationURI {id: "services/notification/api.py"}), (req:RequirementEntity {id: "req_notification"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (event:RequirementEntity {id: "req_event_bus"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(event);
MATCH (notif:RequirementEntity {id: "req_notification"}), (event:RequirementEntity {id: "req_event_bus"}) CREATE (notif)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(event);
MATCH path = (req:RequirementEntity)-[:DEPENDS_ON*2..]->(req)
RETURN req.title as circular_dependency;
CREATE NODE TABLE LocationURI (
  id STRING PRIMARY KEY
);
CREATE NODE TABLE CodeEntity (
  persistent_id STRING PRIMARY KEY,
  name STRING,
  type STRING,
  signature STRING,
  complexity INT64,
  start_position INT64,
  end_position INT64
);
CREATE NODE TABLE RequirementEntity (
  id STRING PRIMARY KEY,
  title STRING,
  description STRING,
  priority STRING,
  requirement_type STRING,
  verification_required BOOLEAN DEFAULT true
);
CREATE NODE TABLE VersionState (
  id STRING PRIMARY KEY,
  timestamp STRING,
  description STRING,
  change_reason STRING,
  progress_percentage FLOAT
);
CREATE NODE TABLE ReferenceEntity (
  id STRING PRIMARY KEY,
  description STRING,
  // DEPRECATED: uriプロパティとurlプロパティは使用禁止となりました
  // uri STRING, -- 削除
  type STRING,
  source_type STRING
);
CREATE NODE TABLE EntityAggregationView (
  id STRING PRIMARY KEY,
  view_type STRING
);
CREATE REL TABLE LOCATED_WITH (
  FROM LocationURI TO CodeEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REQUIREMENT (
  FROM LocationURI TO RequirementEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REFERENCE (
  FROM LocationURI TO ReferenceEntity,
  entity_type STRING
);
CREATE REL TABLE IS_IMPLEMENTED_BY (
  FROM RequirementEntity TO CodeEntity,
  implementation_type STRING
);
CREATE REL TABLE IS_VERIFIED_BY (
  FROM RequirementEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE DEPENDS_ON (
  FROM RequirementEntity TO RequirementEntity,
  dependency_type STRING
);
CREATE REL TABLE REFERENCES_CODE (
  FROM CodeEntity TO CodeEntity,
  ref_type STRING
);
CREATE REL TABLE REFERS_TO (
  FROM CodeEntity TO ReferenceEntity,
  ref_type STRING
);
CREATE REL TABLE TESTS (
  FROM CodeEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE CONTAINS_LOCATION (
  FROM LocationURI TO LocationURI,
  relation_type STRING
);
CREATE REL TABLE CONTAINS_CODE (
  FROM CodeEntity TO CodeEntity
);
CREATE REL TABLE FOLLOWS (
  FROM VersionState TO VersionState
);
CREATE REL TABLE TRACKS_STATE_OF_LOCATED_ENTITY (
  FROM VersionState TO LocationURI
);
CREATE REL TABLE USES (
  FROM EntityAggregationView TO LocationURI
);
CREATE REL TABLE AGGREGATES_REQ (
  FROM EntityAggregationView TO RequirementEntity,
  aggregation_method STRING
);
CREATE REL TABLE AGGREGATES_CODE (
  FROM EntityAggregationView TO CodeEntity,
  aggregation_method STRING
);
CREATE (v20:VersionState {id: "v2.0", timestamp: "2024-01-15", description: "Basic auth service", change_reason: "Initial release", progress_percentage: 0.0});
CREATE (auth_api:LocationURI {id: "services/auth/api.py"});
CREATE (auth_db:LocationURI {id: "services/auth/models.py"});
CREATE (auth_req:RequirementEntity {id: "req_auth", title: "Authentication service", description: "User authentication with JWT", priority: "high", requirement_type: "feature"});
CREATE (db_req:RequirementEntity {id: "req_postgres", title: "PostgreSQL database", description: "Primary database", priority: "high", requirement_type: "infrastructure"});
CREATE (jwt_req:RequirementEntity {id: "req_jwt", title: "JWT library", description: "Token generation", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.0"}), (uri:LocationURI {id: "services/auth/models.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/auth/api.py"}), (req:RequirementEntity {id: "req_auth"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (auth:RequirementEntity {id: "req_auth"}), (db:RequirementEntity {id: "req_postgres"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(db);
MATCH (auth:RequirementEntity {id: "req_auth"}), (jwt:RequirementEntity {id: "req_jwt"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "library"}]->(jwt);
CREATE (v201:VersionState {id: "v2.0.1", timestamp: "2024-01-20", description: "Infrastructure setup", change_reason: "Resolve missing dependencies", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "v2.0"}), (v201:VersionState {id: "v2.0.1"}) CREATE (v20)-[:FOLLOWS]->(v201);
CREATE (db_config:LocationURI {id: "infrastructure/database/config.yaml"});
CREATE (jwt_config:LocationURI {id: "infrastructure/auth/jwt_config.py"});
MATCH (v:VersionState {id: "v2.0.1"}), (uri:LocationURI {id: "infrastructure/database/config.yaml"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.0.1"}), (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "infrastructure/database/config.yaml"}), (req:RequirementEntity {id: "req_postgres"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "infrastructure"}]->(req);
MATCH (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}), (req:RequirementEntity {id: "req_jwt"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "library"}]->(req);
CREATE (v21:VersionState {id: "v2.1", timestamp: "2024-02-01", description: "Add payment service", change_reason: "Payment integration", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "v2.0"}), (v21:VersionState {id: "v2.1"}) CREATE (v20)-[:FOLLOWS]->(v21);
CREATE (pay_api:LocationURI {id: "services/payment/api.py"});
CREATE (pay_webhook:LocationURI {id: "services/payment/webhook.py"});
CREATE (pay_req:RequirementEntity {id: "req_payment", title: "Payment service", description: "Stripe payment processing", priority: "high", requirement_type: "feature"});
CREATE (stripe_req:RequirementEntity {id: "req_stripe", title: "Stripe SDK", description: "Stripe API integration", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "v2.1"}), (uri:LocationURI {id: "services/payment/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.1"}), (uri:LocationURI {id: "services/payment/webhook.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/payment/api.py"}), (req:RequirementEntity {id: "req_payment"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (auth:RequirementEntity {id: "req_auth"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(auth);
MATCH (pay:RequirementEntity {id: "req_payment"}), (stripe:RequirementEntity {id: "req_stripe"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "library"}]->(stripe);
CREATE (v22r:VersionState {id: "v2.2-redesign", timestamp: "2024-02-15", description: "Event-driven notification", change_reason: "Avoid circular dependency", progress_percentage: 0.0});
MATCH (v21:VersionState {id: "v2.1"}), (v22r:VersionState {id: "v2.2-redesign"}) CREATE (v21)-[:FOLLOWS]->(v22r);
CREATE (event_bus:LocationURI {id: "infrastructure/event_bus.py"});
CREATE (notif_api:LocationURI {id: "services/notification/api.py"});
CREATE (event_req:RequirementEntity {id: "req_event_bus", title: "Event Bus", description: "Async message broker", priority: "high", requirement_type: "infrastructure"});
CREATE (notif_req:RequirementEntity {id: "req_notification", title: "Notification service", description: "Email and SMS notifications", priority: "medium", requirement_type: "feature"});
MATCH (v:VersionState {id: "v2.2-redesign"}), (uri:LocationURI {id: "infrastructure/event_bus.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "v2.2-redesign"}), (uri:LocationURI {id: "services/notification/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "infrastructure/event_bus.py"}), (req:RequirementEntity {id: "req_event_bus"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "infrastructure"}]->(req);
MATCH (uri:LocationURI {id: "services/notification/api.py"}), (req:RequirementEntity {id: "req_notification"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (event:RequirementEntity {id: "req_event_bus"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(event);
MATCH (notif:RequirementEntity {id: "req_notification"}), (event:RequirementEntity {id: "req_event_bus"}) CREATE (notif)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(event);
MATCH path = (req:RequirementEntity)-[:DEPENDS_ON*2..]->(req)
RETURN req.title as circular_dependency;
CREATE NODE TABLE LocationURI (
  id STRING PRIMARY KEY
);
CREATE NODE TABLE CodeEntity (
  persistent_id STRING PRIMARY KEY,
  name STRING,
  type STRING,
  signature STRING,
  complexity INT64,
  start_position INT64,
  end_position INT64
);
CREATE NODE TABLE RequirementEntity (
  id STRING PRIMARY KEY,
  title STRING,
  description STRING,
  priority STRING,
  requirement_type STRING,
  verification_required BOOLEAN DEFAULT true
);
CREATE NODE TABLE VersionState (
  id STRING PRIMARY KEY,
  timestamp STRING,
  description STRING,
  change_reason STRING,
  progress_percentage FLOAT
);
CREATE NODE TABLE ReferenceEntity (
  id STRING PRIMARY KEY,
  description STRING,
  // DEPRECATED: uriプロパティとurlプロパティは使用禁止となりました
  // uri STRING, -- 削除
  type STRING,
  source_type STRING
);
CREATE NODE TABLE EntityAggregationView (
  id STRING PRIMARY KEY,
  view_type STRING
);
CREATE REL TABLE LOCATED_WITH (
  FROM LocationURI TO CodeEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REQUIREMENT (
  FROM LocationURI TO RequirementEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REFERENCE (
  FROM LocationURI TO ReferenceEntity,
  entity_type STRING
);
CREATE REL TABLE IS_IMPLEMENTED_BY (
  FROM RequirementEntity TO CodeEntity,
  implementation_type STRING
);
CREATE REL TABLE IS_VERIFIED_BY (
  FROM RequirementEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE DEPENDS_ON (
  FROM RequirementEntity TO RequirementEntity,
  dependency_type STRING
);
CREATE REL TABLE REFERENCES_CODE (
  FROM CodeEntity TO CodeEntity,
  ref_type STRING
);
CREATE REL TABLE REFERS_TO (
  FROM CodeEntity TO ReferenceEntity,
  ref_type STRING
);
CREATE REL TABLE TESTS (
  FROM CodeEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE CONTAINS_LOCATION (
  FROM LocationURI TO LocationURI,
  relation_type STRING
);
CREATE REL TABLE CONTAINS_CODE (
  FROM CodeEntity TO CodeEntity
);
CREATE REL TABLE FOLLOWS (
  FROM VersionState TO VersionState
);
CREATE REL TABLE TRACKS_STATE_OF_LOCATED_ENTITY (
  FROM VersionState TO LocationURI
);
CREATE REL TABLE USES (
  FROM EntityAggregationView TO LocationURI
);
CREATE REL TABLE AGGREGATES_REQ (
  FROM EntityAggregationView TO RequirementEntity,
  aggregation_method STRING
);
CREATE REL TABLE AGGREGATES_CODE (
  FROM EntityAggregationView TO CodeEntity,
  aggregation_method STRING
);
CREATE (v20:VersionState {id: "2.0.0", timestamp: "2024-01-15", description: "Basic auth service", change_reason: "Initial release", progress_percentage: 0.0});
CREATE (auth_api:LocationURI {id: "services/auth/api.py"});
CREATE (auth_db:LocationURI {id: "services/auth/models.py"});
CREATE (auth_req:RequirementEntity {id: "req_auth", title: "Authentication service", description: "User authentication with JWT", priority: "high", requirement_type: "feature"});
CREATE (db_req:RequirementEntity {id: "req_postgres", title: "PostgreSQL database", description: "Primary database", priority: "high", requirement_type: "infrastructure"});
CREATE (jwt_req:RequirementEntity {id: "req_jwt", title: "JWT library", description: "Token generation", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "2.0.0"}), (uri:LocationURI {id: "services/auth/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.0.0"}), (uri:LocationURI {id: "services/auth/models.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/auth/api.py"}), (req:RequirementEntity {id: "req_auth"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (auth:RequirementEntity {id: "req_auth"}), (db:RequirementEntity {id: "req_postgres"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(db);
MATCH (auth:RequirementEntity {id: "req_auth"}), (jwt:RequirementEntity {id: "req_jwt"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "library"}]->(jwt);
CREATE (v201:VersionState {id: "2.0.1", timestamp: "2024-01-20", description: "Infrastructure setup", change_reason: "Resolve missing dependencies", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "2.0.0"}), (v201:VersionState {id: "2.0.1"}) CREATE (v20)-[:FOLLOWS]->(v201);
CREATE (db_config:LocationURI {id: "infrastructure/database/config.yaml"});
CREATE (jwt_config:LocationURI {id: "infrastructure/auth/jwt_config.py"});
MATCH (v:VersionState {id: "2.0.1"}), (uri:LocationURI {id: "infrastructure/database/config.yaml"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.0.1"}), (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "infrastructure/database/config.yaml"}), (req:RequirementEntity {id: "req_postgres"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "infrastructure"}]->(req);
MATCH (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}), (req:RequirementEntity {id: "req_jwt"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "library"}]->(req);
CREATE NODE TABLE LocationURI (
  id STRING PRIMARY KEY
);
CREATE NODE TABLE CodeEntity (
  persistent_id STRING PRIMARY KEY,
  name STRING,
  type STRING,
  signature STRING,
  complexity INT64,
  start_position INT64,
  end_position INT64
);
CREATE NODE TABLE RequirementEntity (
  id STRING PRIMARY KEY,
  title STRING,
  description STRING,
  priority STRING,
  requirement_type STRING,
  verification_required BOOLEAN DEFAULT true
);
CREATE NODE TABLE VersionState (
  id STRING PRIMARY KEY,
  timestamp STRING,
  description STRING,
  change_reason STRING,
  progress_percentage FLOAT
);
CREATE NODE TABLE ReferenceEntity (
  id STRING PRIMARY KEY,
  description STRING,
  // DEPRECATED: uriプロパティとurlプロパティは使用禁止となりました
  // uri STRING, -- 削除
  type STRING,
  source_type STRING
);
CREATE NODE TABLE EntityAggregationView (
  id STRING PRIMARY KEY,
  view_type STRING
);
CREATE REL TABLE LOCATED_WITH (
  FROM LocationURI TO CodeEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REQUIREMENT (
  FROM LocationURI TO RequirementEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REFERENCE (
  FROM LocationURI TO ReferenceEntity,
  entity_type STRING
);
CREATE REL TABLE IS_IMPLEMENTED_BY (
  FROM RequirementEntity TO CodeEntity,
  implementation_type STRING
);
CREATE REL TABLE IS_VERIFIED_BY (
  FROM RequirementEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE DEPENDS_ON (
  FROM RequirementEntity TO RequirementEntity,
  dependency_type STRING
);
CREATE REL TABLE REFERENCES_CODE (
  FROM CodeEntity TO CodeEntity,
  ref_type STRING
);
CREATE REL TABLE REFERS_TO (
  FROM CodeEntity TO ReferenceEntity,
  ref_type STRING
);
CREATE REL TABLE TESTS (
  FROM CodeEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE CONTAINS_LOCATION (
  FROM LocationURI TO LocationURI,
  relation_type STRING
);
CREATE REL TABLE CONTAINS_CODE (
  FROM CodeEntity TO CodeEntity
);
CREATE REL TABLE FOLLOWS (
  FROM VersionState TO VersionState
);
CREATE REL TABLE TRACKS_STATE_OF_LOCATED_ENTITY (
  FROM VersionState TO LocationURI
);
CREATE REL TABLE USES (
  FROM EntityAggregationView TO LocationURI
);
CREATE REL TABLE AGGREGATES_REQ (
  FROM EntityAggregationView TO RequirementEntity,
  aggregation_method STRING
);
CREATE REL TABLE AGGREGATES_CODE (
  FROM EntityAggregationView TO CodeEntity,
  aggregation_method STRING
);
CREATE (v20:VersionState {id: "2.0.0", timestamp: "2024-01-15", description: "Basic auth service", change_reason: "Initial release", progress_percentage: 0.0});
CREATE (auth_api:LocationURI {id: "services/auth/api.py"});
CREATE (auth_db:LocationURI {id: "services/auth/models.py"});
CREATE (auth_req:RequirementEntity {id: "req_auth", title: "Authentication service", description: "User authentication with JWT", priority: "high", requirement_type: "feature"});
CREATE (db_req:RequirementEntity {id: "req_postgres", title: "PostgreSQL database", description: "Primary database", priority: "high", requirement_type: "infrastructure"});
CREATE (jwt_req:RequirementEntity {id: "req_jwt", title: "JWT library", description: "Token generation", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "2.0.0"}), (uri:LocationURI {id: "services/auth/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.0.0"}), (uri:LocationURI {id: "services/auth/models.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/auth/api.py"}), (req:RequirementEntity {id: "req_auth"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (auth:RequirementEntity {id: "req_auth"}), (db:RequirementEntity {id: "req_postgres"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(db);
MATCH (auth:RequirementEntity {id: "req_auth"}), (jwt:RequirementEntity {id: "req_jwt"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "library"}]->(jwt);
CREATE (v201:VersionState {id: "2.0.1", timestamp: "2024-01-20", description: "Infrastructure setup", change_reason: "Resolve missing dependencies", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "2.0.0"}), (v201:VersionState {id: "2.0.1"}) CREATE (v20)-[:FOLLOWS]->(v201);
CREATE (db_config:LocationURI {id: "infrastructure/database/config.yaml"});
CREATE (jwt_config:LocationURI {id: "infrastructure/auth/jwt_config.py"});
MATCH (v:VersionState {id: "2.0.1"}), (uri:LocationURI {id: "infrastructure/database/config.yaml"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.0.1"}), (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "infrastructure/database/config.yaml"}), (req:RequirementEntity {id: "req_postgres"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "infrastructure"}]->(req);
MATCH (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}), (req:RequirementEntity {id: "req_jwt"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "library"}]->(req);
CREATE (v21:VersionState {id: "2.1.0", timestamp: "2024-02-01", description: "Add payment service", change_reason: "Payment integration", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "v2.0"}), (v21:VersionState {id: "2.1.0"}) CREATE (v20)-[:FOLLOWS]->(v21);
CREATE (pay_api:LocationURI {id: "services/payment/api.py"});
CREATE (pay_webhook:LocationURI {id: "services/payment/webhook.py"});
CREATE (pay_req:RequirementEntity {id: "req_payment", title: "Payment service", description: "Stripe payment processing", priority: "high", requirement_type: "feature"});
CREATE (stripe_req:RequirementEntity {id: "req_stripe", title: "Stripe SDK", description: "Stripe API integration", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "2.1.0"}), (uri:LocationURI {id: "services/payment/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.1.0"}), (uri:LocationURI {id: "services/payment/webhook.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/payment/api.py"}), (req:RequirementEntity {id: "req_payment"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (auth:RequirementEntity {id: "req_auth"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(auth);
MATCH (pay:RequirementEntity {id: "req_payment"}), (stripe:RequirementEntity {id: "req_stripe"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "library"}]->(stripe);
CREATE (v22r:VersionState {id: "2.2.1", timestamp: "2024-02-15", description: "Event-driven notification", change_reason: "Avoid circular dependency", progress_percentage: 0.0});
MATCH (v21:VersionState {id: "2.1.0"}), (v22r:VersionState {id: "2.2.1"}) CREATE (v21)-[:FOLLOWS]->(v22r);
CREATE (event_bus:LocationURI {id: "infrastructure/event_bus.py"});
CREATE (notif_api:LocationURI {id: "services/notification/api.py"});
CREATE (event_req:RequirementEntity {id: "req_event_bus", title: "Event Bus", description: "Async message broker", priority: "high", requirement_type: "infrastructure"});
CREATE (notif_req:RequirementEntity {id: "req_notification", title: "Notification service", description: "Email and SMS notifications", priority: "medium", requirement_type: "feature"});
MATCH (v:VersionState {id: "2.2.1"}), (uri:LocationURI {id: "infrastructure/event_bus.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.2.1"}), (uri:LocationURI {id: "services/notification/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "infrastructure/event_bus.py"}), (req:RequirementEntity {id: "req_event_bus"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "infrastructure"}]->(req);
MATCH (uri:LocationURI {id: "services/notification/api.py"}), (req:RequirementEntity {id: "req_notification"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (event:RequirementEntity {id: "req_event_bus"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(event);
MATCH (notif:RequirementEntity {id: "req_notification"}), (event:RequirementEntity {id: "req_event_bus"}) CREATE (notif)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(event);
MATCH (v:VersionState)
OPTIONAL MATCH (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc:LocationURI)
WITH v, count(loc) as file_count
RETURN v.id as version, v.timestamp as date, v.description, file_count
ORDER BY v.timestamp;
MATCH path = (req:RequirementEntity)-[:DEPENDS_ON*2..]->(req)
RETURN req.title as circular_dependency;
CREATE NODE TABLE LocationURI (
  id STRING PRIMARY KEY
);
CREATE NODE TABLE CodeEntity (
  persistent_id STRING PRIMARY KEY,
  name STRING,
  type STRING,
  signature STRING,
  complexity INT64,
  start_position INT64,
  end_position INT64
);
CREATE NODE TABLE RequirementEntity (
  id STRING PRIMARY KEY,
  title STRING,
  description STRING,
  priority STRING,
  requirement_type STRING,
  verification_required BOOLEAN DEFAULT true
);
CREATE NODE TABLE VersionState (
  id STRING PRIMARY KEY,
  timestamp STRING,
  description STRING,
  change_reason STRING,
  progress_percentage FLOAT
);
CREATE NODE TABLE ReferenceEntity (
  id STRING PRIMARY KEY,
  description STRING,
  // DEPRECATED: uriプロパティとurlプロパティは使用禁止となりました
  // uri STRING, -- 削除
  type STRING,
  source_type STRING
);
CREATE NODE TABLE EntityAggregationView (
  id STRING PRIMARY KEY,
  view_type STRING
);
CREATE REL TABLE LOCATED_WITH (
  FROM LocationURI TO CodeEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REQUIREMENT (
  FROM LocationURI TO RequirementEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REFERENCE (
  FROM LocationURI TO ReferenceEntity,
  entity_type STRING
);
CREATE REL TABLE IS_IMPLEMENTED_BY (
  FROM RequirementEntity TO CodeEntity,
  implementation_type STRING
);
CREATE REL TABLE IS_VERIFIED_BY (
  FROM RequirementEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE DEPENDS_ON (
  FROM RequirementEntity TO RequirementEntity,
  dependency_type STRING
);
CREATE REL TABLE REFERENCES_CODE (
  FROM CodeEntity TO CodeEntity,
  ref_type STRING
);
CREATE REL TABLE REFERS_TO (
  FROM CodeEntity TO ReferenceEntity,
  ref_type STRING
);
CREATE REL TABLE TESTS (
  FROM CodeEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE CONTAINS_LOCATION (
  FROM LocationURI TO LocationURI,
  relation_type STRING
);
CREATE REL TABLE CONTAINS_CODE (
  FROM CodeEntity TO CodeEntity
);
CREATE REL TABLE FOLLOWS (
  FROM VersionState TO VersionState
);
CREATE REL TABLE TRACKS_STATE_OF_LOCATED_ENTITY (
  FROM VersionState TO LocationURI
);
CREATE REL TABLE USES (
  FROM EntityAggregationView TO LocationURI
);
CREATE REL TABLE AGGREGATES_REQ (
  FROM EntityAggregationView TO RequirementEntity,
  aggregation_method STRING
);
CREATE REL TABLE AGGREGATES_CODE (
  FROM EntityAggregationView TO CodeEntity,
  aggregation_method STRING
);
CREATE (v20:VersionState {id: "2.0.0", timestamp: "2024-01-15", description: "Basic auth service", change_reason: "Initial release", progress_percentage: 0.0});
CREATE (auth_api:LocationURI {id: "services/auth/api.py"});
CREATE (auth_db:LocationURI {id: "services/auth/models.py"});
CREATE (auth_req:RequirementEntity {id: "req_auth", title: "Authentication service", description: "User authentication with JWT", priority: "high", requirement_type: "feature"});
CREATE (db_req:RequirementEntity {id: "req_postgres", title: "PostgreSQL database", description: "Primary database", priority: "high", requirement_type: "infrastructure"});
CREATE (jwt_req:RequirementEntity {id: "req_jwt", title: "JWT library", description: "Token generation", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "2.0.0"}), (uri:LocationURI {id: "services/auth/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.0.0"}), (uri:LocationURI {id: "services/auth/models.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/auth/api.py"}), (req:RequirementEntity {id: "req_auth"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (auth:RequirementEntity {id: "req_auth"}), (db:RequirementEntity {id: "req_postgres"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(db);
MATCH (auth:RequirementEntity {id: "req_auth"}), (jwt:RequirementEntity {id: "req_jwt"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "library"}]->(jwt);
CREATE (v201:VersionState {id: "2.0.1", timestamp: "2024-01-20", description: "Infrastructure setup", change_reason: "Resolve missing dependencies", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "2.0.0"}), (v201:VersionState {id: "2.0.1"}) CREATE (v20)-[:FOLLOWS]->(v201);
CREATE (db_config:LocationURI {id: "infrastructure/database/config.yaml"});
CREATE (jwt_config:LocationURI {id: "infrastructure/auth/jwt_config.py"});
MATCH (v:VersionState {id: "2.0.1"}), (uri:LocationURI {id: "infrastructure/database/config.yaml"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.0.1"}), (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "infrastructure/database/config.yaml"}), (req:RequirementEntity {id: "req_postgres"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "infrastructure"}]->(req);
MATCH (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}), (req:RequirementEntity {id: "req_jwt"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "library"}]->(req);
CREATE (v21:VersionState {id: "2.1.0", timestamp: "2024-02-01", description: "Add payment service", change_reason: "Payment integration", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "v2.0"}), (v21:VersionState {id: "2.1.0"}) CREATE (v20)-[:FOLLOWS]->(v21);
CREATE (pay_api:LocationURI {id: "services/payment/api.py"});
CREATE (pay_webhook:LocationURI {id: "services/payment/webhook.py"});
CREATE (pay_req:RequirementEntity {id: "req_payment", title: "Payment service", description: "Stripe payment processing", priority: "high", requirement_type: "feature"});
CREATE (stripe_req:RequirementEntity {id: "req_stripe", title: "Stripe SDK", description: "Stripe API integration", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "2.1.0"}), (uri:LocationURI {id: "services/payment/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.1.0"}), (uri:LocationURI {id: "services/payment/webhook.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/payment/api.py"}), (req:RequirementEntity {id: "req_payment"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (auth:RequirementEntity {id: "req_auth"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(auth);
MATCH (pay:RequirementEntity {id: "req_payment"}), (stripe:RequirementEntity {id: "req_stripe"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "library"}]->(stripe);
CREATE (v22r:VersionState {id: "2.2.1", timestamp: "2024-02-15", description: "Event-driven notification", change_reason: "Avoid circular dependency", progress_percentage: 0.0});
MATCH (v21:VersionState {id: "2.1.0"}), (v22r:VersionState {id: "2.2.1"}) CREATE (v21)-[:FOLLOWS]->(v22r);
CREATE (event_bus:LocationURI {id: "infrastructure/event_bus.py"});
CREATE (notif_api:LocationURI {id: "services/notification/api.py"});
CREATE (event_req:RequirementEntity {id: "req_event_bus", title: "Event Bus", description: "Async message broker", priority: "high", requirement_type: "infrastructure"});
CREATE (notif_req:RequirementEntity {id: "req_notification", title: "Notification service", description: "Email and SMS notifications", priority: "medium", requirement_type: "feature"});
MATCH (v:VersionState {id: "2.2.1"}), (uri:LocationURI {id: "infrastructure/event_bus.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.2.1"}), (uri:LocationURI {id: "services/notification/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "infrastructure/event_bus.py"}), (req:RequirementEntity {id: "req_event_bus"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "infrastructure"}]->(req);
MATCH (uri:LocationURI {id: "services/notification/api.py"}), (req:RequirementEntity {id: "req_notification"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (event:RequirementEntity {id: "req_event_bus"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(event);
MATCH (notif:RequirementEntity {id: "req_notification"}), (event:RequirementEntity {id: "req_event_bus"}) CREATE (notif)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(event);
MATCH (v:VersionState)
OPTIONAL MATCH (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(loc:LocationURI)
WITH v, count(loc) as file_count
RETURN v.id as version, v.timestamp as date, v.description, file_count
ORDER BY v.timestamp;
CREATE NODE TABLE LocationURI (
  id STRING PRIMARY KEY
);
CREATE NODE TABLE CodeEntity (
  persistent_id STRING PRIMARY KEY,
  name STRING,
  type STRING,
  signature STRING,
  complexity INT64,
  start_position INT64,
  end_position INT64
);
CREATE NODE TABLE RequirementEntity (
  id STRING PRIMARY KEY,
  title STRING,
  description STRING,
  priority STRING,
  requirement_type STRING,
  verification_required BOOLEAN DEFAULT true
);
CREATE NODE TABLE VersionState (
  id STRING PRIMARY KEY,
  timestamp STRING,
  description STRING,
  change_reason STRING,
  progress_percentage FLOAT
);
CREATE NODE TABLE ReferenceEntity (
  id STRING PRIMARY KEY,
  description STRING,
  // DEPRECATED: uriプロパティとurlプロパティは使用禁止となりました
  // uri STRING, -- 削除
  type STRING,
  source_type STRING
);
CREATE NODE TABLE EntityAggregationView (
  id STRING PRIMARY KEY,
  view_type STRING
);
CREATE REL TABLE LOCATED_WITH (
  FROM LocationURI TO CodeEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REQUIREMENT (
  FROM LocationURI TO RequirementEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REFERENCE (
  FROM LocationURI TO ReferenceEntity,
  entity_type STRING
);
CREATE REL TABLE IS_IMPLEMENTED_BY (
  FROM RequirementEntity TO CodeEntity,
  implementation_type STRING
);
CREATE REL TABLE IS_VERIFIED_BY (
  FROM RequirementEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE DEPENDS_ON (
  FROM RequirementEntity TO RequirementEntity,
  dependency_type STRING
);
CREATE REL TABLE REFERENCES_CODE (
  FROM CodeEntity TO CodeEntity,
  ref_type STRING
);
CREATE REL TABLE REFERS_TO (
  FROM CodeEntity TO ReferenceEntity,
  ref_type STRING
);
CREATE REL TABLE TESTS (
  FROM CodeEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE CONTAINS_LOCATION (
  FROM LocationURI TO LocationURI,
  relation_type STRING
);
CREATE REL TABLE CONTAINS_CODE (
  FROM CodeEntity TO CodeEntity
);
CREATE REL TABLE FOLLOWS (
  FROM VersionState TO VersionState
);
CREATE REL TABLE TRACKS_STATE_OF_LOCATED_ENTITY (
  FROM VersionState TO LocationURI
);
CREATE REL TABLE USES (
  FROM EntityAggregationView TO LocationURI
);
CREATE REL TABLE AGGREGATES_REQ (
  FROM EntityAggregationView TO RequirementEntity,
  aggregation_method STRING
);
CREATE REL TABLE AGGREGATES_CODE (
  FROM EntityAggregationView TO CodeEntity,
  aggregation_method STRING
);
CREATE (v20:VersionState {id: "2.0.0", timestamp: "2024-01-15", description: "Basic auth service", change_reason: "Initial release", progress_percentage: 0.0});
CREATE (auth_api:LocationURI {id: "services/auth/api.py"});
CREATE (auth_db:LocationURI {id: "services/auth/models.py"});
CREATE (auth_req:RequirementEntity {id: "req_auth", title: "Authentication service", description: "User authentication with JWT", priority: "high", requirement_type: "feature"});
CREATE (db_req:RequirementEntity {id: "req_postgres", title: "PostgreSQL database", description: "Primary database", priority: "high", requirement_type: "infrastructure"});
CREATE (jwt_req:RequirementEntity {id: "req_jwt", title: "JWT library", description: "Token generation", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "2.0.0"}), (uri:LocationURI {id: "services/auth/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.0.0"}), (uri:LocationURI {id: "services/auth/models.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/auth/api.py"}), (req:RequirementEntity {id: "req_auth"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (auth:RequirementEntity {id: "req_auth"}), (db:RequirementEntity {id: "req_postgres"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(db);
MATCH (auth:RequirementEntity {id: "req_auth"}), (jwt:RequirementEntity {id: "req_jwt"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "library"}]->(jwt);
CREATE (v201:VersionState {id: "2.0.1", timestamp: "2024-01-20", description: "Infrastructure setup", change_reason: "Resolve missing dependencies", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "2.0.0"}), (v201:VersionState {id: "2.0.1"}) CREATE (v20)-[:FOLLOWS]->(v201);
CREATE (db_config:LocationURI {id: "infrastructure/database/config.yaml"});
CREATE (jwt_config:LocationURI {id: "infrastructure/auth/jwt_config.py"});
MATCH (v:VersionState {id: "2.0.1"}), (uri:LocationURI {id: "infrastructure/database/config.yaml"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.0.1"}), (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "infrastructure/database/config.yaml"}), (req:RequirementEntity {id: "req_postgres"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "infrastructure"}]->(req);
MATCH (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}), (req:RequirementEntity {id: "req_jwt"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "library"}]->(req);
CREATE (v21:VersionState {id: "2.1.0", timestamp: "2024-02-01", description: "Add payment service", change_reason: "Payment integration", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "v2.0"}), (v21:VersionState {id: "2.1.0"}) CREATE (v20)-[:FOLLOWS]->(v21);
CREATE (pay_api:LocationURI {id: "services/payment/api.py"});
CREATE (pay_webhook:LocationURI {id: "services/payment/webhook.py"});
CREATE (pay_req:RequirementEntity {id: "req_payment", title: "Payment service", description: "Stripe payment processing", priority: "high", requirement_type: "feature"});
CREATE (stripe_req:RequirementEntity {id: "req_stripe", title: "Stripe SDK", description: "Stripe API integration", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "2.1.0"}), (uri:LocationURI {id: "services/payment/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.1.0"}), (uri:LocationURI {id: "services/payment/webhook.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/payment/api.py"}), (req:RequirementEntity {id: "req_payment"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (auth:RequirementEntity {id: "req_auth"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(auth);
MATCH (pay:RequirementEntity {id: "req_payment"}), (stripe:RequirementEntity {id: "req_stripe"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "library"}]->(stripe);
CREATE (v22r:VersionState {id: "2.2.1", timestamp: "2024-02-15", description: "Event-driven notification", change_reason: "Avoid circular dependency", progress_percentage: 0.0});
MATCH (v21:VersionState {id: "2.1.0"}), (v22r:VersionState {id: "2.2.1"}) CREATE (v21)-[:FOLLOWS]->(v22r);
CREATE (event_bus:LocationURI {id: "infrastructure/event_bus.py"});
CREATE (notif_api:LocationURI {id: "services/notification/api.py"});
CREATE (event_req:RequirementEntity {id: "req_event_bus", title: "Event Bus", description: "Async message broker", priority: "high", requirement_type: "infrastructure"});
CREATE (notif_req:RequirementEntity {id: "req_notification", title: "Notification service", description: "Email and SMS notifications", priority: "medium", requirement_type: "feature"});
MATCH (v:VersionState {id: "2.2.1"}), (uri:LocationURI {id: "infrastructure/event_bus.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.2.1"}), (uri:LocationURI {id: "services/notification/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "infrastructure/event_bus.py"}), (req:RequirementEntity {id: "req_event_bus"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "infrastructure"}]->(req);
MATCH (uri:LocationURI {id: "services/notification/api.py"}), (req:RequirementEntity {id: "req_notification"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (event:RequirementEntity {id: "req_event_bus"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(event);
MATCH (notif:RequirementEntity {id: "req_notification"}), (event:RequirementEntity {id: "req_event_bus"}) CREATE (notif)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(event);
CREATE NODE TABLE LocationURI (
  id STRING PRIMARY KEY
);
CREATE NODE TABLE CodeEntity (
  persistent_id STRING PRIMARY KEY,
  name STRING,
  type STRING,
  signature STRING,
  complexity INT64,
  start_position INT64,
  end_position INT64
);
CREATE NODE TABLE RequirementEntity (
  id STRING PRIMARY KEY,
  title STRING,
  description STRING,
  priority STRING,
  requirement_type STRING,
  verification_required BOOLEAN DEFAULT true
);
CREATE NODE TABLE VersionState (
  id STRING PRIMARY KEY,
  timestamp STRING,
  description STRING,
  change_reason STRING,
  progress_percentage FLOAT
);
CREATE NODE TABLE ReferenceEntity (
  id STRING PRIMARY KEY,
  description STRING,
  // DEPRECATED: uriプロパティとurlプロパティは使用禁止となりました
  // uri STRING, -- 削除
  type STRING,
  source_type STRING
);
CREATE NODE TABLE EntityAggregationView (
  id STRING PRIMARY KEY,
  view_type STRING
);
CREATE REL TABLE LOCATED_WITH (
  FROM LocationURI TO CodeEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REQUIREMENT (
  FROM LocationURI TO RequirementEntity,
  entity_type STRING
);
CREATE REL TABLE LOCATED_WITH_REFERENCE (
  FROM LocationURI TO ReferenceEntity,
  entity_type STRING
);
CREATE REL TABLE IS_IMPLEMENTED_BY (
  FROM RequirementEntity TO CodeEntity,
  implementation_type STRING
);
CREATE REL TABLE IS_VERIFIED_BY (
  FROM RequirementEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE DEPENDS_ON (
  FROM RequirementEntity TO RequirementEntity,
  dependency_type STRING
);
CREATE REL TABLE REFERENCES_CODE (
  FROM CodeEntity TO CodeEntity,
  ref_type STRING
);
CREATE REL TABLE REFERS_TO (
  FROM CodeEntity TO ReferenceEntity,
  ref_type STRING
);
CREATE REL TABLE TESTS (
  FROM CodeEntity TO CodeEntity,
  test_type STRING -- 'unit' | 'integration' | 'e2e'
);
CREATE REL TABLE CONTAINS_LOCATION (
  FROM LocationURI TO LocationURI,
  relation_type STRING
);
CREATE REL TABLE CONTAINS_CODE (
  FROM CodeEntity TO CodeEntity
);
CREATE REL TABLE FOLLOWS (
  FROM VersionState TO VersionState
);
CREATE REL TABLE TRACKS_STATE_OF_LOCATED_ENTITY (
  FROM VersionState TO LocationURI
);
CREATE REL TABLE USES (
  FROM EntityAggregationView TO LocationURI
);
CREATE REL TABLE AGGREGATES_REQ (
  FROM EntityAggregationView TO RequirementEntity,
  aggregation_method STRING
);
CREATE REL TABLE AGGREGATES_CODE (
  FROM EntityAggregationView TO CodeEntity,
  aggregation_method STRING
);
CREATE (v20:VersionState {id: "2.0.0", timestamp: "2024-01-15", description: "Basic auth service", change_reason: "Initial release", progress_percentage: 0.0});
CREATE (auth_api:LocationURI {id: "services/auth/api.py"});
CREATE (auth_db:LocationURI {id: "services/auth/models.py"});
CREATE (auth_req:RequirementEntity {id: "req_auth", title: "Authentication service", description: "User authentication with JWT", priority: "high", requirement_type: "feature"});
CREATE (db_req:RequirementEntity {id: "req_postgres", title: "PostgreSQL database", description: "Primary database", priority: "high", requirement_type: "infrastructure"});
CREATE (jwt_req:RequirementEntity {id: "req_jwt", title: "JWT library", description: "Token generation", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "2.0.0"}), (uri:LocationURI {id: "services/auth/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.0.0"}), (uri:LocationURI {id: "services/auth/models.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/auth/api.py"}), (req:RequirementEntity {id: "req_auth"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (auth:RequirementEntity {id: "req_auth"}), (db:RequirementEntity {id: "req_postgres"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(db);
MATCH (auth:RequirementEntity {id: "req_auth"}), (jwt:RequirementEntity {id: "req_jwt"}) CREATE (auth)-[:DEPENDS_ON {dependency_type: "library"}]->(jwt);
CREATE (v201:VersionState {id: "2.0.1", timestamp: "2024-01-20", description: "Infrastructure setup", change_reason: "Resolve missing dependencies", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "2.0.0"}), (v201:VersionState {id: "2.0.1"}) CREATE (v20)-[:FOLLOWS]->(v201);
CREATE (db_config:LocationURI {id: "infrastructure/database/config.yaml"});
CREATE (jwt_config:LocationURI {id: "infrastructure/auth/jwt_config.py"});
MATCH (v:VersionState {id: "2.0.1"}), (uri:LocationURI {id: "infrastructure/database/config.yaml"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.0.1"}), (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "infrastructure/database/config.yaml"}), (req:RequirementEntity {id: "req_postgres"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "infrastructure"}]->(req);
MATCH (uri:LocationURI {id: "infrastructure/auth/jwt_config.py"}), (req:RequirementEntity {id: "req_jwt"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "library"}]->(req);
CREATE (v21:VersionState {id: "2.1.0", timestamp: "2024-02-01", description: "Add payment service", change_reason: "Payment integration", progress_percentage: 0.0});
MATCH (v20:VersionState {id: "v2.0"}), (v21:VersionState {id: "2.1.0"}) CREATE (v20)-[:FOLLOWS]->(v21);
CREATE (pay_api:LocationURI {id: "services/payment/api.py"});
CREATE (pay_webhook:LocationURI {id: "services/payment/webhook.py"});
CREATE (pay_req:RequirementEntity {id: "req_payment", title: "Payment service", description: "Stripe payment processing", priority: "high", requirement_type: "feature"});
CREATE (stripe_req:RequirementEntity {id: "req_stripe", title: "Stripe SDK", description: "Stripe API integration", priority: "high", requirement_type: "library"});
MATCH (v:VersionState {id: "2.1.0"}), (uri:LocationURI {id: "services/payment/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.1.0"}), (uri:LocationURI {id: "services/payment/webhook.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "services/payment/api.py"}), (req:RequirementEntity {id: "req_payment"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (auth:RequirementEntity {id: "req_auth"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "service"}]->(auth);
MATCH (pay:RequirementEntity {id: "req_payment"}), (stripe:RequirementEntity {id: "req_stripe"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "library"}]->(stripe);
CREATE (v22r:VersionState {id: "2.2.1", timestamp: "2024-02-15", description: "Event-driven notification", change_reason: "Avoid circular dependency", progress_percentage: 0.0});
MATCH (v21:VersionState {id: "2.1.0"}), (v22r:VersionState {id: "2.2.1"}) CREATE (v21)-[:FOLLOWS]->(v22r);
CREATE (event_bus:LocationURI {id: "infrastructure/event_bus.py"});
CREATE (notif_api:LocationURI {id: "services/notification/api.py"});
CREATE (event_req:RequirementEntity {id: "req_event_bus", title: "Event Bus", description: "Async message broker", priority: "high", requirement_type: "infrastructure"});
CREATE (notif_req:RequirementEntity {id: "req_notification", title: "Notification service", description: "Email and SMS notifications", priority: "medium", requirement_type: "feature"});
MATCH (v:VersionState {id: "2.2.1"}), (uri:LocationURI {id: "infrastructure/event_bus.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (v:VersionState {id: "2.2.1"}), (uri:LocationURI {id: "services/notification/api.py"}) CREATE (v)-[:TRACKS_STATE_OF_LOCATED_ENTITY]->(uri);
MATCH (uri:LocationURI {id: "infrastructure/event_bus.py"}), (req:RequirementEntity {id: "req_event_bus"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "infrastructure"}]->(req);
MATCH (uri:LocationURI {id: "services/notification/api.py"}), (req:RequirementEntity {id: "req_notification"}) CREATE (uri)-[:LOCATED_WITH_REQUIREMENT {entity_type: "feature"}]->(req);
MATCH (pay:RequirementEntity {id: "req_payment"}), (event:RequirementEntity {id: "req_event_bus"}) CREATE (pay)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(event);
MATCH (notif:RequirementEntity {id: "req_notification"}), (event:RequirementEntity {id: "req_event_bus"}) CREATE (notif)-[:DEPENDS_ON {dependency_type: "infrastructure"}]->(event);
