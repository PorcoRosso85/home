# 階層型トレーサビリティモデル：概要と解決策

## 主要クラス
| クラス | 主な役割 | キーフィールド |
|--------|------------|-------------|
| LocationURI | 階層構造の表現 | scheme, authority, path, fragment, query |
| CodeEntity | 実装の最下層要素 | persistent_id, name, type, signature, complexity, start/end_position |
| RequirementEntity | 要件の最下層要素 | id, title, description, priority, requirement_type |
| VersionState | バージョン管理 | id, timestamp, description, is_realized, commit_id |
| ReferenceEntity | 外部参照情報 | uri, type, version, last_fetched |
| EntityAggregationView | 可視化と集計 | generateHierarchyView(), aggregateStatus(), calculateProgress(), visualizeImpact() |

## 問題点と解決策
| 問題点 | 関連するノード | 採用した設計での解決策 |
|--------|--------------|-------------------|
| 1. 過度な単純化の危険性 | CodeEntity, Requirement | 最下層の具体的な要件と実装の間のみで関係を定義し、関係性の種類を拡張する（例：PARTIALLY_IMPLEMENTS, TESTS, DOCUMENTS） |
| 4. スケーラビリティの問題 | 全体構造 | 最下層のみをエンティティとして扱うことでノード数を大幅に削減。上位概念はLocationURIの階層構造で表現 |
| 5. 意味的な曖昧さ | CodeEntity | 最下層のCodeEntityに対して、より具体的な関係タイプを導入（例：CALLS, INHERITS, IMPLEMENTS_INTERFACE） |
| 6. 要件の変動性 | Requirement | 最下層の具体的要件のみを追跡対象とし、上位要件の変更は下位への影響分析で対応。非機能要件も最下層で具体化 |
| 7. 実世界の複雑さの欠如 | モデル全体 | CodeEntityのtypeフィールドで機能コード・テスト・ビルド設定などを区別。最下層のRequirementEntityで具体的な要件タイプを管理 |
| 8. クエリの複雑さと学習曲線 | クエリ機能 | シンプルな構造により、クエリ複雑性が低減。最下層エンティティ間の関係のみを対象とすることで、クエリパターンが標準化しやすくなる |
| 9. 上位概念の可視化と集計の課題 | LocationURI, Requirement, CodeEntity | LocationURIの階層構造を効果的に活用し、上位概念を表現するためのビュー生成機能を実装。最下層の状態から上位レベルの進捗や健全性を自動集計する仕組みを構築 |

## 主要な関係性
- **CodeEntity → LocationURI**: HAS_LOCATION_URI
- **CodeEntity → CodeEntity**: CODE_REFERENCES_CODE
- **CodeEntity → ReferenceEntity**: CODE_REFERENCES_REF
- **RequirementEntity → LocationURI**: HAS_LOCATION_URI
- **RequirementEntity → RequirementEntity**: 
  - REQUIREMENT_DEPENDS_ON_REQUIREMENT
  - REQUIREMENT_REFINES_REQUIREMENT
- **CodeEntity → RequirementEntity**: 実装関係
  - IMPLEMENTS
  - PARTIALLY_IMPLEMENTS
  - TESTS
  - DOCUMENTS
  - CONFIGURES
- **VersionState関連**:
  - VERSION_FOLLOWS_VERSION
  - VERSION_CONTAINS_CODEENTITY
  - VERSION_IMPLEMENTS_REQUIREMENT
- **ViewGenerator関連**:
  - USES_URI_HIERARCHY
  - AGGREGATES_REQUIREMENT_STATUS
  - AGGREGATES_CODE_STATUS