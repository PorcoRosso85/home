# 要件管理システムUX改善議論 - 2025/07/13 20:14:59

## 議論参加者
- ユーザー（システム改善提案者）
- Claude（システム分析・提案）

## 議論の背景
現在のシステムでは、すべての要件が無条件でcreate/insertされてしまうUXについて、システムの目的を鑑みた理想的な振る舞いを検討した。

### 現在の実装状況
- **ハイブリッド検索**: VSS（ベクトル類似検索）+ FTS（全文検索）が実装済み
- **重複検出**: 類似度0.98の高精度で動作中
- **FTS制限**: 基本的なCONTAINS演算子のみ（完全なインデックス化は未実装）
- **問題点**: 重複を検出しても警告するだけで、要件は必ず作成される
- **関連情報**: FTS完全インデックス化は将来対応としてREADMEに記載済み

## 議論の要点

### 1. システムの核心目的
- **要件の品質向上** が最重要目的
- 現在の「全要件を無条件作成」するUXはこの目的に反する

### 2. 理想的UXの初期提案（インタラクティブ性を含む）

#### インテリジェントな作成プロセス
```
ユーザー入力 → 重複検出 → 選択肢提示 → ユーザー判断 → 実行
```

具体例:
- 類似要件発見時: 「既存の要件REQ001と85%類似しています。統合しますか？」
- 選択肢: `[統合] [別要件として作成] [編集して再検討]`

#### 段階的品質向上プロセス
```
Draft → Review → Approve → Create
```

### 3. ユーザーからのフィードバック
- インタラクティブ性の追加は**却下**したい
- シンプルなAPIを維持したい

### 4. 修正提案：完全自動化アプローチ

#### 自動判断による高度化
```python
# 現在の問題
if duplicates_found:
    print("重複がありますが作成します")
    create_requirement()

# 理想的な解決
if duplicates_found and similarity >= 0.8:
    print("重複のため作成をスキップしました")
    return existing_requirement
elif duplicates_found and similarity >= 0.5:
    print("類似要件に統合しました") 
    return merge_with_existing()
else:
    create_requirement()
```

#### 自動化レベル
1. **レベル1: 明確な重複は拒否**
   - 類似度80%以上 → 作成拒否
   - 既存要件IDを返却

2. **レベル2: 高類似度は自動統合**
   - 類似度50-79% → 既存要件に内容追加
   - ログに統合理由を記録

3. **レベル3: 中類似度は改良提案**
   - 類似度30-49% → 既存要件の改良版として作成
   - 関連付けを自動設定

### 5. ユーザー困難ケースのシミュレーション

#### ケース1: 意図的な似た要件作成
```
ユーザー: 「ユーザー認証機能（モバイル版）」
システム: 「既存の『ユーザー認証機能』に統合しました」
ユーザー: 「えっ、モバイル版は別要件にしたかったのに...」
```
**困難**: プラットフォーム別、バージョン別の要件分離が不可能

#### ケース2: 段階的詳細化の阻害
```
初回: 「検索機能」（概要レベル）
後日: 「検索機能の高速化」（詳細化）
システム: 「重複のため作成拒否」
```
**困難**: 要件の進化的発展が記録されない

#### ケース3: システム判断の不透明性
```
ユーザー: 「なぜこの要件が作成されなかったの？」
システム: 「類似度78.3%でした」
ユーザー: 「でも違う観点の要件なんだけど...」
```
**困難**: AIの判断基準がブラックボックス

#### ケース4: 修正の困難さ
```
自動統合後: 既存要件が肥大化
ユーザー: 「やっぱり分離したい」
システム: 「履歴から手動で分離してください」
```
**困難**: 自動判断の取り消しが複雑

#### ケース5: 文脈依存の誤判断
```
プロジェクトA: 「ログイン機能」
プロジェクトB: 「ログイン機能」（別システム）
システム: 「重複のため統合」
```
**困難**: プロジェクト境界を無視した統合

#### ケース6: チーム間の認識齟齬
```
開発チーム: 「パフォーマンス改善」（DB観点）
運用チーム: 「パフォーマンス改善」（インフラ観点）
システム: 「同じ要件として処理」
```
**困難**: 部門別視点の消失

### 6. 対策案

1. **統合履歴の完全記録**
   - 何がどう判断されたか透明化

2. **強制作成オプション**
   - `--force` フラグで自動判断を無視

3. **名前空間の導入**
   - プロジェクト/チーム別の要件分離

4. **判断理由の詳細出力**
   - なぜ統合/拒否したかの説明

## 今後の検討事項

### 実装優先度
1. **Phase 1**: 重複時の作成拒否（類似度80%以上）
2. **Phase 2**: 強制作成オプション（--force）の実装
3. **Phase 3**: 自動統合機能の追加

### 技術的検討項目
1. **閾値の調整可能性**
   - プロジェクトごとに類似度閾値を設定可能にするか

2. **学習機能の導入**
   - ユーザーの判断履歴から自動判断を改善するか

3. **段階的導入**
   - まず警告のみ → 自動統合 → 自動拒否と段階的に導入するか

## まとめ
- インタラクティブ性を排除し、完全自動化による品質向上を目指す
- ユーザー困難ケースを認識した上で、適切な対策を実装する
- シンプルなAPIを維持しながら、背後で高度な判断を行う

## 結論と次のアクション
1. **合意事項**: インタラクティブ性を追加せず、自動判断による品質向上を実現
2. **実装方針**: 類似度に基づく段階的な自動処理（拒否/統合/作成）
3. **最優先実装**: Phase 1として重複時の作成拒否機能（類似度80%以上）
4. **リスク対策**: 強制作成オプション（--force）で自動判断をオーバーライド可能に

---
記録者: Claude
記録日時: 2025/07/13 20:14:59
最終更新: 2025/07/13 20:17:00（2回目の自己レビュー後）