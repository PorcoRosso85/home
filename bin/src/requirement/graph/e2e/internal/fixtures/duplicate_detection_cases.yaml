# Duplicate Detection Test Cases
# This file contains test data for data-driven testing of duplicate detection functionality
# 
# To add new test cases:
# 1. Add entries under the appropriate test level
# 2. Follow the existing structure for consistency
# 3. Run tests with: TEST_LEVEL=<level> pytest test_e2e_duplicate_detection.py
#
# Benefits of this approach:
# - Separation of test data from test logic
# - Easy addition of new test cases without modifying code
# - Better visibility of test coverage
# - Supports different testing scenarios per level

test_level_1:
  # Level 1: Pure business rule tests (no external dependencies)
  
  similarity_cases:
    # Test cases for similarity calculation
    - name: "exact_match"
      description: "Exact duplicate detection"
      req1:
        id: "auth_001"
        title: "ユーザー認証"
        description: "ログイン機能"
      req2:
        id: "auth_002"
        title: "ユーザー認証"
        description: "ログイン機能"
      expected_similarity: 1.0
      expected_duplicate: true
      threshold: 0.7
    
    - name: "similar_requirements"
      description: "Similar but not identical requirements"
      req1:
        id: "auth_001"
        title: "ユーザー認証機能"
        description: "安全なログイン機能を提供"
      req2:
        id: "auth_002"
        title: "ユーザー認証システム"
        description: "セキュアなログイン実装"
      min_similarity: 0.5
      max_similarity: 0.9
      threshold: 0.7
    
    - name: "unrelated_requirements"
      description: "Completely different requirements"
      req1:
        id: "db_001"
        title: "データベース設計"
        description: "正規化されたスキーマ設計"
      req2:
        id: "ui_001"
        title: "ユーザーインターフェース改善"
        description: "使いやすいUIデザイン"
      max_similarity: 0.3
      expected_duplicate: false
      threshold: 0.7
    
    - name: "partially_overlapping"
      description: "Some common words but different domains"
      req1:
        id: "auth_001"
        title: "ユーザー認証"
        description: "システムへのログイン処理"
      req2:
        id: "user_001"
        title: "ユーザー管理"
        description: "ユーザー情報の管理システム"
      min_similarity: 0.3
      max_similarity: 0.6
      threshold: 0.7
  
  threshold_tests:
    # Test cases for different similarity thresholds
    - name: "low_threshold"
      description: "Low threshold catches more duplicates"
      req1:
        id: "feat_001"
        title: "検索機能"
        description: "キーワード検索"
      req2:
        id: "feat_002"
        title: "検索システム"
        description: "全文検索エンジン"
      thresholds:
        - value: 0.3
          expected_duplicate: true
        - value: 0.5
          expected_duplicate: true
        - value: 0.9
          expected_duplicate: false
  
  multiple_duplicates:
    # Test cases for finding multiple duplicates
    - name: "authentication_variants"
      description: "Multiple authentication-related requirements"
      new_requirement:
        id: "auth_new"
        title: "認証機能"
        description: "ユーザーログイン"
      existing_requirements:
        - id: "auth_001"
          title: "認証機能"
          description: "ログイン処理"
          expected_score_min: 0.7
        - id: "auth_002"
          title: "認証強化"
          description: "二要素認証"
          expected_score_min: 0.4
        - id: "db_001"
          title: "データ暗号化"
          description: "保存時の暗号化"
          expected_score_max: 0.3
      threshold: 0.5
      expected_duplicate_count_min: 1

test_level_2:
  # Level 2: Mock-based integration tests
  
  integration_scenarios:
    - name: "first_requirement_no_warning"
      description: "First requirement should not trigger duplicate warning"
      requirements:
        - id: "auth_001"
          title: "ユーザー認証機能"
          description: "安全なログイン機能を提供"
          expect_warning: false
    
    - name: "duplicate_with_warning"
      description: "Similar requirement triggers warning"
      requirements:
        - id: "auth_001"
          title: "ユーザー認証機能"
          description: "安全なログイン機能を提供"
          expect_warning: false
        - id: "auth_002"
          title: "ユーザー認証システム"
          description: "セキュアなログイン実装"
          expect_warning: true
          expected_duplicate_ids: ["auth_001"]
    
    - name: "no_false_positives"
      description: "Unrelated requirements don't trigger warnings"
      requirements:
        - id: "db_001"
          title: "データベース設計"
          description: "正規化されたスキーマ設計"
          expect_warning: false
        - id: "ui_001"
          title: "ユーザーインターフェース改善"
          description: "使いやすいUIデザイン"
          expect_warning: false
  
  search_scenarios:
    - name: "authentication_search"
      description: "Search for authentication-related requirements"
      setup_requirements:
        - id: "req_001"
          title: "認証機能"
          description: "ログイン処理"
        - id: "req_002"
          title: "認証強化"
          description: "二要素認証"
        - id: "req_003"
          title: "データ暗号化"
          description: "保存時の暗号化"
      search_query:
        title: "認証システム"
        description: "ユーザー認証の実装"
      threshold: 0.4
      expected_results_min: 2
      expected_ids_include: ["req_001", "req_002"]

test_level_3:
  # Level 3: End-to-end tests with real system
  
  user_journeys:
    - name: "iterative_refinement"
      description: "User refines requirement after duplicate warning"
      steps:
        - action: "create_base_requirement"
          requirement:
            id: "auth_base_001"
            title: "ユーザー認証機能"
            description: "標準的なユーザー認証を実装する"
          expect_success: true
        
        - action: "attempt_duplicate"
          requirement:
            id: "auth_new_001"
            title: "認証システム"
            description: "ユーザーがログインできるようにする"
          expect_warning: true
          expected_duplicate_ids: ["auth_base_001"]
        
        - action: "create_refined"
          requirement:
            id: "auth_oauth_001"
            title: "OAuth2.0認証機能"
            description: "GoogleとGitHubのOAuth2.0プロバイダーを使用したソーシャルログイン機能"
          expect_warning: false
          expect_success: true
    
    - name: "progressive_elaboration"
      description: "From abstract to concrete requirements"
      steps:
        - action: "create_abstract"
          requirement:
            id: "api_abstract_001"
            title: "RESTful API設計"
            description: "システム全体のAPI設計方針を定める"
          expect_success: true
        
        - action: "create_specific"
          requirement:
            id: "api_auth_001"
            title: "認証API エンドポイント設計"
            description: "/auth/login, /auth/logout, /auth/refreshのエンドポイント仕様"
          expect_warning: false
          expect_success: true
        
        - action: "create_implementation"
          requirement:
            id: "api_auth_impl_001"
            title: "JWT認証実装"
            description: "認証APIでJWTトークンを使用したステートレス認証の実装詳細"
          expect_warning: false
          expect_success: true
    
    - name: "cross_team_coordination"
      description: "Frontend and backend teams creating related requirements"
      steps:
        - action: "frontend_requirement"
          requirement:
            id: "fe_dashboard_001"
            title: "ダッシュボード画面"
            description: "ユーザーの活動統計をリアルタイムで表示するダッシュボード"
          expect_success: true
        
        - action: "backend_requirement"
          requirement:
            id: "be_stats_001"
            title: "統計情報API"
            description: "ユーザー活動データを提供するAPI"
          expect_success: true
          # May or may not trigger warning depending on implementation
        
        - action: "integrated_requirement"
          requirement:
            id: "feature_dashboard_001"
            title: "リアルタイムダッシュボード機能"
            description: "WebSocketを使用したリアルタイム更新機能を持つダッシュボード（フロントエンドとバックエンドの統合要件）"
          expect_warning: false
          expect_success: true
    
    - name: "terminology_variations"
      description: "Handling different languages and notations"
      steps:
        - action: "create_japanese"
          requirement:
            id: "cache_jp_001"
            title: "キャッシュ機能"
            description: "データベースクエリ結果を一時的に保存して高速化"
          expect_success: true
        
        - action: "create_english"
          requirement:
            id: "cache_en_001"
            title: "Caching System"
            description: "Store query results temporarily for performance"
          # Warning depends on multi-language support
          expect_success: true
        
        - action: "create_specific_tech"
          requirement:
            id: "cache_redis_001"
            title: "Redis キャッシュレイヤー"
            description: "Redisを使用したマイクロサービス間共有キャッシュの実装"
          expect_warning: false
          expect_success: true