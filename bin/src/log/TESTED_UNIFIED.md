# log モジュール - 統一テストによる仕様検証

## 1. テスト＝仕様：何を担保しているか

`test_behavior.py`による統一テストが担保する仕様：

### API仕様
- **2引数API**: `log(level, data) → stdout`
- **任意のログレベル**: INFO, ERROR, DEBUG, WARN, METRIC, CUSTOM等
- **必須フィールド**: uri, message は必須
- **フィールド拡張**: 任意のフィールドを追加可能
- **JSONL出力**: 1行1JSON、改行はエスケープ
- **level/dataマージ**: levelとdataの内容が統合されて出力

### 言語間互換性
- **出力形式の一致**: 全言語で同一の入力に対し同一の出力
- **Python/TypeScript**: 現在2言語で完全互換を確認
- **将来の拡張**: 新言語追加時も同じテストで検証可能

## 2. アプリ＝目的・要件：テストが不可欠か

**結論：テストは要件に対して不可欠である**

### 理由
1. **仕様の完全カバー**: READMEで定義された全要件を検証
2. **言語中立性**: 実装言語に依存しない検証方法
3. **拡張性**: 新言語追加時の品質保証
4. **実行可能な仕様書**: テスト自体が仕様のドキュメント

## 3. /conventions のテスト哲学を守っているか

**完全準拠を確認**

### 黄金律「リファクタリングの壁」✅
```
「もし、実装コードが壁の向こう側にあって全く見えないとしたら、このテストは書けるか？」
→ YES
```

- 実装を外部プロセスとして実行
- 標準出力のみを観測
- 内部実装（print/console.log）に一切触れない

### テスト対象のスコープ ✅
- **テストする**: 公開API（log, to_jsonl）の振る舞い
- **テストしない**: 実装の詳細、内部メソッド

### 実践ガイドライン準拠 ✅
- **統合テスト**: 外部から観測可能な結果（stdout）を検証
- **言語中立**: 特定言語の実装詳細に依存しない

## 4. `nix run .#test` コマンド

**利用可能 ✅**

```bash
nix run .#test
```

### 実行結果
- 12テスト全てパス（1.17秒）
- Python実装とTypeScript実装の互換性確認
- 全仕様の振る舞いを検証

## 5. テストアーキテクチャの価値

### 現在の構成
```
test_behavior.py（統一テスト）
  ├─ Python実装を外部プロセスで実行
  ├─ TypeScript実装を外部プロセスで実行
  └─ 標準出力のJSONを比較検証
```

### メリット
1. **真の統合テスト**: 実装の内部に依存しない
2. **保守性**: 単一ファイルで全言語をテスト
3. **拡張性**: 新言語追加が容易
4. **規約準拠**: テスト哲学を完全に遵守

## 結論

統一テストアプローチにより、以下を実現：
- 「壁の向こう側」原則の完全準拠
- 全言語実装の互換性保証
- 実行可能な仕様書としての機能
- 最小限のテストコードで最大限の価値