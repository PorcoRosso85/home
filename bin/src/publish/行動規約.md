# publish/ ディレクトリの行動規約

## 概要
このドキュメントは、publish/ ディレクトリ配下で新規プロジェクトを作成・実装・デプロイする際の標準的な手順と規約を定義します。

**注**: 各プロジェクトの責務と目的については、必ず各プロジェクトのREADME.mdを参照してください。

## 新規publish案の実装からデプロイまでの標準手順

### 1. 最もシンプルな指示形式
```bash
"publish/[project-name]に[アイデア]を実装してSiliplaneにデプロイまで完了させて"
```

### 2. 詳細な指示形式（推奨）
```bash
"新しいpublish案: [project-name]
目的: [何を解決するか]
ターゲット: [誰のためか]
期待される価値: [どんな価値を提供するか]
実装からSiliplaneデプロイまで完了させて"
```

## 段階的実装のアプローチ

### /phaseコマンドを使用した段階的実装
```bash
/phase "publish/[project-name]を作成
1. waku-initをコピーして[project-name]として初期化（基本）
   または必要部分のみcherry-pick（適切と判断される場合）
2. 基本機能実装
3. Cloudflare対応の確認・調整
4. テスト作成
5. Turborepoへの統合
6. Siliplaneデプロイ"
```

### /orgコマンドを使用した並列実装
```bash
/org "publish/[project-name]の実装
- UI実装
- API実装  
- デプロイ設定
各タスクを並列で進めてSiliplaneにデプロイ"
```

## 実装例：マークダウンブログエンジン
```bash
"publish/markdown-blogにWakuベースのマークダウンブログエンジンを実装してデプロイ
要件:
- マークダウンファイルから静的サイト生成
- Cloudflare Pagesでホスティング  
- 記事の自動インデックス
- シンタックスハイライト対応
Turborepo統合とSiliplaneデプロイまで含む"
```

## PROPOSAL.md の管理

### 目的
- **要件の永続化**: 元のアイデアや要件を失わないように保存
- **トレーサビリティ**: なぜこのプロジェクトが作られたかを追跡
- **固定名採用**: `PROPOSAL.md`で統一（検索・管理が容易）

### PROPOSAL.md の内容
```markdown
# [Project Name] - Implementation Proposal

## 元のアイデア
[受け取った文章やアイデアの要約]

## 要件抽出
- コア機能:
- ターゲット:
- 差別化ポイント:

## MVP定義
[最小限の実装内容]

## 技術スタック
[使用する技術の選定理由]

## 実装計画
[段階的な実装手順]
```

## プロジェクト作成方法

### 基本アプローチ: waku-init のコピー＋修正
```bash
# 基本的な作成手順
cp -r waku-init [project-name]
cd [project-name]
# package.json の name を変更
# 不要なコンポーネントを削除
# 必要な機能を追加実装
```

### 代替アプローチ: Cherry-pick（適切と判断される場合）
```bash
# 最小限の構成から開始
mkdir [project-name]
cd [project-name]
# waku-initから必要な設定ファイルのみコピー
cp ../waku-init/package.json .
cp ../waku-init/tsconfig.json .
cp ../waku-init/waku.config.ts .
# 必要なコンポーネントのみ選択的にコピー
```

**判断基準**:
- **copy+modify推奨**: 標準的なWakuアプリケーション、UI重視のプロジェクト
- **cherry-pick検討**: APIのみ、特殊な構成、最小限の実装で十分な場合

## Claude の権限と制約事項

### 権限の明確化
- **✅ 準備権限**: ディレクトリ構造の準備・設計・設定ファイルテンプレート作成
- **❌ 実装権限**: 実際のコード実装は禁止（別のClaude or ユーザーが実施）
- **❌ Git操作**: 勝手なcommit/pushは禁止（ユーザーの明示的指示が必要）

### 役割分担
- **設計フェーズ（Claudeが実行可能）**:
  - ディレクトリ構造の作成
  - flake.nix、package.json等の設定ファイル準備
  - README.mdでの責務定義
  - 型定義ファイルの骨組み作成
  
- **実装フェーズ（別のClaude/ユーザーが実行）**:
  - Reactコンポーネントの実装
  - API関数の実装
  - ビジネスロジックの実装
  - スタイリングの実装

## 必須要件チェックリスト

### ✅ 実装時の必須項目
- [ ] **flake.nix作成**: 各プロジェクトに必須（Nix環境定義）
- [ ] **PROPOSAL.md作成**: 元のアイデア・要件を固定名で保存
- [ ] **プロジェクト初期化**: waku-initベースでコピー or cherry-pick
- [ ] **README.md作成**: プロジェクトの責務と目的を明確に記載
- [ ] **Turborepo統合**: publish/turbo.jsonへの統合
- [ ] **package.json設定**: nameをディレクトリ名と一致、ワークスペースへの追加
- [ ] **ビルドスクリプト**: `npm run build`の動作確認
- [ ] **Cloudflare対応**: Waku with Cloudflareの設定確認
- [ ] **デプロイ設定**: Siliplane用の環境変数設定

### ✅ ディレクトリ構造
```
publish/
├── 行動規約.md (本ファイル)
├── README.md (publish全体の責務)
├── flake.nix (Turborepo環境)
├── turbo.json (Turborepoパイプライン)
├── package.json (ワークスペース設定)
├── [project-name]/
│   ├── PROPOSAL.md (元のアイデア・要件) ★必須・固定名
│   ├── README.md (プロジェクト固有の責務) ★必須
│   ├── flake.nix (プロジェクト環境) ★必須
│   ├── package.json
│   └── src/
└── poc/
    └── [experimental-project]/
```

## POC（Proof of Concept）の扱い

技術検証が必要な場合：
```bash
/poc "publish/poc/[project-name]に[技術]の検証
- 検証項目: [何を確認するか]
- 成功基準: [どうなれば成功か]"
```

POCが成功したら本実装へ移行：
```bash
"publish/poc/[project-name]の成果を基に
publish/[project-name]として本実装してデプロイ"
```

## Turborepo コマンド

### ビルド
```bash
# 全プロジェクトビルド
turbo build

# 特定プロジェクトのみ
turbo build --filter=[project-name]

# 変更があったプロジェクトのみ
turbo build --filter='...[HEAD^]'
```

### 開発
```bash
# 開発サーバー起動
turbo dev --filter=[project-name]
```

## デプロイ

### Siliplane へのデプロイ
```bash
# 環境変数設定
cp ../deploy/siliplane/env.sh .env.local
source .env.local

# ビルド
turbo build --filter=[project-name]

# デプロイ実行
cd [project-name]
npm run deploy
```

## トラブルシューティング

### Turborepoキャッシュのクリア
```bash
rm -rf .turbo
turbo build --force
```

### package.json の名前不一致
- waku-initディレクトリ → package.jsonの"name"も"waku-init"に統一
- ディレクトリ名とpackage.jsonのname属性を一致させる

## 参照

- **責務定義**: 各プロジェクトのREADME.md
- **全体規約**: /home/nixos/CLAUDE.md
- **開発規約**: /home/nixos/bin/docs/conventions/
- **Waku環境**: ../waku_node/README.md