---
url: https://zenn.dev/scirexs/articles/b3a8fd89e1a415
saved_at: 2025-08-01T10:19:47Z
title: Denoを使用した静的サイトをCloudflare Workersで公開したメモ
domain: zenn.dev
---

[](https://twitter.com/intent/tweet?url=https://zenn.dev/scirexs/articles/b3a8fd89e1a415&text=Deno%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E9%9D%99%E7%9A%84%E3%82%B5%E3%82%A4%E3%83%88%E3%82%92Cloudflare%20Workers%E3%81%A7%E5%85%AC%E9%96%8B%E3%81%97%E3%81%9F%E3%83%A1%E3%83%A2%EF%BD%9Cscirexs&hashtags=zenn) [](http://www.facebook.com/sharer.php?u=https://zenn.dev/scirexs/articles/b3a8fd89e1a415) [](https://b.hatena.ne.jp/add?mode=confirm&url=https://zenn.dev/scirexs/articles/b3a8fd89e1a415&title=Deno%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E9%9D%99%E7%9A%84%E3%82%B5%E3%82%A4%E3%83%88%E3%82%92Cloudflare%20Workers%E3%81%A7%E5%85%AC%E9%96%8B%E3%81%97%E3%81%9F%E3%83%A1%E3%83%A2%EF%BD%9Cscirexs)

[![](https://storage.googleapis.com/zenn-user-upload/topics/c0de7c62a6.png) Deno](/topics/deno) [![](https://zenn.dev/images/topic.png) memo](/topics/memo) [![](https://storage.googleapis.com/zenn-user-upload/topics/66178dad2d.png) Cloudflare Workers](/topics/cloudflareworkers) [![](https://zenn.dev/images/topic.png) Wrangler](/topics/wrangler) [![](https://static.zenn.studio/images/drawing/tech-icon.svg) tech](/tech-or-idea)

[以前](https://zenn.dev/scirexs/articles/2bb86a94afb2ef) 、Node.js上で構築した静的サイトをwranglerを用いてCloudflare Pagesで公開しました。とある事情によりDeno上で静的サイトの一部を再構築したため同様に公開しようと思っていたところ、CloudflareがPagesではなくWorkersを使用することを [推奨し始めた](https://blog.cloudflare.com/full-stack-development-on-cloudflare-workers/) ことを知ったためWorkersで公開することにしました。静的サイトをGitHub ActionsでWorkersで公開する事と、Denoではwranglerを使用できない事を迂回したりした備忘メモです。

# [](#%E6%96%B9%E9%87%9D) 方針

個人開発が前提。

## [](#%E5%AF%BE%E5%BF%9C%E6%A6%82%E8%A6%81) 対応概要

GitHub Actions上でビルドし、成果物ファイルをwrangler(wrangler-action)を用いてCloudflare Workersにアップロードする。

## [](#%E5%AF%BE%E5%BF%9C%E5%86%85%E5%AE%B9%E3%81%AE%E7%90%86%E7%94%B1) 対応内容の理由

- Cloudflareではビルドしない
  - ローカルもしくはGitHub Actionsでビルドする
        - Cloudflareはホスティングサービスとしてのみ使用しているため
        - わざわざ依存先を増やして複雑にしたくない
- GitHub Actionsでビルドする
  - 資格情報の管理から解放されるため
        - 資格情報の言わばroot権限を人間が持ち続けるのは信用できない
        - ローカルからのアップロードの場合、端末のリプレース等が面倒になる
                  - 全プロジェクトはWSL(vhdx)上のためポータブルだが掃除が面倒になる
- Cloudflareとのやり取りは長期的に安定使用可能であろう方法を使用する
  - 何にも依存しない単なる成果物アップロードのみ使用する
        - Cloudflareを使用しなくなってもこの方法は使用可能と思われるため
  - WorkersのFrameworksは使用しない(調査しない)
        - Web Framework系は変化が激しくいつまでサポートされるのか不明なため
        - SSGには関係ない話な気はする
- アップロードには設定項目等よく変わる印象があるので公式を使用する
  - Denoflareというツールがあるが、非公式なため使用しない
- GitHub Actionsでwranglerを使用する
  - wranglerはNode.jsが必須かつ開発環境にインストールしたくないため
  - CloudflareがGitHub Actionsサポートを打ち切る可能性は低いという願望

# [](#%E5%85%B7%E4%BD%93%E7%9A%84%E3%81%AA%E5%86%85%E5%AE%B9) 具体的な内容

## [](#%E5%AF%BE%E5%BF%9C%E3%81%97%E3%81%9F%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB) 対応したファイル

deploy.yaml

```yaml
name: Deploy Site
on:
  push:
    branches:
      - main
jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 3
    permissions:
      contents: read

    steps:
      - uses: actions/checkout@v4

      - name: Mask secrets
        run: echo "::add-mask::${{ secrets.CLOUDFLARE_WORKERS_URL }}"

      - name: Install Deno
        uses: denoland/setup-deno@v2
        with:
          deno-version: v2.x

      - name: Build package
        run: deno task build

      - name: Deploy to Cloudflare Workers
        uses: cloudflare/wrangler-action@v3
        with:
          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
```

deno.json

```json
{
  "tasks": {
    "build": "mv ./svelte.config.mjs ./svelte.config.js && deno run -A npm:vite build && rm -r ./node_modules",
  }
}
```

wrangler.toml

```toml
name = "name-of-workers"
compatibility_date = "2025-05-06"

[assets]
directory = "./build/"
not_found_handling = "404-page"
html_handling = "auto-trailing-slash"
```

## [](#%E7%B0%A1%E5%8D%98%E3%81%AA%E8%A3%9C%E8%B6%B3%E3%81%A8%E8%BF%BD%E8%A8%98) 簡単な補足と追記

### [](#%E8%B3%87%E6%A0%BC%E6%83%85%E5%A0%B1%E3%81%AA%E3%81%A9%E3%81%AE%E8%A8%AD%E5%AE%9A) 資格情報などの設定

[こちらの記事](https://blog.chick-p.work/blog/github-actions-workflow-deploy-cf-wokers) が詳しい。ログのマスクについても記載あり。

### [](#wrangler%E8%A8%AD%E5%AE%9A) wrangler設定

公式のWorkers Configurationヘルプにも記載はあるが、 [こちらのヘルプ](https://developers.cloudflare.com/workers/static-assets/) の方が纏まっていて分かりやすい。通常 `main` は必須項目だが、Pagesの代わりに使用する場合は任意項目になることはここにしか書いていない。

### [](#%E3%83%93%E3%83%AB%E3%83%89%E5%89%8D%E5%87%A6%E7%90%86) ビルド前処理

Deno上でSvelteを用いて開発する時、 [以前](https://zenn.dev/scirexs/articles/fadcc06a47003f#%E3%81%9D%E3%81%AE%E4%BB%96) 書いたように `svelte.config.js` ファイル名を `svelte.config.mjs` に変更する必要がある。しかし `mjs` のままビルドすると"No adapter specified"となり成果物が生成されない。これはどうやらアダプター設定を取得する際に固定ファイル名 `svelte.config.js` を確認しているためと思われる。これを回避するため、ビルド前にファイル名を変更している。

### [](#%E3%83%93%E3%83%AB%E3%83%89%E5%BE%8C%E5%87%A6%E7%90%86) ビルド後処理

Denoでビルドした後、wranglerを使用しようとするとうまく動作しない。これは `node_modules` の内容が `npm` 準拠になっていないためと思われる。そのため、wranglerでアップロード処理を行う前に `node_modules` を削除して `npm` が内容を作り直すようにしている。

### [](#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E8%A8%AD%E5%AE%9A) カスタムドメイン設定

Cloudflareダッシュボードから設定可能。具体的には Compute (Workers) = > Workers & Pages = > *name-of-workers* = > Settingsタブ = > Domains & Routes = > Add で設定可能。

# [](#%E9%9B%91%E8%A8%98) 雑記

wrangler自体は既にv4.xになっているのですが、wrangler-actionはまだv3が最新のようです。ログを見ると"The version of Wrangler you are using is now out-of-date."と出ているので、v4になった時点で `deploy.yaml` を変更することになると思います。たぶん忘れます。

# [](#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE) 参考文献

- [Your frontend, backend, and database — now in one Cloudflare Worker](https://blog.cloudflare.com/full-stack-development-on-cloudflare-workers/)
- [Static Assets](https://developers.cloudflare.com/workers/static-assets/)
- [Static Site Generation (SSG) and custom 404 pages](https://developers.cloudflare.com/workers/static-assets/routing/static-site-generation/)
- [Configuration](https://developers.cloudflare.com/workers/wrangler/configuration/)
- [Cloudflare Workers に SPA アプリケーションをデプロイする](https://zenn.dev/mierune/articles/cloudflare-workers-static-spa-deploy)
- [GitHub ActionsでCloudflare Workersをデプロイする](https://blog.chick-p.work/blog/github-actions-workflow-deploy-cf-wokers)
- [npm ERR! Cannot read properties of null (reading 'matches')](https://stackoverflow.com/questions/74650198/npm-err-cannot-read-properties-of-null-reading-matches)

[](https://twitter.com/intent/tweet?url=https://zenn.dev/scirexs/articles/b3a8fd89e1a415&text=Deno%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E9%9D%99%E7%9A%84%E3%82%B5%E3%82%A4%E3%83%88%E3%82%92Cloudflare%20Workers%E3%81%A7%E5%85%AC%E9%96%8B%E3%81%97%E3%81%9F%E3%83%A1%E3%83%A2%EF%BD%9Cscirexs&hashtags=zenn) [](http://www.facebook.com/sharer.php?u=https://zenn.dev/scirexs/articles/b3a8fd89e1a415) [](https://b.hatena.ne.jp/add?mode=confirm&url=https://zenn.dev/scirexs/articles/b3a8fd89e1a415&title=Deno%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E9%9D%99%E7%9A%84%E3%82%B5%E3%82%A4%E3%83%88%E3%82%92Cloudflare%20Workers%E3%81%A7%E5%85%AC%E9%96%8B%E3%81%97%E3%81%9F%E3%83%A1%E3%83%A2%EF%BD%9Cscirexs)

### Discussion

![](https://static.zenn.studio/images/drawing/discussion.png)
