# Flake Responsibility Graph

## 目的
bin/src配下の各flakeの責務を探索可能にし、プロジェクト全体の構造を可視化する。

## ビジネス価値

### 解決する課題
1. **重複実装の見逃し**
   - 説明文は異なるが同じ機能を実装している場合の発見困難性
   - 例: "Vector Search"と"ベクトル検索"のような表記揺れ

2. **責務の重複と分散**
   - 似た名前だが異なる実装の識別困難性
   - 例: kuzu_py vs kuzu_ts（同じDB、異なる言語バインディング）

### 期待される効果とROI

#### 開発効率の向上
- **重複コード削減**: 15-30%のコード量削減
- **調査時間短縮**: 新規実装時の既存コード調査時間を50%削減
- **メンテナンス効率化**: バグ修正箇所の一元化による保守工数削減

#### アーキテクチャ品質の向上
- **検出可能な問題**:
  - 意味的に同じだがコードが異なる実装（標準化の機会）
  - コードは似ているが目的が異なる実装（責務分離の必要性）
  - 両方が類似している実装（統合候補）

### 具体的なユースケース

**新規flake作成時の重複防止**:
```bash
$ flake-graph check-before-create "新しいログ機能"
警告: 類似flakeが存在:
- telemetry/log_py (説明: 85%, コード: 該当なし)
- monitoring/logger (説明: 70%, コード: 該当なし)
推奨: 既存flakeの拡張を検討
```

**リファクタリング機会の発見**:
```bash
$ flake-graph analyze-architecture
重複グループ発見:
1. DB接続系 (3 flakes)
   - 共通パターン: connection_setup (90%類似)
   - 推奨: 共通ライブラリ化で500行削減可能
```

## 価値
- **構造理解**: 開発者が大規模なコードベースの全体像を把握できる
- **依存関係の可視化**: flake間の依存関係を明確に理解できる
- **責務の明確化**: 各flakeが何を担当しているかを素早く検索・理解できる
- **アーキテクチャ分析**: カテゴリ別・言語別の統計でプロジェクトの傾向を把握できる

## 機能
- 各flakeのflake.nixから責務情報を自動抽出
- KuzuDBを使用したグラフ構造での永続化
- 責務に基づいた検索・フィルタリング機能
- 依存関係の双方向探索（依存先・依存元）
- カテゴリ別・言語別の統計表示

## 使用技術
- Nix Flakes
- KuzuDB (グラフデータベース)
- Python (データ処理・API)
- flakes/python環境の継承
- persistence/kuzu_py
- telemetry/log_py