# ロギング規約

## 基本方針

ログは、アプリケーションの動作を追跡し、問題発生時に原因を特定するための重要な情報源です。
すべてのログは、機械的に解析しやすい**構造化ログ（Structured Logging）**として出力します。

## ガイドライン

- **JSON形式で出力**: ログはプレーンテキストではなく、JSON形式で出力します。これにより、ログ集約ツール（Datadog, Splunkなど）での検索や分析が容易になります。

- **ログレベルの使い分け**:
  - `ERROR`: 即時の対応が必要な致命的な問題。システムの主要な機能が停止した場合など。
  - `WARN`: 潜在的な問題や、現在はエラーではないが将来的に問題になる可能性のある状況。非推奨APIの使用など。
  - `INFO`: システムの正常な動作を示す情報。リクエストの受信、主要な処理の開始・終了など。
  - `DEBUG`: 開発中にのみ必要となる詳細な情報。変数の中身や処理のステップなど。

- **ログに含めるべき情報**:
  - `timestamp`: ログの発生時刻 (ISO 8601形式)
  - `level`: ログレベル (`error`, `warn`, `info`, `debug`)
  - `message`: ログの主旨を簡潔に説明するメッセージ
  - `service`: サービス名やモジュール名
  - `trace_id`: リクエストを横断して追跡するためのID
  - その他、処理に関連するコンテキスト情報（ユーザーID、リクエストURLなど）

- **個人情報（PII）のマスキング**: ログにユーザーのパスワード、APIキー、住所などの機密情報や個人情報を含めてはいけません。必ずマスキング処理を行ってください。

- **標準出力へ**: ログはファイルに直接書き込まず、標準出力（`stdout`）または標準エラー出力（`stderr`）に出力します。コンテナ環境などでは、実行環境側でログの収集と永続化を行います。
